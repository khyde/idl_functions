; $ID:	MANU_FIGS_MB3_ESTUARIES.PRO,	2020-07-08-15,	USER-KJWH	$

 PRO MANU_FIGS_MB3_ESTUARIES
;+
; NAME:
;       MANU_FIGS_MB3_ESTUARIES
;
; PURPOSE:
;				To create the final figures for Kim Hyde's manuscript
;
;	NOTES:
;				Most procedures are copied from other programs
;
; MODIFICATION HISTORY:
;       Written by:  Kim Hyde, MAY 11,2009
;

ROUTINE_NAME='MANU_FIGS_MB3_ESTUARIES'

TIMER

;	===> Load simple color palette
 	PAL_36,r,g,b

; **************************************************
; ***** SWITCHES CONTROLLING PROCESSING STEPS  *****
; **************************************************
;		Switch	Operation
;		0  			Do not do Step
;		1				Do Step (unless output from this step already exists, then skip this step)
; 	2     	Do Step (make output file from step and overwrite output if it already exists)


		DO_FINAL_TABLES       = 0
		DO_ERF_FIGURES				= 0
		DO_FINAL_FIGURES			= 0
		DO_SEA_COMP						= 0
		DO_PNGS								= 0


;	*** Define names of input and output files so that they are available to various steps

;	ALL_DATA								= 'D:\PROJECTS\MASS_BAY\DATA\MWRA_DATA\FINAL_MWRA_DATA.SAVE'
;	DATA_98_06							= 'D:\PROJECTS\MASS_BAY\DATA\MWRA_DATA\MWRA_DATA_98_06.SAVE'
;	SURF_DATA								= 'D:\PROJECTS\MASS_BAY\DATA\MWRA_DATA\CHL_INSITU_DATA.SAVE'
	INSITU_DATA							= 'D:\PROJECTS\MASS_BAY\DATA\MWRA_Data\CHL_INSITU_DATA.SAVE'
	DIR_SUBAREA_SAVES				= 'E:\SEAWIFS_MLAC-MASS_BAY\TS_SUBAREAS\save\'
	DIR_SUBAREA_STATS				= 'E:\SEAWIFS_MLAC-MASS_BAY\TS_SUBAREAS\stats\'
	DIR_SUBAREA_ANOMS       = 'E:\SEAWIFS_MLAC-MASS_BAY\TS_SUBAREAS\anoms\'
;	SAT_DATA								= 'D:\PROJECTS\MASS_BAY\DATA\MWRA_DATA\CHL_SAT_COMPARISON_DATA.SAVE'
;	SAT_STATIONS						= 'D:\PROJECTS\MASS_BAY\SEAWIFS_MASS_BAY_OUTPUT/STATION_EXTRACT.SAVE'
;	REG_AVG									= 'D:\PROJECTS\MASS_BAY\SEAWIFS_MASS_BAY_OUTPUT/SUBAREA_AVERAGES.SAVE'
;	SUBAREAS								= 'D:\PROJECTS\MASS_BAY\SEAWIFS_MASS_BAY_OUTPUT/SUBAREA_EXTRACT.SAVE'
;	SUBAREA_ANNUAL					= 'D:\PROJECTS\MASS_BAY\SEAWIFS_MASS_BAY_OUTPUT\SUBAREA_ANNUALS.SAVE'
	ENV_DATA								= 'D:\PROJECTS\MASS_BAY\DATA\ENV_DATA\ENV_DATA.SAVE'
	MONTHLY_WINDS						=	'D:\PROJECTS\MASS_BAY\DATA\Boston_buoy_data\MONTHLY_AVE_BUOY_DATA.SAVE'
	PHYTO_FILE							= 'D:\PROJECTS\MASS_BAY\DATA\MWRA_DATA\PHYTOPLANKTON_DATA.SAVE'
	ZOO_FILE								= 'D:\PROJECTS\MASS_BAY\DATA\MWRA_DATA\ZOOPLANKTON_DATA.SAVE'
;	CHL_PROFILES 						= 'D:\PROJECTS\MASS_BAY\DATA\MWRA_DATA\CHL_PROFILES.SAVE'
;	BUOY_8DAY								=	'D:\PROJECTS\MASS_BAY\DATA\Boston_buoy_data\8DAY_AVG_BUOY_DATA.SAVE'

	FINAL_PORTRAIT					= 'D:\PROJECTS\MASS_BAY\PLOT\MANUSCRIPT3\FINAL_FIGURES_PORTRAIT.PS'
	FINAL_LANDSCAPE					= 'D:\PROJECTS\MASS_BAY\PLOT\MANUSCRIPT3\FINAL_FIGURES_LANDSCAPE.PS'
	ERF_PORTRAIT						= 'D:\PROJECTS\MASS_BAY\PLOT\MANUSCRIPT3\ERF_FIGURES_PORTRAIT.PS'
	ERF_LANDSCAPE						= 'D:\PROJECTS\MASS_BAY\PLOT\MANUSCRIPT3\ERF_FIGURES_LANDSCAPE.PS'
	WINDROSE								= 'D:\PROJECTS\MASS_BAY\PLOT\MANUSCRIPT3\WINDROSE.PS'
	EOF_FIGURE							= 'D:\PROJECTS\MASS_BAY\PLOT\MANUSCRIPT3\EOF_FIGURE.PS'
	CONTOURS								= 'D:\PROJECTS\MASS_BAY\PLOT\MANUSCRIPT3\CONTOURS.PS'
	REG_FIGURES							= 'D:\PROJECTS\MASS_BAY\PLOT\MANUSCRIPT3\REGIONAL_FIGURES.PS'
	PHYTO_FIGURES						= 'D:\PROJECTS\MASS_BAY\PLOT\MANUSCRIPT3\PHYTO_FIGURES.PS'
	ZOO_FIGURES							= 'D:\PROJECTS\MASS_BAY\PLOT\MANUSCRIPT3\ZOO_FIGURES.PS'
	NUTRIENT_FIGURES				= 'D:\PROJECTS\MASS_BAY\PLOT\MANUSCRIPT3\NUTRIENT_FIGURES.PS'
	SEAWIFS									= 'D:\PROJECTS\MASS_BAY\PLOT\MANUSCRIPT3\SEAWIFS_CHL_FIGURES.PS'
	TIMEPLOTS								= 'D:\PROJECTS\MASS_BAY\PLOT\MANUSCRIPT3\TIMEPLOTS.PS'
	ENVPLOTS								= 'D:\PROJECTS\MASS_BAY\PLOT\MANUSCRIPT3\ENV_DATA_PLOTS.PS'
	PHYTO_PLOTS							= 'D:\PROJECTS\MASS_BAY\PLOT\MANUSCRIPT3\PHYTOPLANKTON_PLOTS.PS'
	COLORBARS								= 'D:\PROJECTS\MASS_BAY\PLOT\MANUSCRIPT3\COLORBARS.PS'

	!X.OMARGIN = 0
	!Y.OMARGIN = 0


; *******************************************************
	IF DO_FINAL_TABLES GE 1 THEN BEGIN
; *******************************************************
		OVERWRITE = DO_FINAL_TABLES GE 2
		EXIST = FILE_TEST(FINAL_LANDSCAPE)
		IF EXIST AND OVERWRITE EQ 0 THEN GOTO, SKIP_FINAL  ; >>>>>>>>>>>>>>>>>>>>>>>>>

		E   = IDL_RESTORE(ENV_DATA)
		ENVDATE = DATE_2JD(E.DATE)
;		D   = IDL_RESTORE(INSITU_DATA)
;		SC  = IDL_RESTORE(DIR_SUBAREA_STATS + '!S-MASK_SUBAREA-MASS_BAY-PXY_160_160-REGIONS_HYDE-REPRO5-CHLOR_A-MB-STATS.SAVE')
;		SP  = IDL_RESTORE(DIR_SUBAREA_STATS + '!D-MASK_SUBAREA-MASS_BAY-PXY_160_160-REGIONS_HYDE-REPRO5-PPD-VGMB-STATS.SAVE')
		AC  = IDL_RESTORE(DIR_SUBAREA_ANOMS + '!S-MASK_SUBAREA-MASS_BAY-PXY_160_160-REGIONS_HYDE-REPRO5-CHLOR_A-MB-ANOMS.SAVE')
		AP  = IDL_RESTORE(DIR_SUBAREA_ANOMS + '!D-MASK_SUBAREA-MASS_BAY-PXY_160_160-REGIONS_HYDE-REPRO5-PPD-VGMB-ANOMS.SAVE')
;		ANN = IDL_RESTORE(DIR_SUBAREA_STATS + '!D-MASK_SUBAREA-MASS_BAY-PXY_160_160-REGIONS_HYDE-REPRO5-PPD-VGMB-STATS-ANNUAL.SAVE')
;

	; DO TABLE 2 - ANOMALY STATS


	;	DO TABLE 3 - BLOOM ANOMALY QUANTIFICATION (INTIATION, TERMINATION, DURATION, MAX, MEAN)
		OK = WHERE(STRMID(AC.FIRST_NAME,0,3) EQ '!D_') & AAC = AC[OK] & CTAGS = TAG_NAMES(AAC); & FP_AAC = PARSE_IT(AAC.FIRST_NAME,/ALL)
		OK = WHERE(STRMID(AP.FIRST_NAME,0,3) EQ '!D_') & AAP = AP[OK] & PTAGS = TAG_NAMES(AAP); & FP_AAP = PARSE_IT(AAP.FIRST_NAME,/ALL)
		TAGNAMES = [CTAGS[1],CTAGS(2),CTAGS(3),CTAGS(4),CTAGS(5)]
		STRUCT = STRUCT_JOIN(AAC, AAP, TAGNAMES=TAGNAMES)
		FP = PARSE_IT(STRUCT.ANOM_RATIO,/ALL)
		CODES = [1,3,4,2]
		REGIONS = ['  North Shore','  West Shore','  Cape Cod Bay','Eastern Massachusetts Bay']
		SEASONS = ['WSP','SUM','FAL','TOT']				; WIN-SP=JAN,FEB,MAR,APR,MAY  SUM=JUN,JUL,AUG  FALL=SEP,OCT,NOV,DEC  TOT = ALL MONTHS
		YEARS = ['1998','1999','2000','2001','2002','2003','2004','2005','2006']
		DATES = CREATE_DATE('19980101','20070101')
		NEW = CREATE_STRUCT('YEAR','','SEASON','','SUBAREA_CODE','','SUBAREA_NAME','','MEAN_WINDS',0.0,'MEAN_GUSTS',0.0,'N_WIND_4',0L,'N_WIND_6',0L,'N_WIND_8',0L,$
												'INITIATION',0L, 'DURATION',0L, 'TERMINATION',0L, 'NDAYS',0L,$
												'CHL_INT_DATE',0L,'CHL_DURATION',0L,'CHL_END_DATE',0L,'CHL_NDAYS',0L,'CHL_NAVG',0L,'CHL_MIN',0.0,'CHL_MAX',0.0,'CHL_MEAN',0.0,$
												'PROD_INT_DATE',0L,'PROD_DURATION',0L,'PROD_END_DATE',0L,'PROD_NDAYS',0L,'PROD_NAVG',0L,'PROD_MIN',0.0,'PROD_MAX',0.0,'PROD_MEAN',0.0)
		NEW = STRUCT_2MISSINGS(NEW)
		NEW = REPLICATE(NEW, N_ELEMENTS(CODES)*N_ELEMENTS(SEASONS)*N_ELEMENTS(YEARS))
		CT = 0
		FOR CTH = 0L, N_ELEMENTS(CODES)-1 DO BEGIN
			ACODE = CODES(CTH)
			OK = WHERE(STRUCT.SUBAREA_CODE EQ ACODE AND STRUCT.ANOM NE MISSINGS(0.0))
			SUBAREA = STRUCT(OK[0]).SUBAREA_NAME
			CHL = STRUCT[OK]
			CY = INTERP_XTEND(DATE_2JD(FP[OK].DATE_START), CHL.ANOM,  DATE_2JD(DATES))
			OK = WHERE(STRUCT.SUBAREA_CODE EQ ACODE AND STRUCT.ANOM$2 NE MISSINGS(0.0))
			PROD = STRUCT[OK]
			PY = INTERP_XTEND(DATE_2JD(FP[OK].DATE_START), PROD.ANOM$2,  DATE_2JD(DATES))
			CPY = FLTARR(N_ELEMENTS(CY.Y))
			CORP = STRARR(N_ELEMENTS(CY.Y))
			ANOM = STRARR(N_ELEMENTS(CY.Y))
			FOR NTH = 0L, N_ELEMENTS(CPY)-1 DO BEGIN
				CPY[NTH] = MAX([CY[NTH].Y,PY[NTH].Y])
				IF CPY[NTH]  EQ CY[NTH].Y THEN CORP[NTH] = 'CHL' ELSE CORP[NTH] = 'PPD'
				IF CORP[NTH] EQ 'CHL' AND CPY[NTH] GE 2 THEN ANOM[NTH] = 'ANOM'
				IF CORP[NTH] EQ 'PPD' AND CPY[NTH] GE 1.75 THEN ANOM[NTH] = 'ANOM'
			ENDFOR
			FOR STH = 0L, N_ELEMENTS(SEASONS)-1 DO BEGIN
				ASEA = SEASONS(STH)
				FOR YTH = 0L, N_ELEMENTS(YEARS)-1 DO BEGIN
					AYEAR = YEARS(YTH)
					IF ASEA EQ 'WSP' THEN BEGIN & SDATE = DATE_2JD(AYEAR + '0101') & EDATE = DATE_2JD(AYEAR + '0531') & ENDIF
					IF ASEA EQ 'SUM' THEN BEGIN & SDATE = DATE_2JD(AYEAR + '0601') & EDATE = DATE_2JD(AYEAR + '0831') & ENDIF
					IF ASEA EQ 'FAL' THEN BEGIN & SDATE = DATE_2JD(AYEAR + '0901') & EDATE = DATE_2JD(AYEAR + '1231') & ENDIF
					IF ASEA EQ 'TOT' THEN BEGIN & SDATE = DATE_2JD(AYEAR + '0101') & EDATE = DATE_2JD(AYEAR + '1231') & ENDIF

					NEW(CT).YEAR = AYEAR
					NEW(CT).SEASON = ASEA
					NEW(CT).SUBAREA_CODE = ACODE
					NEW(CT).SUBAREA_NAME = SUBAREA

					OK = WHERE(CY.X GE SDATE AND CY.X LE EDATE,COUNT)
					NEW(CT).CHL_MIN = MIN(CY[OK].Y)
					NEW(CT).CHL_MAX = MAX(CY[OK].Y)
					NEW(CT).CHL_MEAN = MEAN(CY[OK].Y)
					OK = WHERE(PY.X GE SDATE AND PY.X LE EDATE,COUNT)
					NEW(CT).PROD_MIN = MIN(PY[OK].Y)
					NEW(CT).PROD_MAX = MAX(PY[OK].Y)
					NEW(CT).PROD_MEAN = MEAN(PY[OK].Y)
					OK = WHERE(ENVDATE GE SDATE AND ENVDATE LE EDATE AND E.WIND_SPEED NE MISSINGS(0.0),COUNT)
					NEW(CT).MEAN_WINDS = MEAN(E[OK].WIND_SPEED)
					OK = WHERE(ENVDATE GE SDATE AND ENVDATE LE EDATE AND E.WIND_GUST NE MISSINGS(0.0),COUNT)
					NEW(CT).MEAN_GUSTS = MEAN(E[OK].WIND_GUST)
					OK = WHERE(ENVDATE GE SDATE AND ENVDATE LE EDATE AND E.WIND_SPEED NE MISSINGS(0.0) AND E.WIND_SPEED GT 4,COUNT)
					IF COUNT GE 1 THEN NEW(CT).N_WIND_4 = COUNT
					OK = WHERE(ENVDATE GE SDATE AND ENVDATE LE EDATE AND E.WIND_SPEED NE MISSINGS(0.0) AND E.WIND_SPEED GT 6,COUNT)
					IF COUNT GE 1 THEN NEW(CT).N_WIND_6 = COUNT
					OK = WHERE(ENVDATE GE SDATE AND ENVDATE LE EDATE AND E.WIND_SPEED NE MISSINGS(0.0) AND E.WIND_SPEED GT 8,COUNT)
					IF COUNT GE 1 THEN NEW(CT).N_WIND_8 = COUNT


					OK = WHERE(CY.Y GE 2 AND CY.X GE SDATE AND CY.X LE EDATE,COUNT)
					IF COUNT GE 1 THEN NEW(CT).CHL_INT_DATE = JD_2DOY(MIN(CY[OK].X)) ELSE NEW(CT).CHL_INT_DATE = 0
					IF COUNT GE 1 THEN NEW(CT).CHL_END_DATE = JD_2DOY(MAX(CY[OK].X)) ELSE NEW(CT).CHL_END_DATE = 0
					IF COUNT GE 1 THEN NEW(CT).CHL_DURATION = NEW(CT).CHL_END_DATE - NEW(CT).CHL_INT_DATE + 1 ELSE NEW(CT).CHL_DURATION = 0
					NEW(CT).CHL_NDAYS = COUNT
					OK = WHERE(CY.Y GE 1 AND CY.X GE SDATE AND CY.X LE EDATE,COUNT)
					NEW(CT).CHL_NAVG = COUNT

					OK = WHERE(PY.Y GE 1.75 AND PY.X GE SDATE AND PY.X LE EDATE,COUNT)
					IF COUNT GE 1 THEN NEW(CT).PROD_INT_DATE = JD_2DOY(MIN(PY[OK].X)) ELSE NEW(CT).PROD_INT_DATE = 0
					IF COUNT GE 1 THEN NEW(CT).PROD_END_DATE = JD_2DOY(MAX(PY[OK].X)) ELSE NEW(CT).PROD_END_DATE = 0
					IF COUNT GE 1 THEN NEW(CT).PROD_DURATION = NEW(CT).PROD_END_DATE - NEW(CT).PROD_INT_DATE + 1 ELSE NEW(CT).PROD_DURATION = 0
					NEW(CT).PROD_NDAYS = COUNT
					OK = WHERE(PY.Y GE 1 AND PY.X GE SDATE AND PY.X LE EDATE,COUNT)
					NEW(CT).PROD_NAVG = COUNT

					OK = WHERE(ANOM EQ 'ANOM' AND PY.X GE SDATE AND PY.X LE EDATE,COUNT)
					IF COUNT GE 1 THEN NEW(CT).INITIATION = JD_2DOY(MIN(PY[OK].X)) ELSE NEW(CT).INITIATION = 0
					IF COUNT GE 1 THEN NEW(CT).TERMINATION = JD_2DOY(MAX(PY[OK].X)) ELSE NEW(CT).TERMINATION = 0
					IF COUNT GE 1 THEN NEW(CT).DURATION = NEW(CT).TERMINATION - NEW(CT).INITIATION + 1 ELSE NEW(CT).DURATION = 0
					NEW(CT).NDAYS = COUNT

					CT = CT + 1
				ENDFOR
			ENDFOR
		ENDFOR
		SAVE, FILENAME = 'D:\PROJECTS\MASS_BAY\DOC\Manuscripts\ManuscriptIII\RAW_TABLES\TABLE3_3.SAVE',NEW,/COMPRESS
		STRUCT_2CSV, 'D:\PROJECTS\MASS_BAY\DOC\Manuscripts\ManuscriptIII\RAW_TABLES\TABLE3_3.CSV',NEW

		NEW = IDL_RESTORE('D:\PROJECTS\MASS_BAY\DOC\Manuscripts\ManuscriptIII\RAW_TABLES\TABLE3_3.SAVE')
		POPS = ['WSP','SUM','FAL','TOT']
		PRINT, 'REGIONS'
		FOR _P =0L, N_ELEMENTS(POPS)-1 DO BEGIN
			OK   = WHERE(NEW.SEASON EQ POPS(_P), COUNT)
			_NEW = NEW[OK]
			BCODES = WHERE_SETS(_NEW.SUBAREA_CODE)
			BYEARS = WHERE_SETS(_NEW.YEAR)
			X = FLTARR(N_ELEMENTS(BCODES),N_ELEMENTS(BYEARS))
			FOR _B = 0L, N_ELEMENTS(BCODES)-1 DO BEGIN
				SUBS = WHERE_SETS_SUBS(BCODES(_B))
				SET  = _NEW(SUBS)
				X(_B,*) = SET.NDAYS
			ENDFOR
			PRINT, POPS(_P), KW_TEST(X, MISSING = -1)
		ENDFOR
		PRINT, 'YEARS'
		FOR _P =0L, N_ELEMENTS(POPS)-1 DO BEGIN
			OK   = WHERE(NEW.SEASON EQ POPS(_P),COUNT)
			_NEW = NEW[OK]
			BCODES = WHERE_SETS(_NEW.SUBAREA_CODE)
			BYEARS = WHERE_SETS(_NEW.YEAR)
			X = FLTARR(N_ELEMENTS(BYEARS),N_ELEMENTS(BCODES))
			FOR _B = 0L, N_ELEMENTS(BYEARS)-1 DO BEGIN
				SUBS = WHERE_SETS_SUBS(BYEARS(_B))
				SET  = _NEW(SUBS)
				X(_B,*) = SET.NDAYS
			ENDFOR
			PRINT, POPS(_P), KW_TEST(X, MISSING = -1)
		ENDFOR
		STOP

	; MAKE ANNUAL/SEAONAL PERCENT TABLE
		SEASONS = ['WSP','SUM','FAL']					; WIN-SP=JAN,FEB,MAR,APR,MAY  SUM=JUN,JUL,AUG  FALL=SEP,OCT,NOV,DEC
		CODES = [1,3,4,2]
		REGIONS = ['  North Shore','  West Shore','  Cape Cod Bay','Eastern Massachusetts Bay']
		YEARS = ['1998','1999','2000','2001','2002','2003','2004','2005','2006']
		NEW = CREATE_STRUCT('YEAR','','REGION','','ANNUAL',0.0,'WSP',0.0,'SUM',0.0,'FAL',0.0,'PER_WSP',0.0,'PER_SUM',0.0,'PER_FAL',0.0)
		NEW = STRUCT_2MISSINGS(NEW)
		NEW = REPLICATE(NEW, N_ELEMENTS(CODES)*N_ELEMENTS(YEARS))
		CT = 0
		FOR CTH = 0L, N_ELEMENTS(CODES)-1 DO BEGIN
			ACODE = CODES(CTH)
			OK = WHERE(SP.SUBAREA_CODE EQ ACODE)
			SS = SP[OK]
			REG = FIRST(SS.SUBAREA_NAME)
			FP_SS = PARSE_IT(SS.FIRST_NAME,/ALL)
			_YEARS = FP_SS.YEAR_START
			TOTAL_DAYS = ROUND(DATE_2JD(FP_SS.DATE_END) - DATE_2JD(FP_SS.DATE_START))
			FOR YTH = 0L, N_ELEMENTS(YEARS)-1 DO BEGIN
				AYEAR = YEARS(YTH)
				DAYS = DATE_DAYS_YEAR(AYEAR)
				NEW(CT).YEAR = AYEAR
				NEW(CT).REGION = REG
				OK = WHERE(_YEARS EQ AYEAR AND FP_SS.PERIOD_CODE EQ '!Y') & NEW(CT).ANNUAL = SS[OK].MEAN*DAYS
				OK = WHERE(_YEARS EQ AYEAR AND STRPOS(FP_SS.NAME,SEASONS[0]) NE -1) & NEW(CT).WSP = SS[OK].MEAN*TOTAL_DAYS[OK] & NEW(CT).PER_WSP = NEW(CT).WSP/NEW(CT).ANNUAL
				OK = WHERE(_YEARS EQ AYEAR AND STRPOS(FP_SS.NAME,SEASONS[1]) NE -1) & NEW(CT).SUM = SS[OK].MEAN*TOTAL_DAYS[OK] & NEW(CT).PER_SUM = NEW(CT).SUM/NEW(CT).ANNUAL
				OK = WHERE(_YEARS EQ AYEAR AND STRPOS(FP_SS.NAME,SEASONS(2)) NE -1) & NEW(CT).FAL = SS[OK].MEAN*TOTAL_DAYS[OK] & NEW(CT).PER_FAL = NEW(CT).FAL/NEW(CT).ANNUAL
				CT = CT + 1
			ENDFOR
		ENDFOR
		STRUCT_2CSV, 'D:\PROJECTS\MASS_BAY\DOC\Manuscripts\ManuscriptIII\RAW_TABLES\TABLE3_4.CSV',NEW
	ENDIF ;IF DO_FINAL_TABLES GE 1 THEN BEGIN

; *******************************************************
	IF DO_ERF_FIGURES GE 1 THEN BEGIN
; *******************************************************
		OVERWRITE = DO_ERF_FIGURES GE 2
		EXIST = FILE_TEST(ERF_LANDSCAPE)
		IF EXIST AND OVERWRITE EQ 0 THEN GOTO, SKIP_ERF  ; >>>>>>>>>>>>>>>>>>>>>>>>>

		E   					= IDL_RESTORE(ENV_DATA)
		D   					= IDL_RESTORE(INSITU_DATA)
		REG_STAT_CHL  = IDL_RESTORE(DIR_SUBAREA_STATS + '!S-MASK_SUBAREA-MASS_BAY-PXY_160_160-REGIONS_HYDE-REPRO5-CHLOR_A-MB-STATS.SAVE')
		REG_STAT_PPD  = IDL_RESTORE(DIR_SUBAREA_STATS + '!D-MASK_SUBAREA-MASS_BAY-PXY_160_160-REGIONS_HYDE-REPRO5-PPD-VGMB-STATS.SAVE')
		REG_ANOM_CHL  = IDL_RESTORE(DIR_SUBAREA_ANOMS + '!S-MASK_SUBAREA-MASS_BAY-PXY_160_160-REGIONS_HYDE-REPRO5-CHLOR_A-MB-ANOMS.SAVE')
		REG_ANOM_PPD  = IDL_RESTORE(DIR_SUBAREA_ANOMS + '!D-MASK_SUBAREA-MASS_BAY-PXY_160_160-REGIONS_HYDE-REPRO5-PPD-VGMB-ANOMS.SAVE')
		MB_STAT_CHL  	= IDL_RESTORE(DIR_SUBAREA_STATS + '!S-MASK_SUBAREA-MASS_BAY-PXY_160_160-MB_CCB_COMBO_HYDE-REPRO5-CHLOR_A-MB-STATS.SAVE')
		MB_STAT_PPD  	= IDL_RESTORE(DIR_SUBAREA_STATS + '!D-MASK_SUBAREA-MASS_BAY-PXY_160_160-MB_CCB_COMBO_HYDE-REPRO5-PPD-VGMB-STATS.SAVE')
		MB_ANOM_CHL  	= IDL_RESTORE(DIR_SUBAREA_ANOMS + '!S-MASK_SUBAREA-MASS_BAY-PXY_160_160-MB_CCB_COMBO_HYDE-REPRO5-CHLOR_A-MB-ANOMS.SAVE')
		MB_ANOM_PPD  	= IDL_RESTORE(DIR_SUBAREA_ANOMS + '!D-MASK_SUBAREA-MASS_BAY-PXY_160_160-MB_CCB_COMBO_HYDE-REPRO5-PPD-VGMB-ANOMS.SAVE')
		REG_ANN 			= IDL_RESTORE(DIR_SUBAREA_STATS + '!D-MASK_SUBAREA-MASS_BAY-PXY_160_160-REGIONS_HYDE-REPRO5-PPD-VGMB-STATS-ANNUAL.SAVE')
		MB_ANN 				= IDL_RESTORE(DIR_SUBAREA_STATS + '!D-MASK_SUBAREA-MASS_BAY-PXY_160_160-MB_CCB_COMBO_HYDE-REPRO5-PPD-VGMB-STATS-ANNUAL.SAVE')
		PHYTO  			 	= IDL_RESTORE(PHYTO_FILE)

		CTITLE = 'Chlorophyll !8a!7 (mg m!E-3!N)'
		PTITLE = 'Production (gC m!E-2!N d!E-1!N)'

		X  = DATE_2JD([19980101,20070101]) & AX  = DATE_AXIS(X,/MONTH, STEP_SIZE=4) & AYR = DATE_AXIS(X,/YEAR)
		X2 = DATE_2JD([20200101,20210101]) & AX2 = DATE_AXIS(X2, /FYEAR)
		XTICKNAMES = REPLICATE(' ',N_ELEMENTS(AX.TICKNAME))
		X2TICKNAME = REPLICATE(' ',N_ELEMENTS(AX2.TICKNAME))
		CHARSIZE = 2.5
		SYMSIZE = 0.45
		THICK = 2
		FONT = 0
		YMARGIN = [0.3,0.3]
		XMARGIN = [4,1]
		CIR = DRAW_CIRCLE(0,0,1,49)
		USERSYM, CIR(0,*),CIR(1,*),THICK=3,/FILL
		PSYM = 8

		PSPRINT,FILENAME=ERF_LANDSCAPE,/COLOR,/Full,/TIMES,/LANDSCAPE
		!P.MULTI = [0,1,2]

		CODES = [9]
		COLORS = [2,7,10,13,18,22,29,19,4]
		SYMSIZE = 0.45
		REGIONS = [' Massachusetts Bay']
		PRODS = ['PPD']
		YEARS = ['1998','1999','2000','2001','2002','2003','2004','2005','2006']
		LEG_POS = [0.028 ,0.4,0.045,0.95]
		FOR PTH = 0L, N_ELEMENTS(PRODS)-1 DO BEGIN
			!P.MULTI = [0,1,2]
			IF PRODS(PTH) EQ 'PPD'     THEN TT = MB_STAT_PPD
			OK = WHERE(STRMID(TT.FIRST_NAME,0,2) EQ '!W')
			T = TT[OK]
			TFP = PARSE_IT(T.FIRST_NAME,/ALL)
			FOR CTH = 0L, N_ELEMENTS(CODES)-1 DO BEGIN
				RP = [0,2]
				PYTICKS = 2
				PYMINOR = 5

				OK = WHERE(T.SUBAREA_CODE EQ CODES(CTH) AND TFP.PERIOD_CODE EQ '!W' AND TFP.YEAR_START GE '1998' AND TFP.YEAR_END LE '2006')
				MONS = T[OK]
				MFP = TFP[OK]
				NEW = CREATE_STRUCT('WEEK_MIN','','WEEK_MAX','','WEEK','','DEPTH',0.0,'ALL_MEAN',0.0,$
														'DATA_MIN',0.0,'DATA_MAX',0.0,'DATA_MEAN',0.0,'DATA_98',0.0,'DATA_99',0.0,'DATA_00',0.0,$
														'DATA_01',0.0,'DATA_02',0.0,'DATA_03',0.0,'DATA_04',0.0,'DATA_05',0.0,'DATA_06',0.0)
				NEW = STRUCT_2MISSINGS(NEW)
				TAGS = TAG_NAMES(NEW)
				OK = WHERE(T.SUBAREA_CODE EQ CODES(CTH) AND TFP.PERIOD_CODE EQ '!WEEK')
				WKS = T[OK]
				WFP = TFP[OK]
				NEW = REPLICATE(NEW, N_ELEMENTS(WKS))
				NEW.DEPTH = 0.5
				NEW.WEEK_MIN = WFP.DATE_START
				NEW.WEEK_MAX = WFP.DATE_END
				NEW.WEEK = STRMID(WFP.PERIOD,6,2)
				NEW.DATA_MIN = WKS.MIN
				NEW.DATA_MAX = WKS.MAX
				NEW.DATA_MEAN = WKS.MEAN
				DATE = YDOY_2DATE('2020',DATE_2DOY(NEW.WEEK_MIN)+3)


				OK = WHERE(TT.SUBAREA_CODE EQ CODES(CTH) AND STRMID(TT.FIRST_NAME,0,5) EQ '!YEAR')
				NEW.ALL_MEAN	= TT[OK].MEAN

				YSET = WHERE_SETS(MFP.YEAR_START)
				YSET = YSET[SORT(YSET.VALUE)]
				POS = WHERE(TAGS EQ 'DATA_98')
				CT = 0
				FOR YTH = 0L, N_ELEMENTS(YSET) -1  DO BEGIN
					SUBS = WHERE_SETS_SUBS(YSET(YTH))
					YR = MONS(SUBS)
					YFP = MFP(SUBS)
					WK = STRMID(YFP.PERIOD,7,2)
					OK = WHERE_MATCH(NEW.WEEK,WK,COUNT,VALID=VALID,COMPLEMENT=COMPLEMENT,NCOMPLEMENT=NCOMPLEMENT)
					NEW[OK].(POS+CT) = YR(VALID).MEAN
					CT = CT + 1
				ENDFOR

				IF PRODS(PTH) EQ 'PPD' THEN BEGIN
					IF CTH EQ 0 OR CTH EQ N_ELEMENTS(CODES)-1 THEN YTITLE = PTITLE ELSE YTITLE = ' '
					IF CTH EQ N_ELEMENTS(CODES)-1 THEN XTICKNAME = AX2.TICKNAME ELSE XTICKNAME = X2TICKNAME
					PLOT, AX2.JD,RP, YTITLE=YTITLE,YRANGE=RP,/XSTYLE,/YSTYLE,XMARGIN=XMARGIN,YMARGIN=YMARGIN,YTICKS=PYTICKS,YMINOR=PYMINOR,$
						XTICKS=AX2.TICKS,XTICKNAME=XTICKNAME,XTICKV=AX2.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
					OPLOT, DATE_2JD(DATE),NEW.DATA_MEAN, COLOR = 0, THICK = 8
					!P.MULTI = [0,1,2]
					PLOT, AX2.JD,RP, YTITLE=YTITLE,YRANGE=RP,/XSTYLE,/YSTYLE,XMARGIN=XMARGIN,YMARGIN=YMARGIN,YTICKS=PYTICKS,YMINOR=PYMINOR,$
						XTICKS=AX2.TICKS,XTICKNAME=XTICKNAME,XTICKV=AX2.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
					YY = [NEW.DATA_MAX,REVERSE(NEW.DATA_MIN)]
					XX = [DATE,REVERSE(DATE)]
					POLYFILL, DATE_2JD(XX), YY, COLOR = 35
					OPLOT, DATE_2JD(DATE),NEW.DATA_MEAN, COLOR = 0, THICK = 8
					!P.MULTI = [0,1,2]
					PLOT, AX2.JD,RP, YTITLE=YTITLE,YRANGE=RP,/XSTYLE,/YSTYLE,XMARGIN=XMARGIN,YMARGIN=YMARGIN,YTICKS=PYTICKS,YMINOR=PYMINOR,$
						XTICKS=AX2.TICKS,XTICKNAME=XTICKNAME,XTICKV=AX2.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
					YY = [NEW.DATA_MAX,REVERSE(NEW.DATA_MIN)]
					XX = [DATE,REVERSE(DATE)]
					POLYFILL, DATE_2JD(XX), YY, COLOR = 35
					POS = WHERE(TAGS EQ 'DATA_98')
					FOR YTH = 0L, N_ELEMENTS(YEARS)-1  DO BEGIN
						OK = WHERE(NEW.(POS) NE MISSINGS(0.0))
						OPLOT, DATE_2JD(DATE[OK]),NEW[OK].(POS),THICK=3,PSYM=-8,SYMSIZE=SYMSIZE,COLOR=COLORS(YTH)
						YEAR = YEARS(YTH)
						IF YTH EQ 0 THEN TXT = STRTRIM(YEAR,2) ELSE TXT = [TXT,STRTRIM(YEAR,2)]
						POS = POS + 1
					ENDFOR
					TXT = [TXT,'Mean']
					OPLOT, DATE_2JD(DATE),NEW.DATA_MEAN, COLOR = 0, THICK = 8
					IF CTH EQ 0 OR CTH EQ N_ELEMENTS(CODES)-1 THEN LEG,pos=LEG_POS,color=[COLORS,0],label=TXT,THICK=THICK,LSIZE=1.25,FONT=FONT
					LABEL = REGIONS(CTH) + '!CMean = ' + STRMID(NUM2STR(NEW[0].ALL_MEAN),0,4) + ' gC m!E-2!N day!E-1!N'
					COOR = COORD_2PLOT(0.62,0.9)
					XYOUTS, COOR.X,COOR.Y,LABEL, ALIGN=-0.1, CHARSIZE=1.5, COLOR=0, CHARTHICK=1
				ENDIF
			ENDFOR
		ENDFOR

		CODES = [1,3,4,2]
		COLORS = [2,7,10,13,18,22,29,19,4]
		SYMSIZE = 0.45
		REGIONS = ['  North Shore','  West Shore','  Cape Cod Bay','Eastern Massachusetts Bay']
		PRODS = ['PPD']
		YEARS = ['1998','1999','2000','2001','2002','2003','2004','2005','2006']
		LEG_POS = [0.028 ,0.32,0.045,0.92]
		FOR PTH = 0L, N_ELEMENTS(PRODS)-1 DO BEGIN
			!P.MULTI = [0,1,4]
			IF PRODS(PTH) EQ 'PPD'     THEN TT = REG_STAT_PPD
			OK = WHERE(STRMID(TT.FIRST_NAME,0,2) EQ '!W')
			T = TT[OK]
			TFP = PARSE_IT(T.FIRST_NAME,/ALL)
			FOR CTH = 0L, N_ELEMENTS(CODES)-1 DO BEGIN
				RP = [0,3]
				PYTICKS = 3
				PYMINOR = 5

				OK = WHERE(T.SUBAREA_CODE EQ CODES(CTH) AND TFP.PERIOD_CODE EQ '!W' AND TFP.YEAR_START GE '1998' AND TFP.YEAR_END LE '2006')
				MONS = T[OK]
				MFP = TFP[OK]
				NEW = CREATE_STRUCT('WEEK_MIN','','WEEK_MAX','','WEEK','','DEPTH',0.0,'ALL_MEAN',0.0,$
														'DATA_MIN',0.0,'DATA_MAX',0.0,'DATA_MEAN',0.0,'DATA_98',0.0,'DATA_99',0.0,'DATA_00',0.0,$
														'DATA_01',0.0,'DATA_02',0.0,'DATA_03',0.0,'DATA_04',0.0,'DATA_05',0.0,'DATA_06',0.0)
				NEW = STRUCT_2MISSINGS(NEW)
				TAGS = TAG_NAMES(NEW)
				OK = WHERE(T.SUBAREA_CODE EQ CODES(CTH) AND TFP.PERIOD_CODE EQ '!WEEK')
				WKS = T[OK]
				WFP = TFP[OK]
				NEW = REPLICATE(NEW, N_ELEMENTS(WKS))
				NEW.DEPTH = 0.5
				NEW.WEEK_MIN = WFP.DATE_START
				NEW.WEEK_MAX = WFP.DATE_END
				NEW.WEEK = STRMID(WFP.PERIOD,6,2)
				NEW.DATA_MIN = WKS.MIN
				NEW.DATA_MAX = WKS.MAX
				NEW.DATA_MEAN = WKS.MEAN
				DATE = YDOY_2DATE('2020',DATE_2DOY(NEW.WEEK_MIN)+3)


				OK = WHERE(TT.SUBAREA_CODE EQ CODES(CTH) AND STRMID(TT.FIRST_NAME,0,5) EQ '!YEAR')
				NEW.ALL_MEAN	= TT[OK].MEAN

				YSET = WHERE_SETS(MFP.YEAR_START)
				YSET = YSET[SORT(YSET.VALUE)]
				POS = WHERE(TAGS EQ 'DATA_98')
				CT = 0
				FOR YTH = 0L, N_ELEMENTS(YSET) -1  DO BEGIN
					SUBS = WHERE_SETS_SUBS(YSET(YTH))
					YR = MONS(SUBS)
					YFP = MFP(SUBS)
					WK = STRMID(YFP.PERIOD,7,2)
					OK = WHERE_MATCH(NEW.WEEK,WK,COUNT,VALID=VALID,COMPLEMENT=COMPLEMENT,NCOMPLEMENT=NCOMPLEMENT)
					NEW[OK].(POS+CT) = YR(VALID).MEAN
					CT = CT + 1
				ENDFOR

				IF PRODS(PTH) EQ 'PPD' THEN BEGIN
					IF CTH EQ 0 OR CTH EQ N_ELEMENTS(CODES)-1 THEN YTITLE = PTITLE ELSE YTITLE = ' '
					IF CTH EQ N_ELEMENTS(CODES)-1 THEN XTICKNAME = AX2.TICKNAME ELSE XTICKNAME = X2TICKNAME
					PLOT, AX2.JD,RP, YTITLE=YTITLE,YRANGE=RP,/XSTYLE,/YSTYLE,XMARGIN=XMARGIN,YMARGIN=YMARGIN,YTICKS=PYTICKS,YMINOR=PYMINOR,$
						XTICKS=AX2.TICKS,XTICKNAME=XTICKNAME,XTICKV=AX2.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
					YY = [NEW.DATA_MAX,REVERSE(NEW.DATA_MIN)]
					XX = [DATE,REVERSE(DATE)]
					POLYFILL, DATE_2JD(XX), YY, COLOR = 35
					POS = WHERE(TAGS EQ 'DATA_98')
					FOR YTH = 0L, N_ELEMENTS(YEARS)-1  DO BEGIN
						OK = WHERE(NEW.(POS) NE MISSINGS(0.0))
						OPLOT, DATE_2JD(DATE[OK]),NEW[OK].(POS),THICK=3,PSYM=-8,SYMSIZE=SYMSIZE,COLOR=COLORS(YTH)
						YEAR = YEARS(YTH)
						IF YTH EQ 0 THEN TXT = STRTRIM(YEAR,2) ELSE TXT = [TXT,STRTRIM(YEAR,2)]
						POS = POS + 1
					ENDFOR
					TXT = [TXT,'Mean']
					OPLOT, DATE_2JD(DATE),NEW.DATA_MEAN, COLOR = 0, THICK = 8
					IF CTH EQ 0 OR CTH EQ N_ELEMENTS(CODES)-1 THEN LEG,pos=LEG_POS,color=[COLORS,0],label=TXT,THICK=THICK,LSIZE=1,FONT=FONT

				;	OK = WHERE(S.SUB_AREA_CODE EQ CODES(CTH) AND S.YEAR EQ '1998_2003')
				;	TOT = STRMID(STRTRIM(S[OK].ANN_PROD_MEAN,2),0,3)
					LABEL = REGIONS(CTH) + '!CMean = ' + STRMID(NUM2STR(NEW[0].ALL_MEAN),0,4) + ' gC m!E-2!N day!E-1!N'; + '!C Total = ' + TOT + ' gC m!E-2!N'
					COOR = COORD_2PLOT(0.62,0.84)
					XYOUTS, COOR.X,COOR.Y,LABEL, ALIGN=-0.1, CHARSIZE=1.35, COLOR=0, CHARTHICK=1
				ENDIF
			ENDFOR
		ENDFOR


;		***** MAKE PHYTOPLANKTON PLOTS *****
		X  = DATE_2JD([19980101,20070101]) & AX  = DATE_AXIS(X,/MONTH, STEP_SIZE=4) & AYR = DATE_AXIS(X,/YEAR)
		XTICKNAMES = REPLICATE(' ',N_ELEMENTS(AX.TICKNAME))
		OK  			 = WHERE(STRMID(PHYTO.DATE,0,4) GE 1998 AND STRMID(PHYTO.DATE,0,4) LE 2006 AND PHYTO.LOCATION NE MISSINGS('') AND PHYTO.LOCATION NE 'HARBOR')
		PHYTO   	 = PHYTO[OK]

		PY = [0,5]
		XMARGIN = [0,4]
		POS = [0.74 ,0.5,0.78,0.9]
		!Y.OMARGIN = [1,0]
		!X.OMARGIN = [0,1]
		GROUPS = ['TOTAL_DIATOMS','MICROFLAGELLATES','DINOFLAGELLATES','OTHER','PHAEOCYSTIS']
		GPS = ['Diatoms','Microflagellates','Dinoflagellates','Other','Phaeocystis']
		LGD = 			GPS[0]
		LGD = [LGD, GPS[1]]
		LGD = [LGD, GPS(2)]
		LGD = [LGD, GPS(3)]
		LGD = [LGD, GPS(4)]
		LGD2 = 'Total Phytoplankton'
		PHTITLE = 'Total Phytoplankton!C!C(Cells L!U-1!N x 10!U6!N)'
		COLORS = [12,34,19,9,22]
		CIR = DRAW_CIRCLE(0,0,1,49)
		USERSYM, CIR(0,*),CIR(1,*),THICK=3,/FILL
		SYMSIZE=1.25
		!P.MULTI = [0,1,2]
		CHARSIZE = 1.25

		LOCATIONS = ['WEST_SHORE','CAPE_COD']
		REGS = [' West Shore',' Cape Cod Bay']
		OK = WHERE(PHYTO.SURFACE NE MISSINGS(''))
		SURF = PHYTO[OK]
		FOR NTH =0L, N_ELEMENTS(LOCATIONS)-1 DO BEGIN
			OK = WHERE(SURF.LOCATION EQ LOCATIONS[NTH] AND SURF.STATION NE 'F19',COUNT)
			IF LOCATIONS[NTH] EQ 'NORTH_SHORE' THEN OK = WHERE(SURF.LOCATION EQ LOCATIONS[NTH] OR SURF.STATION EQ 'F27')
			IF COUNT GE 30 THEN BEGIN
				SP  = SURF[OK]
				DD = WHERE_SETS(SP.EVENT)
				NEW = CREATE_STRUCT('EVENT','','DATE','','DEPTH',0.0,'N',0L,'TOTAL',0.0,'TOTAL_DIATOMS',0.0,'MICROFLAGELLATES',0.0,'DINOFLAGELLATES',0.0,'OTHER',0.0,'PHAEOCYSTIS',0.0)
				NEW = STRUCT_2MISSINGS(NEW)
				NEW = REPLICATE(NEW,N_ELEMENTS(DD))
				NAMES = TAG_NAMES(NEW)
				FOR DTH = 0L, N_ELEMENTS(DD)-1 DO BEGIN
					SUBS = WHERE_SETS_SUBS(DD(DTH))
					SPD = SP(SUBS)
					NEW(DTH).EVENT = DD(DTH).VALUE
					NEW(DTH).DATE = JD_2DATE(MEAN(DATE_2JD(SPD.DATE)))
					NEW(DTH).N = DD(DTH).N
					NEW(DTH).DEPTH = MEAN(SPD.DEPTH)
					NEW(DTH).TOTAL = MEAN(SPD.TOTAL)
					NEW(DTH).TOTAL_DIATOMS = MEAN(SPD.TOTAL_DIATOMS)
					NEW(DTH).MICROFLAGELLATES = MEAN(SPD.MICROFLAGELLATES)
					NEW(DTH).DINOFLAGELLATES = MEAN(SPD.DINOFLAGELLATES)
					NEW(DTH).OTHER = MEAN(SPD.OTHER)
					NEW(DTH).PHAEOCYSTIS = MEAN(SPD.PHAEOCYSTIS)
				ENDFOR
				NEW = NEW[SORT(NEW.DATE)]

				PDATE = DATE_2JD(NEW.DATE)
				YY = REPLICATE(8000,N_ELEMENTS(PDATE))
				AVEDEPTH = MEAN(NEW.DEPTH)
				PDEPTH = NEW.DEPTH
				TOT = NEW.TOTAL
				BOTTOM = 0
				PER1 = REPLICATE(0,N_ELEMENTS(NEW))
				XP = FINDGEN(N_ELEMENTS(NEW))
				FOR PTH = 0L, N_ELEMENTS(GROUPS) -1 DO BEGIN
					GROUP = GROUPS(PTH)
					POS = WHERE(NAMES EQ GROUP,COUNT)
					IF COUNT EQ 1 THEN PHY = NEW.(POS) ELSE STOP
					PER = (PHY/TOT)*100
					OK = WHERE(PHY EQ MISSINGS(0.0),COUNT) & IF COUNT GE 1 THEN PER[OK] = 0
					IF PTH EQ 0 THEN BEGIN
						IF NTH EQ N_ELEMENTS(LOCATIONS)-1 THEN XTICKNAME = AX.TICKNAME ELSE XTICKNAME = XTICKNAMES
						IF NTH EQ 0 OR NTH EQ N_ELEMENTS(LOCATIONS)-1 THEN YTITLE='Percent Composition (%)' ELSE YTITLE = ' '
						PLOT, AX.JD, PY,YTITLE=YTITLE,YRANGE=[0,100],/XSTYLE,YSTYLE=8,XMARGIN=XMARGIN,YMARGIN=YMARGIN,$
							XTICKS=AX.TICKS,XTICKNAME=XTICKNAME,XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
							BOT = REPLICATE(0, N_ELEMENTS(PER))
							YY = [PER,BOT]
							XX = [PDATE,REVERSE(PDATE)]
							POLYFILL, XX, YY, COLOR = COLORS(PTH)
					ENDIF
					PER1 = PER + PER1
					YY = [PER1,REVERSE(BOTTOM)]
					XX = [PDATE,REVERSE(PDATE)]
					IF PTH GE 1 THEN POLYFILL, XX, YY, COLOR = COLORS(PTH)
					BOTTOM = PER1
				ENDFOR
				GRIDS,X=AYR.TICKV, /NO_Y
				AXIS,XAXIS=0, XRANGE=AX.JD, CHARSIZE=CHARSIZE,XTICKS=N_ELEMENTS(AX.TICKV),XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,XTICKNAME=REPLICATE(' ',N_ELEMENTS(XTICKNAME)),COLOR=0,XTICKLEN=0.05
				AXIS,XAXIS=1, XRANGE=AX.JD, CHARSIZE=CHARSIZE,XTICKS=N_ELEMENTS(AX.TICKV),XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,XTICKNAME=REPLICATE(' ',N_ELEMENTS(XTICKNAME)),COLOR=0,XTICKLEN=0.05
				CIR = DRAW_CIRCLE(0,0,1,49)
				USERSYM, CIR(0,*),CIR(1,*),THICK=3,/FILL
				IF NTH EQ 0 OR NTH EQ N_ELEMENTS(LOCATIONS)-1 THEN Y2TITLE = PHTITLE ELSE Y2TITLE = ' '
				AXIS,YAXIS=1,YRANGE=[0,10],/SAVE, YTITLE=Y2TITLE ,CHARSIZE=CHARSIZE
				OPLOT, PDATE,TOT/1000,COLOR=0,THICK=4,LINESTYLE=0,PSYM=-8,SYMSIZE=SYMSIZE
				LAB = REGS[NTH] ;+ '!CMean Depth = ' + STRMID(STRTRIM(AVEDEPTH,2),0,4) + ' m'
				COOR = COORD_2PLOT(0.01,0.85)
				XYOUTS, COOR.X,COOR.Y,LAB, ALIGN=-0.1, CHARSIZE=1.5, COLOR=0, CHARTHICK=1
				IF NTH EQ N_ELEMENTS(LOCATIONS)-1 THEN BEGIN
					LGD = ['Diatoms','Microflagellates','Dinoflagellates','Other','Phaeocystis']
					USERSYM, [-3.5,1.5,1.5,-3.5],[-1.3,-1.3,1.7,1.7],THICK=3,/FILL
					LEGEND,LGD,POSITION=[0.02,-0.05],/NORMAL,BOX=0,/HORIZONTAL,PSYM=8,CHARSIZE=1.25,COLOR=COLORS
					CIR = DRAW_CIRCLE(0,0,1,49)
					USERSYM, CIR(0,*),CIR(1,*),THICK=3,/FILL
					LEGEND,LGD2,POSITION=[0.735,-0.05],/NORMAL,BOX=0,/HORIZONTAL,PSYM=8,CHARSIZE=1.25,COLOR=0,THICK=8,NUM=1

;					LEGEND,LGD(0:2),POSITION=[0.025,-0.03],/NORMAL,BOX=0,/HORIZONTAL,PSYM=8,CHARSIZE=1.25,COLOR=COLORS(0:2)
;					LEGEND,LGD(3:4),POSITION=[0.055,-0.059],/NORMAL,BOX=0,/HORIZONTAL,PSYM=8,CHARSIZE=1.25,COLOR=COLORS(3:4)
;					CIR = DRAW_CIRCLE(0,0,1,49)
;					USERSYM, CIR(0,*),CIR(1,*),THICK=3,/FILL
;					LEGEND,LGD2,POSITION=[0.29,-0.059],/NORMAL,BOX=0,/HORIZONTAL,PSYM=8,CHARSIZE=1.25,COLOR=0,THICK=8,NUM=1
				ENDIF
			ENDIF
		ENDFOR

		!X.OMARGIN = [0,0]


		CODES = [3,4]
		REGIONS = ['  Western Shore','  Cape Cod Bay']
;		***** MAKE TIME ANOMALY PLOTS *****
		FOR PTH = 0L, N_ELEMENTS(PRODS)-1 DO BEGIN
			IF PRODS(PTH) EQ 'CHLOR_A' THEN TT = REG_ANOM_CHL
			IF PRODS(PTH) EQ 'PPD'     THEN TT = REG_ANOM_PPD
			OK = WHERE(STRMID(TT.FIRST_NAME,0,3) EQ '!D_')
			T = TT[OK]
			TFP = PARSE_IT(T.FIRST_NAME,/ALL)
			!P.MULTI = [0,1,24]
			FOR CTH = 0L, N_ELEMENTS(CODES)-1 DO BEGIN
				OK = WHERE(T.SUBAREA_CODE EQ CODES(CTH) AND TFP.PERIOD_CODE EQ '!D' AND STRPOS(T.ANOM_RATIO,'!YEAR') NE -1 AND TFP.YEAR_START GE '1998' AND TFP.YEAR_END LE '2006')
				MONS = T[OK]
				MFP = TFP[OK]
				YSET = WHERE_SETS(MFP.YEAR_START)
				MAXDEPTH = 1
				DEPTHS = 3
				ND = N_ELEMENTS(DEPTHS)
				YRANGE = [-MAXDEPTH,0]
				MINDATE = 20200101000000
				MAXDATE = 20210101000000
				AXC2 = DATE_AXIS([MINDATE,MAXDATE], /FYEAR)
				X2TICKNAME = REPLICATE(' ',N_ELEMENTS(AXC2.TICKNAME))
				PAL_RATIO ,R,G,B
				YTICKNAMES=[' ',' ',' ']
				CHARSIZE2 = 2.5
				VRANGE=[0.1,10]

				FOR YTH = 0L, N_ELEMENTS(YSET)-1 DO BEGIN
					SUBS = WHERE_SETS_SUBS(YSET(YTH))
					YRSET = MONS(SUBS)
					YFP = MFP(SUBS)
					DATA = YRSET.ANOM
					DATE = YDOY_2DATE('2020',DATE_2DOY(YFP.DATE_START))
					DEPTH = REPLICATE(0.5,N_ELEMENTS(DATA))

					IF PRODS(PTH) EQ 'CHLOR_A' THEN BEGIN
						OK = WHERE(REG_STAT_CHL.SUBAREA_CODE EQ CODES(CTH) AND STRMID(REG_STAT_CHL.FIRST_NAME,0,5) EQ '!YEAR',COUNT)
						IF COUNT EQ 1 THEN ME = STRMID(NUM2STR(REG_STAT_CHL[OK].MEAN),0,4) ELSE STOP
						LABEL2 = 'Mean = ' + ME + ' mg m!E-3!N'
					ENDIF
					IF PRODS(PTH) EQ 'PPD' THEN BEGIN
						OK = WHERE(REG_STAT_PPD.SUBAREA_CODE EQ CODES(CTH) AND STRMID(REG_STAT_PPD.FIRST_NAME,0,5) EQ '!YEAR',COUNT)
						IF COUNT EQ 1 THEN ME = STRMID(NUM2STR(REG_STAT_PPD[OK].MEAN),0,4) ELSE STOP
						LABEL2 = 'Mean = ' + ME + ' mg m!E-2!N d!E-1!N'
					ENDIF

					IF YTH EQ 0 THEN BEGIN
						PLOT,AXC2.JD,[0,1],YSTYLE=1,XMARGIN=[4,8],YMARGIN=[0,0],YTICKS=1,YMINOR=0,YTICKNAME=YTICKNAMES,XTICKNAME=X2TICKNAME,/NODATA,CHARSIZE=CHARSIZE2
						LABEL = REGIONS(CTH)
						COOR = COORD_2PLOT(-0.01,0.2)
						XYOUTS, COOR.X,COOR.Y,LABEL, ALIGN=-0.1, CHARSIZE=1.5, COLOR=0, CHARTHICK=1
						COOR = COORD_2PLOT(0.65,0.2)
						XYOUTS, COOR.X,COOR.Y,LABEL2, ALIGN=-0.1, CHARSIZE=1.5, COLOR=0, CHARTHICK=1
					ENDIF
					X2MARGIN = [4,8]
					Y2MARGIN = [0,0]
					OK = WHERE(YRSET.ANOM NE MISSINGS(0.0))
					IF CTH EQ N_ELEMENTS(CODES)-1 AND YTH EQ N_ELEMENTS(YSET)-1 THEN $
					TIME_DEPTH_GRID,DATE[OK],DEPTH[OK],DATA[OK],/LOG,DEPTH_INTERVAL=0.5,MDATE=[MINDATE,MAXDATE],MDEPTH=[MAXDEPTH,0],VRANGE=VRANGE,CUTOFF=[1,0],YTICKS=1,YTICKNAME=[' ',' ',' '],$
						/NODEPTH,DIMENSIONS=[500,50],AX_INTERVAL='MONTH',AY_GRID='YEAR',/FYEAR,YTITLE=' ',YMARGIN=Y2MARGIN,XMARGIN=X2MARGIN,CHARSIZE=CHARSIZE2,/INTERPOLATE,YMINOR=0 $
					ELSE $
					TIME_DEPTH_GRID,DATE[OK],DEPTH[OK],DATA[OK],/LOG,DEPTH_INTERVAL=0.5,MDATE=[MINDATE,MAXDATE],MDEPTH=[MAXDEPTH,0],VRANGE=VRANGE,CUTOFF=[1,0],YTICKS=1,YTICKNAME=[' ',' ',' '],$
						/NODEPTH,DIMENSIONS=[500,50],AX_INTERVAL='MONTH',AY_GRID='YEAR',/FYEAR,YTITLE=' ',YMARGIN=Y2MARGIN,XMARGIN=X2MARGIN,CHARSIZE=CHARSIZE2,/INTERPOLATE,YMINOR=0,/NOXDATES
					LABEL = YSET(YTH).VALUE
					COOR = COORD_2PLOT(-0.1,0.3)
					XYOUTS, COOR.X,COOR.Y,LABEL, ALIGN=-0.1, CHARSIZE=1.5, COLOR=0, CHARTHICK=1
				ENDFOR
				IF CTH EQ N_ELEMENTS(CODES)-1 THEN $
					;COLORBAR,BOTTOM=2, NCOLORS=248,POSITION=[0, 0.94, 1, 0.96],/VERTICAL,/RIGHT,DIVISIONS=6,RANGE=[0.1,10],TICKNAMES=['0.1','0.25','0.45','1','2','4.5','10'],/YLOG,MINOR=0, FORMAT='(F10.2)',charsize=2,FONT=FONT
					BAR=COLOR_BAR_SCALE(POSITION=[0.92, 0.17, 0.945, 0.998],PAL='PAL_RATIO',CHARSIZE=2.25,$
							MINVAL=ALOG10(0.1),MAXVAL=ALOG10(10),MINCOLOR=1,MAXCOLOR=250,YTICKS=7,/YLOG,YTICKV=[0.25,0.5,1,1.75,5,10],YTICKNAME=['0.25','0.5','1','1.75','5','10'],/VERTICAL)
			ENDFOR
		ENDFOR
		PAL_36,R,G,B


		PSPRINT



		STOP
		SKIP_ERF:
	ENDIF ;IF DO_ERF_FIGURES GE 1 THEN BEGIN

; *******************************************************
	IF DO_FINAL_FIGURES GE 1 THEN BEGIN
; *******************************************************
		OVERWRITE = DO_FINAL_FIGURES GE 2
		EXIST = FILE_TEST(FINAL_LANDSCAPE)
		IF EXIST AND OVERWRITE EQ 0 THEN GOTO, SKIP_FINAL  ; >>>>>>>>>>>>>>>>>>>>>>>>>

		E   = IDL_RESTORE(ENV_DATA)
		D   = IDL_RESTORE(INSITU_DATA)
		SC  = IDL_RESTORE(DIR_SUBAREA_STATS + '!S-MASK_SUBAREA-MASS_BAY-PXY_160_160-REGIONS_HYDE-REPRO5-CHLOR_A-MB-STATS.SAVE')
		SP  = IDL_RESTORE(DIR_SUBAREA_STATS + '!D-MASK_SUBAREA-MASS_BAY-PXY_160_160-REGIONS_HYDE-REPRO5-PPD-VGMB-STATS.SAVE')
		AC  = IDL_RESTORE(DIR_SUBAREA_ANOMS + '!S-MASK_SUBAREA-MASS_BAY-PXY_160_160-REGIONS_HYDE-REPRO5-CHLOR_A-MB-ANOMS.SAVE')
		AP  = IDL_RESTORE(DIR_SUBAREA_ANOMS + '!D-MASK_SUBAREA-MASS_BAY-PXY_160_160-REGIONS_HYDE-REPRO5-PPD-VGMB-ANOMS.SAVE')
		ANN = IDL_RESTORE(DIR_SUBAREA_STATS + '!D-MASK_SUBAREA-MASS_BAY-PXY_160_160-REGIONS_HYDE-REPRO5-PPD-VGMB-STATS-ANNUAL.SAVE')
		MB_STAT_CHL  	= IDL_RESTORE(DIR_SUBAREA_STATS + '!S-MASK_SUBAREA-MASS_BAY-PXY_160_160-MB_CCB_COMBO_HYDE-REPRO5-CHLOR_A-MB-STATS.SAVE')
		MB_STAT_PPD  	= IDL_RESTORE(DIR_SUBAREA_STATS + '!D-MASK_SUBAREA-MASS_BAY-PXY_160_160-MB_CCB_COMBO_HYDE-REPRO5-PPD-VGMB-STATS.SAVE')
		MB_ANOM_CHL  	= IDL_RESTORE(DIR_SUBAREA_ANOMS + '!S-MASK_SUBAREA-MASS_BAY-PXY_160_160-MB_CCB_COMBO_HYDE-REPRO5-CHLOR_A-MB-ANOMS.SAVE')
		MB_ANOM_PPD  	= IDL_RESTORE(DIR_SUBAREA_ANOMS + '!D-MASK_SUBAREA-MASS_BAY-PXY_160_160-MB_CCB_COMBO_HYDE-REPRO5-PPD-VGMB-ANOMS.SAVE')
		P   = IDL_RESTORE(PHYTO_FILE)
		OK  = WHERE(STRMID(P.DATE,0,4) GE 1998 AND STRMID(P.DATE,0,4) LE 2006 AND P.LOCATION NE MISSINGS('') AND P.LOCATION NE 'HARBOR')
		P   = P[OK]
;		BY = IDL_RESTORE(BUOY_8DAY)
;		OK = WHERE(STRMID(BY.DATE,0,4) GE 1998 AND STRMID(BY.DATE,0,4) LE 2006)
;		BY = BY[OK]

		Z = IDL_RESTORE(ZOO_FILE)

		X = DATE_2JD([19980101,20070101])
		AX = DATE_AXIS(X,/MONTH, STEP_SIZE=4)
		AYR = DATE_AXIS(X,/YEAR)
		X2 = DATE_2JD([20200101,20210101])
		AX2 = DATE_AXIS(X2, /FYEAR)
		XS = DATE_2JD([20200501,20200901])
		AXS = DATE_AXIS(XS, /FYEAR)
		NX = DATE_2JD([19960101,20030401])
		NAX = DATE_AXIS(NX,/MONTH)
		XTICKNAMES = REPLICATE(' ',N_ELEMENTS(AX.TICKNAME))
		X2TICKNAME = REPLICATE(' ',N_ELEMENTS(AX2.TICKNAME))
		PYMINOR=10
		CTITLE = 'Chlorophyll !8a!7 (mg m!E-3!N)'
		PTITLE = 'Production (gC m!E-2!N d!E-1!N)'
		STITLE = 'Temperature (!Eo!NC)
		RTITLE = 'PAR'
		LEG_POS = [0.028 ,0.32,0.045,0.92]
		YMARGIN = [0.3,0.3]
		XMARGIN = [4,1]
	;	!Y.OMARGIN = [11,1]
		CHARSIZE = 2.5
		SYMSIZE = 0.45
		THICK = 2
		FONT = 0
		CIR = DRAW_CIRCLE(0,0,1,49)
		;CIRCLE,32, COLOR=32
		USERSYM, CIR(0,*),CIR(1,*),THICK=3,/FILL
		PSYM = 8
		COLORS = [2,7,10,13,22,19]

		PSPRINT,FILENAME=FINAL_LANDSCAPE,/COLOR,/Full,/TIMES,/LANDSCAPE

;		WINDS
		!P.MULTI = [0,2,2]
		OK = WHERE(STRMID(E.DATE,0,8) GE '20000615' AND STRMID(E.DATE,0,8) LE '20000701',COUNT)
		DIR = E[OK].WIND_DIR
		SP = E[OK].WIND_SPEED
		AD = 360 - (DIR - 90)
		!P.THICK=4
		PLOT, /POLAR, SP, !DTOR * DIR,XRANGE=[-10,10],YRANGE=[-10,10],XSTYLE=1,YSTYLE=1,XTICKS=4,YTICKS=4,XMINOR=5,YMINOR=5,CHARSIZE=2,$
			XMARGIN=[6,6],YMARGIN=[0.25,0.25],/NODATA,COLOR=0,THICK=2,BACKGROUND=255
		FOR NTH=0L, N_ELEMENTS(SP)-1 DO BEGIN
			OPLOT, [0,SP[NTH]],[0,!DTOR*AD[NTH]], COLOR=0,SYMSIZE=0.25, PSYM=-2,/POLAR
		ENDFOR
		OPLOT,[0,0],[-8,8],COLOR=0,THICK=3
		OPLOT,[-8,8],[0,0],COLOR=0,THICK=3
		n_circ=[0.5,1.0]
		!P.THICK=2
	 	PlotS, DRAW_CIRCLE(0, 0, 4,361)
	 	TXT = '4 ms!U-1!N'
	 	COOR = COORD_2PLOT(0.62,0.53)
		XYOUTS, COOR.X,COOR.Y,TXT, ALIGN=-0.1, CHARSIZE=1.35, COLOR=0, CHARTHICK=1
	 	!P.THICK=3
	 	PlotS, DRAW_CIRCLE(0, 0, 8,361)
	 	TXT = '8 ms!U-1!N'
	 	COOR = COORD_2PLOT(0.78,0.3)
		XYOUTS, COOR.X,COOR.Y,TXT, ALIGN=-0.1, CHARSIZE=1.35, COLOR=0, CHARTHICK=1
	 	!P.THICK=1


		!P.MULTI = [0,2,2]
		OK = WHERE(STRMID(E.DATE,0,8) GE '19980601' AND STRMID(E.DATE,0,8) LE '20061030',COUNT)
		EE = E[OK]
		YEARS = ['1998','1999','2000','2001','2002','2003','2004','2005','2006']
		MONTHS = ['06','07','08','09']
		FOR YTH = 0L, N_ELEMENTS(YEARS)-1 DO BEGIN
			AYEAR = YEARS(YTH)
			FOR MTH = 0L, N_ELEMENTS(MONTHS)-1 DO BEGIN
				AMONTH = MONTHS(MTH)
				OK = WHERE(STRMID(EE.DATE,0,4) EQ AYEAR)
				OK = WHERE(STRMID(EE.DATE,0,4) EQ AYEAR AND STRMID(EE.DATE,4,2) EQ AMONTH)
				DIR = EE[OK].WIND_DIR
				WSP = EE[OK].WIND_SPEED
				OK = WHERE(WSP GT 4,COUNT) & PRINT, COUNT
				AD = 360 - (DIR - 90)
				!P.THICK=4
				PLOT, /POLAR, WSP, !DTOR * DIR,XRANGE=[-10,10],YRANGE=[-10,10],XSTYLE=1,YSTYLE=1,XTICKS=4,YTICKS=4,XMINOR=5,YMINOR=5,CHARSIZE=2,$
					XMARGIN=[6,6],YMARGIN=[0.25,0.25],/NODATA,COLOR=0,THICK=2,BACKGROUND=255
				FOR NTH=0L, N_ELEMENTS(WSP)-1 DO BEGIN
					OPLOT, [0,WSP[NTH]],[0,!DTOR*AD[NTH]], COLOR=0,SYMSIZE=0.25, PSYM=-2,/POLAR
				ENDFOR
				OPLOT,[0,0],[-8,8],COLOR=0,THICK=3
				OPLOT,[-8,8],[0,0],COLOR=0,THICK=3
				n_circ=[0.5,1.0]
				!P.THICK=2
			 	PLOTS, DRAW_CIRCLE(0, 0, 4,361)
			 	TXT = '4 ms!U-1!N'
			 	COOR = COORD_2PLOT(0.62,0.53)
				XYOUTS, COOR.X,COOR.Y,TXT, ALIGN=-0.1, CHARSIZE=1.35, COLOR=0, CHARTHICK=1
			 	!P.THICK=3
			 	PLOTS, DRAW_CIRCLE(0, 0, 8,361)
			 	TXT = '8  ms!U-1!N'
			 	COOR = COORD_2PLOT(0.78,0.3)
				XYOUTS, COOR.X,COOR.Y,TXT, ALIGN=-0.1, CHARSIZE=1.35, COLOR=0, CHARTHICK=1
			ENDFOR
		ENDFOR
	 	!P.THICK=1

		!P.MULTI = [0,1,1]
		COLORS = [14,22,4]
		COLORS = [35,0,32]
		YPOS = [0.75,0.95,0.55]
		PSYMS = [8,7,5]
		THICKS = [1,2,2]
		SEASONS = ['WSP','SUM','FAL']				; WIN-SP=JAN,FEB,MAR,APR,MAY  SUM=JUN,JUL,AUG  FALL=SEP,OCT,NOV,DEC
		SEA_NAME = ['Winter-spring','Summer','Fall']

;		PLOT, NEW.CHL_MEAN,NEW.PROD_MEAN,XRANGE=[0,2.5],YRANGE=[0,2.5],YTITLE='Productivity Anomaly', $
;				XTITLE='Chlorophyll !8a!7 Anomaly',CHARSIZE=1.5,/NODATA,ZMARGIN=[1,1],YMARGIN=YMARGIN
;		FOR STH = 0L, N_ELEMENTS(SEASONS)-1 DO BEGIN
;			ASEA = SEASONS(STH)
;			OK = WHERE(NEW.SEASON EQ ASEA)
;			CHL = NEW[OK].CHL_MEAN
;			PROD = NEW[OK].PROD_MEAN
;			STAT = STATS2(CHL,PROD,TYPE=4,/QUIET)
;			OPLOT,CHL,PROD,COLOR=COLORS(STH),PSYM=PSYMS(STH),SYMSIZE=1.5
;			CHL = CHL[SORT(CHL)]
;			OPLOT,CHL,STAT.INT + STAT.slope*CHL,COLOR=COLORS(STH),THICK=12,LINESTYLE=0
;			TXT = SEA_NAME(STH) + '!CSlope: ' + STRMID(STRTRIM(STRING(STAT.SLOPE),2),0,5) +  '!CIntercept: ' + STRMID(STRTRIM(STRING(STAT.INT),2),0,5) +  '!CR!E2!N: ' + STRMID(STRTRIM(STRING(STAT.RSQ),2),0,5)
;			COOR = COORD_2PLOT(0.02,YPOS(STH))
;			PLOTS, COOR.X-0.035, COOR.Y+0.025, PSYM=PSYMS(STH), COLOR=COLORS(STH), SYMSIZE=1.5
;			XYOUTS,COOR.X,COOR.Y,TXT,CHARSIZE=1.5,COLOR=COLORS(STH)
;		ENDFOR

		OK = WHERE(STRMID(AC.FIRST_NAME,0,4) EQ '!MM_' AND STRPOS(AC.ANOM_RATIO,'!YEAR') NE -1) & AAC = AC[OK] & CTAGS = TAG_NAMES(AAC); & FP_AAC = PARSE_IT(AAC.FIRST_NAME,/ALL)
		OK = WHERE(STRMID(AP.FIRST_NAME,0,4) EQ '!MM_' AND STRPOS(AP.ANOM_RATIO,'!YEAR') NE -1) & AAP = AP[OK] & PTAGS = TAG_NAMES(AAP); & FP_AAP = PARSE_IT(AAP.FIRST_NAME,/ALL)
		TAGNAMES = [CTAGS[1],CTAGS(2),CTAGS(3),CTAGS(4),CTAGS(5)]
		NEW = STRUCT_JOIN(AAC, AAP, TAGNAMES=TAGNAMES)
		FP = PARSE_IT(NEW.FIRST_NAME)

		PLOT, NEW.ANOM,NEW.ANOM$2,XRANGE=[0,2.5],YRANGE=[0,2.5],YTITLE='Production Anomaly', $
				XTITLE='Chlorophyll !8a!7 Anomaly',CHARSIZE=1.5,/NODATA,XMARGIN=[2,1],YMARGIN=YMARGIN

		FOR STH = 0L, N_ELEMENTS(SEASONS)-1 DO BEGIN
			ASEA = SEASONS(STH)
			OK = WHERE(STRPOS(NEW.FIRST_NAME,ASEA) NE -1 AND NEW.ANOM NE MISSINGS(0.0) AND NEW.ANOM$2 NE MISSINGS(0.0))
			CHL = NEW[OK].ANOM
			PROD = NEW[OK].ANOM$2
			STAT = STATS2(CHL,PROD,MODEL='RMA',/QUIET)
			OPLOT,CHL,PROD,COLOR=COLORS(STH),PSYM=PSYMS(STH),SYMSIZE=1.5,THICK=THICKS(STH)
			OPLOT,CHL,STAT.INT + STAT.slope*CHL,COLOR=COLORS(STH),THICK=12,LINESTYLE=0
			TXT = SEA_NAME(STH) + '!CSlope: ' + STRMID(STRTRIM(STRING(STAT.SLOPE),2),0,5) +  '!CIntercept: ' + STRMID(STRTRIM(STRING(STAT.INT),2),0,5) +  '!CR!E2!N: ' + STRMID(STRTRIM(STRING(STAT.RSQ),2),0,5)
			COOR = COORD_2PLOT(0.05,YPOS(STH))
			PLOTS, COOR.X-0.035, COOR.Y+0.025, PSYM=PSYMS(STH), COLOR=COLORS(STH), SYMSIZE=1.5, THICK=THICKS(STH)
			XYOUTS,COOR.X,COOR.Y,TXT,CHARSIZE=1.5,COLOR=0;COLORS(STH)
		ENDFOR

		!P.MULTI = [0,2,2]

;	===> ZOOPLANKTON VS TEMPERATURE VS CHLOROPHYLL PLOTS

		REGIONS = ['NORTH_SHORE','WEST_SHORE','EAST_MASS_BAY']
		YEARS = ['1995','1996','1997','1998','1999','2000','2001','2002','2003','2004','2005','2006']
		COLORS = [22,12,4,9,18,26,1,5,20]
		NEW = CREATE_STRUCT('YEAR','','REGION','','TEMP',0.0,'CHL',0.0,'ZOO',0.0)
		NEW = STRUCT_2MISSINGS(NEW)
		NEW = REPLICATE(NEW,N_ELEMENTS(YEARS)*N_ELEMENTS(REGIONS))
		CT = 0
		FOR RTH=0L, N_ELEMENTS(REGIONS)-1 DO BEGIN
			!P.MULTI = [0,2,2]
			FOR YTH = 0L, N_ELEMENTS(YEARS)-1 DO BEGIN
				NEW(CT).REGION = REGIONS(RTH)
				NEW(CT).YEAR = YEARS(YTH)
				OK = WHERE(Z.LOCATION EQ REGIONS(RTH) AND STRMID(Z.DATE,0,4) EQ YEARS(YTH) AND DATE_2DOY(Z.DATE) LT 91,COUNT)
				IF COUNT GE 1 THEN NEW(CT).ZOO = MEAN(Z[OK].TOTAL_ZOO)
				OK = WHERE(D.LOCATION EQ REGIONS(RTH) AND STRMID(D.GMT_DATE,0,4) EQ YEARS(YTH) AND DATE_2DOY(D.GMT_DATE) LT 91 AND D.MEAN_TEMP NE MISSINGS(0.0),COUNT)
				IF COUNT GE 1 THEN NEW(CT).TEMP = MEAN(D[OK].MEAN_TEMP)
				OK = WHERE(D.LOCATION EQ REGIONS(RTH) AND STRMID(D.GMT_DATE,0,4) EQ YEARS(YTH) AND DATE_2DOY(D.GMT_DATE) LT 91 AND D.MEAN_CHL NE MISSINGS(0.0),COUNT)
				IF COUNT GE 1 THEN NEW(CT).CHL = MEAN(D[OK].MEAN_CHL)
				CT = CT+1
			ENDFOR
		ENDFOR

		PLOTXY, NEW.TEMP,NEW.CHL,DECIMALS=3,/QUIET,TYPES=4,psym=psym,PARAMS=[2,4,3,8],XRANGE=[0,6],YRANGE=[0,10],STATS_CHARSIZE=STATS_CHARSIZE,XTITLE='Temperature (!Eo!NC)', $
			YTITLE='Chlorophyll !8a!7 (mg m!E-3!N)',SYM_COLOR=SYM_COLOR,THICK=2,SYMSIZE=1.5,REG_COLOR=0,REG_THICK=9,/GRID_NONE
			XYOUTS2,NEW.TEMP,NEW.CHL,NEW.YEAR,CHARSIZE=0.5, ALIGN=[1.5,1.5]
			OK = WHERE(NEW.YEAR	EQ '1998')
			OPLOT, NEW[OK].TEMP, NEW[OK].CHL,PSYM=8,SYMSIZE=1.5,COLOR=22
		PLOTXY, NEW.ZOO,NEW.TEMP,DECIMALS=3,/QUIET,TYPES=4,psym=psym,PARAMS=[2,4,3,8],XRANGE=[0,60],YRANGE=[0,6],STATS_CHARSIZE=STATS_CHARSIZE,XTITLE='Abundance', $
			YTITLE='Temperature (!Eo!NC)',SYM_COLOR=SYM_COLOR,THICK=2,SYMSIZE=1.5,REG_COLOR=0,REG_THICK=9,/GRID_NONE
			XYOUTS2,NEW.ZOO,NEW.TEMP,NEW.YEAR,CHARSIZE=0.5, ALIGN=[1.5,1.5]
			OK = WHERE(NEW.YEAR	EQ '1998')
			OPLOT, NEW[OK].ZOO, NEW[OK].TEMP,PSYM=8,SYMSIZE=1.5,COLOR=22
		PLOTXY, NEW.ZOO,NEW.CHL,DECIMALS=3,/QUIET,TYPES=4,psym=psym,PARAMS=[2,4,3,8],XRANGE=[0,60],YRANGE=[0,10],STATS_CHARSIZE=STATS_CHARSIZE,XTITLE='Abundance',$
			YTITLE='Chlorophyll !8a!7 (mg m!E-3!N)',SYM_COLOR=SYM_COLOR,THICK=2,SYMSIZE=1.5,REG_COLOR=0,REG_THICK=9,/GRID_NONE
			XYOUTS2,NEW.ZOO,NEW.CHL,NEW.YEAR,CHARSIZE=0.5, ALIGN=[1.5,1.5]
			OK = WHERE(NEW.YEAR	EQ '1998')
			OPLOT, NEW[OK].ZOO, NEW[OK].CHL,PSYM=8,SYMSIZE=1.5,COLOR=22

;		!P.MULTI = [0,1,3]
;		OK = WHERE(STRMID(NM.MONTH,0,4) GE '1996' AND STRMID(NM.MONTH,0,4) LT '2003')
;		NM = NM[OK]
;		NM = NM[SORT(NM.MONTH)]
;		DATE = DATE_2JD(NM.MONTH)
;		PLOT, NAX.JD,[0,2], YTITLE='NAO',YRANGE=[-5,5],/XSTYLE,/YSTYLE,XMARGIN=XMARGIN,YMARGIN=[3,3],YTICKS=3,YMINOR=4,$
;			XTICKS=NAX.TICKS,XTICKNAME=NAX.TICKNAME,XTICKV=NAX.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
;		FIL = TS_SMOOTH(NM.NAO,5)
;		PFIL = FIL
;		NFIL = FIL
;		OK = WHERE(PFIL LE 0) & PFIL[OK] = 0
;		OK = WHERE(NFIL GE 0) & NFIL[OK] = 0
;		OPLOT, DATE, FIL, COLOR=0, THICK=7
;		YY = [PFIL,REPLICATE(0,N_ELEMENTS(PFIL))]
;		XX = [DATE,REVERSE(DATE)]
;		POLYFILL, XX, YY, COLOR = 4
;		YY = [NFIL,REPLICATE(0,N_ELEMENTS(PFIL))]
;		XX = [DATE,REVERSE(DATE)]
;		POLYFILL, XX, YY, COLOR = 22
;			OPLOT, DATE, NM.NAO,COLOR=33,THICK=3
;		OPLOT, NAX.JD,[0,0],COLOR=0,THICK=3
;		OK = WHERE(NW.YEAR GE '1996' AND NW.YEAR LT '2003')
;		DATES = DATE_2JD(NW[OK].YEAR + '0214')
;		OPLOT, DATES, NW[OK].NAO, PSYM=8, SYMSIZE=2, COLOR=12
;
;		PLOT,AX.JD,[-10,10],YTITLE='',YRANGE=[-15,15],/XSTYLE,/YSTYLE,YMARGIN=[3,3],XMARGIN=XMARGIN,$
;			XTICKS=AX.TICKS,XTICKNAME=AX.TICKNAME,XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
;		OK = WHERE(E.WIND_NORTH NE MISSINGS(0.0))
;		WINDN = E[OK].WIND_NORTH
;		WDATE = DATE_2JD(E[OK].DATE)
;		OPLOT, WDATE,WINDN, COLOR=33, THICK=2
;		FIL = TS_SMOOTH(WINDN,15)
;		OPLOT, WDATE,FIL,COLOR=0,THICK=8
;		PFIL = FIL & OK = WHERE(PFIL LE 0) & PFIL[OK] = 0
;		YY = [PFIL,REPLICATE(0,N_ELEMENTS(PFIL))]
;		XX = [WDATE,REVERSE(WDATE)]
;		POLYFILL, XX, YY, COLOR = 4
;		PFIL = FIL & OK = WHERE(PFIL GE 0) & PFIL[OK] = 0
;		YY = [PFIL,REPLICATE(0,N_ELEMENTS(PFIL))]
;		XX = [WDATE,REVERSE(WDATE)]
;		POLYFILL, XX, YY, COLOR = 22
;;		TXT = [TXT,'Mean']
;		OPLOT, AX.JD,[0,0],COLOR=0,THICK=5
;;		LEG,pos=[0.028,0.47,0.045,0.92],color=[COLORS,0],label=TXT,THICK=8,LSIZE=1.25,FONT=FONT

;		!P.MULTI = [0,1,3]
;		CODES = 10
;		OK = WHERE(T.REGION_CODE EQ CODES AND STRMID(T.FILENAME,0,2) EQ 'D8' AND STRMID(T.FILENAME,3,4) GE '1998' AND STRMID(T.FILENAME,3,4) LE '2003')
;		MONS = T[OK]
;		NEW = CREATE_STRUCT('DATE_MIN',0L,'DATE_MAX',0L,'DATE','','CHL_MIN',0.0,'CHL_MAX',0.0,'CHL_MEAN',0.0,'CHL_STD',0.0,'CHL_CV',0.0,$
;					'PROD_MIN',0.0,'PROD_MAX',0.0,'PROD_MEAN',0.0,'PROD_STD',0.0,'PROD_CV',0.0,'PAR_MIN',0.0,'PAR_MAX',0.0,'PAR_MEAN',0.0,'PAR_STD',0.0,'PAR_CV',0.0,$
;					'SST_MIN',0.0,'SST_MAX',0.0,'SST_MEAN',0.0,'SST_STD',0.0,'SST_CV',0.0,'WIND_MIN',0.0,'WIND_MAX',0.0,'WIND_MEAN',0.0,$
;					'CHL1',0.0,'N1',0L,'CHL2',0.0,'N2',0L,'CHL3',0.0,'N3',0L,'CHL4',0.0,'N4',0L,'CHL5',0.0,'N5',0L,'CHL6',0.0,'N6',0L, $
;					'PROD1',0.0,'NP1',0L,'PROD2',0.0,'NP2',0L,'PROD3',0.0,'NP3',0L,'PROD4',0.0,'NP4',0L,'PROD5',0.0,'NP5',0L,'PROD6',0.0,'NP6',0L,$
;					'PAR1',0.0,'NR1',0L,'PAR2',0.0,'NR2',0L,'PAR3',0.0,'NR3',0L,'PAR4',0.0,'NR4',0L,'PAR5',0.0,'NR5',0L,'PAR6',0.0,'NR6',0L,$
;					'SST1',0.0,'NS1',0L,'SST2',0.0,'NS2',0L,'SST3',0.0,'NS3',0L,'SST4',0.0,'NS4',0L,'SST5',0.0,'NS5',0L,'SST6',0.0,'NS6',0L,$
;					'WIND1',0.0,'NW1',0L,'WIND2',0.0,'NW2',0L,'WIND3',0.0,'NW3',0L,'WIND4',0.0,'NW4',0L,'WIND5',0.0,'NW5',0L,'WIND6',0.0,'NW6',0L)
;		NEW = STRUCT_2MISSINGS(NEW)
;		NEW = REPLICATE(NEW, 46)
;		DOY = LONG(DATE_2DOY(19980101))
;		CT = 0
;		FOR NTH = 0L, N_ELEMENTS(NEW)-1 DO BEGIN
;			NEW[NTH].DATE_MIN = DOY + CT
;			NEW[NTH].DATE_MAX = DOY + CT + 7
;			YSET = WHERE_SETS(STRMID(MONS.FILENAME,3,4))
;			YSET = YSET[SORT(YSET.VALUE)]
;			YWSET = WHERE_SETS(STRMID(BY.DATE,0,4))
;			YWSET = YWSET[SORT(YWSET.VALUE)]
;			TAGS = TAG_NAMES(NEW)
;			OK = WHERE(TAGS EQ 'CHL1')
;			POS = OK
;			FOR YTH = 0L, N_ELEMENTS(YSET) -1  DO BEGIN
;				SUBS = WHERE_SETS_SUBS(YSET(YTH))
;				YR = MONS(SUBS)
;				YEAR = STRMID(YR[0].FILENAME,3,4)
;				DY = DATE_2DOY(STRMID(YR.FILENAME,3,8)) - 3
;				OK = WHERE(DY GE NEW[NTH].DATE_MIN AND DY LE NEW[NTH].DATE_MAX,COUNT)
;				IF COUNT GE 1 THEN NEW[NTH].(POS) = MEAN(YR[OK].CHL_MEAN)
;				NEW[NTH].(POS + 1) = COUNT
;				POS = POS + 2
;			ENDFOR
;			OK = WHERE(TAGS EQ 'PROD1')
;			POS = OK
;			FOR YTH = 0L, N_ELEMENTS(YSET) -1  DO BEGIN
;				SUBS = WHERE_SETS_SUBS(YSET(YTH))
;				YR = MONS(SUBS)
;				YEAR = STRMID(YR[0].FILENAME,3,4)
;				DY = DATE_2DOY(STRMID(YR.FILENAME,3,8)) - 3
;				OK = WHERE(DY GE NEW[NTH].DATE_MIN AND DY LE NEW[NTH].DATE_MAX,COUNT)
;				IF COUNT GE 1 THEN NEW[NTH].(POS) = MEAN(YR[OK].PROD_MEAN)
;				NEW[NTH].(POS + 1) = COUNT
;				POS = POS + 2
;			ENDFOR
;			OK = WHERE(TAGS EQ 'PAR1')
;			POS = OK
;			FOR YTH = 0L, N_ELEMENTS(YSET) -1  DO BEGIN
;				SUBS = WHERE_SETS_SUBS(YSET(YTH))
;				YR = MONS(SUBS)
;				YEAR = STRMID(YR[0].FILENAME,3,4)
;				DY = DATE_2DOY(STRMID(YR.FILENAME,3,8)) - 3
;				OK = WHERE(DY GE NEW[NTH].DATE_MIN AND DY LE NEW[NTH].DATE_MAX,COUNT)
;				IF COUNT GE 1 THEN NEW[NTH].(POS) = MEAN(YR[OK].PAR_MEAN)
;				NEW[NTH].(POS + 1) = COUNT
;				POS = POS + 2
;			ENDFOR
;			OK = WHERE(TAGS EQ 'SST1')
;			POS = OK
;			FOR YTH = 0L, N_ELEMENTS(YSET) -1  DO BEGIN
;				SUBS = WHERE_SETS_SUBS(YSET(YTH))
;				YR = MONS(SUBS)
;				YEAR = STRMID(YR[0].FILENAME,3,4)
;				DY = DATE_2DOY(STRMID(YR.FILENAME,3,8)) - 3
;				OK = WHERE(DY GE NEW[NTH].DATE_MIN AND DY LE NEW[NTH].DATE_MAX,COUNT)
;				IF COUNT GE 1 THEN NEW[NTH].(POS) = MEAN(YR[OK].SST_MEAN)
;				NEW[NTH].(POS + 1) = COUNT
;				POS = POS + 2
;			ENDFOR
;			OK = WHERE(TAGS EQ 'WIND1')
;			POS = OK
;			FOR YTH = 0L, N_ELEMENTS(YWSET) -1  DO BEGIN
;				SUBS = WHERE_SETS_SUBS(YWSET(YTH))
;				YR = BY(SUBS)
;				YEAR = STRMID(YR[0].DATE,0,4)
;				DY = DATE_2DOY(STRMID(YR.DATE,0,8)) - 3
;				OK = WHERE(DY GE NEW[NTH].DATE_MIN AND DY LE NEW[NTH].DATE_MAX,COUNT)
;				IF COUNT GE 1 THEN NEW[NTH].(POS) = MEAN(YR[OK].WIND_NORTH)
;				NEW[NTH].(POS + 1) = COUNT
;				POS = POS + 2
;			ENDFOR
;			NEW[NTH].DATE = YDOY_2DATE('2020',NEW[NTH].DATE_MIN + 3)
;			CHL = [NEW[NTH].CHL1,NEW[NTH].CHL2,NEW[NTH].CHL3,NEW[NTH].CHL4,NEW[NTH].CHL5,NEW[NTH].CHL6]
;			OK = WHERE(CHL NE MISSINGS(CHL))
;			MM = STATS(CHL[OK])
;			NEW[NTH].CHL_MIN = MM.MIN
;			NEW[NTH].CHL_MAX = MM.MAX
;			NEW[NTH].CHL_MEAN = MM.MEAN
;			NEW[NTH].CHL_STD = MM.STD
;			NEW[NTH].CHL_CV = MM.CV
;			PROD = [NEW[NTH].PROD1,NEW[NTH].PROD2,NEW[NTH].PROD3,NEW[NTH].PROD4,NEW[NTH].PROD5,NEW[NTH].PROD6]
;			OK = WHERE(PROD NE MISSINGS(PROD))
;			MM = STATS(PROD[OK])
;			NEW[NTH].PROD_MIN = MM.MIN
;			NEW[NTH].PROD_MAX = MM.MAX
;			NEW[NTH].PROD_MEAN = MM.MEAN
;			NEW[NTH].PROD_STD = MM.STD
;			NEW[NTH].PROD_CV = MM.CV
;			PAR = [NEW[NTH].PAR1,NEW[NTH].PAR2,NEW[NTH].PAR3,NEW[NTH].PAR4,NEW[NTH].PAR5,NEW[NTH].PAR6]
;			OK = WHERE(PAR NE MISSINGS(PAR))
;			MM = STATS(PAR[OK])
;			NEW[NTH].PAR_MIN = MM.MIN
;			NEW[NTH].PAR_MAX = MM.MAX
;			NEW[NTH].PAR_MEAN = MM.MEAN
;			NEW[NTH].PAR_STD = MM.STD
;			NEW[NTH].PAR_CV = MM.CV
;			SST = [NEW[NTH].SST1,NEW[NTH].SST2,NEW[NTH].SST3,NEW[NTH].SST4,NEW[NTH].SST5,NEW[NTH].SST6]
;			OK = WHERE(SST NE MISSINGS(SST))
;			MM = STATS(SST[OK])
;			NEW[NTH].SST_MIN = MM.MIN
;			NEW[NTH].SST_MAX = MM.MAX
;			NEW[NTH].SST_MEAN = MM.MEAN
;			NEW[NTH].SST_STD = MM.STD
;			NEW[NTH].SST_CV = MM.CV
;			WIND = [NEW[NTH].WIND1,NEW[NTH].WIND2,NEW[NTH].WIND3,NEW[NTH].WIND4,NEW[NTH].WIND5,NEW[NTH].WIND6]
;			OK = WHERE(WIND NE MISSINGS(WIND))
;			MM = MINMAX(WIND[OK])
;			NEW[NTH].WIND_MIN = MM[0]
;			NEW[NTH].WIND_MAX = MM[1]
;			NEW[NTH].WIND_MEAN = MEAN(WIND[OK])
;			CT = CT + 8
;		ENDFOR
;
;	!P.MULTI = [0,1,3]
;		PLOT, AX2.JD,[0,4],YTITLE=CTITLE,YRANGE=[0,10],/XSTYLE,/YSTYLE,XMARGIN=[6,1],YMARGIN=YMARGIN,YTICKS=5,YMINOR=4,$
;			XTICKS=AX2.TICKS,XTICKNAME=X2TICKNAME,XTICKV=AX2.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
;		YY = [NEW.CHL_MAX,REVERSE(NEW.CHL_MIN)]
;		XX = [NEW.DATE,REVERSE(NEW.DATE)]
;		POLYFILL, DATE_2JD(XX), YY, COLOR = 35
;		OK = WHERE(TAGS EQ 'CHL1')
;		POS = OK
;		YRS = [1998,1999,2000,2001,2002,2003]
;		FOR YTH = 0L, 5  DO BEGIN
;			OK = WHERE(NEW.(POS) NE MISSINGS(0.0))
;			OPLOT, DATE_2JD(NEW[OK].DATE),NEW[OK].(POS),THICK=3,PSYM=-8,SYMSIZE=SYMSIZE,COLOR = COLORS(YTH)
;			YEAR = YRS(YTH)
;			IF YTH EQ 0 THEN TXT = STRTRIM(YEAR,2) ELSE TXT = [TXT,STRTRIM(YEAR,2)]
;			POS = POS + 2
;		ENDFOR
;		TXT = [TXT,'Mean']
;		OPLOT, DATE_2JD(NEW.DATE),NEW.CHL_MEAN,COLOR=0,THICK=8
;		LEG,pos=[0.028,0.47,0.045,0.92],color=[COLORS,0],label=TXT,THICK=8,LSIZE=1.25,FONT=FONT
;		OK = WHERE(T.REGION_CODE EQ CODES AND STRMID(T.FILENAME,0,9) EQ '1998_2003')
;		ME = STRMID(STRTRIM(T[OK].CHL_MEAN,2),0,4)
;		LABEL = '!C Mean = ' + ME + ' mg m!E-3!N'
;		COOR = COORD_2PLOT(0.67,0.95)
;		XYOUTS, COOR.X,COOR.Y,LABEL, ALIGN=-0.1, CHARSIZE=1.35, COLOR=0, CHARTHICK=1
;
;		PLOT, AX2.JD,[0,2000], YTITLE=PTITLE,YRANGE=[0,4000],/XSTYLE,/YSTYLE,XMARGIN=[6,1],YMARGIN=YMARGIN,YTICKS=4,YMINOR=5,$
;			XTICKS=AX2.TICKS,XTICKNAME=AX2.TICKNAME,XTICKV=AX2.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
;		YY = [NEW.PROD_MAX,REVERSE(NEW.PROD_MIN)]
;		XX = [NEW.DATE,REVERSE(NEW.DATE)]
;		POLYFILL, DATE_2JD(XX), YY, COLOR = 35
;		OK = WHERE(TAGS EQ 'PROD1')
;		POS = OK
;		YRS = [1998,1999,2000,2001,2002,2003]
;		FOR YTH = 0L, N_ELEMENTS(YRS)-1  DO BEGIN
;			OK = WHERE(NEW.(POS) NE MISSINGS(0.0))
;			OPLOT, DATE_2JD(NEW[OK].DATE),NEW[OK].(POS),THICK=3,PSYM=-8,SYMSIZE=SYMSIZE,COLOR=COLORS(YTH)
;			YEAR = YRS(YTH)
;			IF YTH EQ 0 THEN TXT = STRTRIM(YEAR,2) ELSE TXT = [TXT,STRTRIM(YEAR,2)]
;			POS = POS + 2
;		ENDFOR
;		TXT = [TXT,'Mean']
;		OPLOT, DATE_2JD(NEW.DATE),NEW.PROD_MEAN, COLOR = 0, THICK = 8
;		LEG,pos=[0.028,0.47,0.045,0.92],color=[COLORS,0],label=TXT,THICK=8,LSIZE=1.25,FONT=FONT
;		OK = WHERE(T.REGION_CODE EQ CODES AND STRMID(T.FILENAME,0,9) EQ '1998_2003')
;		ME = STRMID(STRTRIM(T[OK].PROD_MEAN,2),0,3)
;		OK = WHERE(S.SUB_AREA_CODE EQ CODES AND S.YEAR EQ '1998_2003')
;		TOT = STRMID(STRTRIM(S[OK].ANN_PROD_MEAN,2),0,4)
;		LABEL = '!CMean = ' + ME + ' gC m!E-2!N day!E-1!N' + '!C Total = ' + TOT + ' gC m!E-2!N'
;		COOR = COORD_2PLOT(0.67,0.95)
;		XYOUTS, COOR.X,COOR.Y,LABEL, ALIGN=-0.1, CHARSIZE=1.35, COLOR=0, CHARTHICK=1
;
;		!P.MULTI = [0,1,3]
;		PLOT, AX2.JD,[0,200], YTITLE=RTITLE,YRANGE=[0,60],/XSTYLE,/YSTYLE,XMARGIN=[6,1],YMARGIN=YMARGIN,YTICKS=3,YMINOR=4,$
;			XTICKS=AX2.TICKS,XTICKNAME=X2TICKNAME,XTICKV=AX2.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
;		YY = [NEW.PAR_MAX,REVERSE(NEW.PAR_MIN)]
;		XX = [NEW.DATE,REVERSE(NEW.DATE)]
;		POLYFILL, DATE_2JD(XX), YY, COLOR = 35
;		OK = WHERE(TAGS EQ 'PAR1')
;		POS = OK
;		YRS = [1998,1999,2000,2001,2002,2003]
;		FOR YTH = 0L, N_ELEMENTS(YRS)-1  DO BEGIN
;			OK = WHERE(NEW.(POS) NE MISSINGS(0.0))
;			OPLOT, DATE_2JD(NEW[OK].DATE),NEW[OK].(POS),THICK=3,PSYM=-8,SYMSIZE=SYMSIZE,COLOR=COLORS(YTH)
;			YEAR = YRS(YTH)
;			IF YTH EQ 0 THEN TXT = STRTRIM(YEAR,2) ELSE TXT = [TXT,STRTRIM(YEAR,2)]
;			POS = POS + 2
;		ENDFOR
;		OPLOT, DATE_2JD(NEW.DATE),NEW.PAR_MEAN, COLOR = 0, THICK = 8
;		LEG,pos=[0.028,0.47,0.045,0.92],color=[COLORS,0],label=TXT,THICK=8,LSIZE=1.25,FONT=FONT
;
;
;		PLOT, AX2.JD,[0,20], YTITLE=STITLE,YRANGE=[0,25],/XSTYLE,/YSTYLE,XMARGIN=[6,1],YMARGIN=YMARGIN,YTICKS=5,YMINOR=5,$
;			XTICKS=AX2.TICKS,XTICKNAME=X2TICKNAME,XTICKV=AX2.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
;		YY = [NEW.SST_MAX,REVERSE(NEW.SST_MIN)]
;		XX = [NEW.DATE,REVERSE(NEW.DATE)]
;		POLYFILL, DATE_2JD(XX), YY, COLOR = 35
;		OK = WHERE(TAGS EQ 'SST1')
;		POS = OK
;		YRS = [1998,1999,2000,2001,2002,2003]
;		FOR YTH = 0L, N_ELEMENTS(YRS)-1  DO BEGIN
;			OK = WHERE(NEW.(POS) NE MISSINGS(0.0))
;			OPLOT, DATE_2JD(NEW[OK].DATE),NEW[OK].(POS),THICK=3,PSYM=-8,SYMSIZE=SYMSIZE,COLOR=COLORS(YTH)
;			YEAR = YRS(YTH)
;			IF YTH EQ 0 THEN TXT = STRTRIM(YEAR,2) ELSE TXT = [TXT,STRTRIM(YEAR,2)]
;			POS = POS + 2
;		ENDFOR
;		TXT = [TXT,'Mean']
;		OPLOT, DATE_2JD(NEW.DATE),NEW.SST_MEAN, COLOR = 0, THICK = 8
;		LEG,pos=[0.028,0.47,0.045,0.92],color=[COLORS,0],label=TXT,THICK=8,LSIZE=1.25,FONT=FONT
;		OK = WHERE(T.REGION_CODE EQ CODES AND STRMID(T.FILENAME,0,9) EQ '1998_2003')
;		ME = STRMID(STRTRIM(T[OK].SST_MEAN,2),0,4)
;		LABEL = '!CMean = ' + ME + ' !Eo!NC'
;		COOR = COORD_2PLOT(0.8,0.95)
;		XYOUTS, COOR.X,COOR.Y,LABEL, ALIGN=-0.1, CHARSIZE=1.35, COLOR=0, CHARTHICK=1
;
;		PLOT, AX2.JD,[0,2], YTITLE='Wind Stress',YRANGE=[-10,10],/XSTYLE,/YSTYLE,XMARGIN=[6,1],YMARGIN=YMARGIN,$
;			XTICKS=AX2.TICKS,XTICKNAME=AX2.TICKNAME,XTICKV=AX2.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
;		YY = [NEW.WIND_MAX,REVERSE(NEW.WIND_MIN)]
;		XX = [NEW.DATE,REVERSE(NEW.DATE)]
;		POLYFILL, DATE_2JD(XX), YY, COLOR = 35
;		OK = WHERE(TAGS EQ 'WIND1')
;		POS = OK
;		YRS = [1998,1999,2000,2001,2002,2003]
;		FOR YTH = 0L, N_ELEMENTS(YRS)-1  DO BEGIN
;			OK = WHERE(NEW.(POS) NE MISSINGS(0.0))
;			OPLOT, DATE_2JD(NEW[OK].DATE),NEW[OK].(POS),THICK=3,PSYM=-8,SYMSIZE=SYMSIZE,COLOR=COLORS(YTH)
;			YEAR = YRS(YTH)
;			IF YTH EQ 0 THEN TXT = STRTRIM(YEAR,2) ELSE TXT = [TXT,STRTRIM(YEAR,2)]
;			POS = POS + 2
;		ENDFOR
;		TXT = [TXT,'Mean']
;		OPLOT, DATE_2JD(NEW.DATE),NEW.WIND_MEAN, COLOR = 0, THICK = 8
;		OPLOT, AX2.JD,[0,0],COLOR=0,THICK=5
;		LEG,pos=[0.028,0.47,0.045,0.92],color=[COLORS,0],label=TXT,THICK=8,LSIZE=1.25,FONT=FONT
;
;
;		PRANGE=[0,5]
;		PY = PRANGE
;		XMARGIN = [4,8]
;		POS = [0.74 ,0.5,0.78,0.9]
;		!Y.OMARGIN = [1,0]
		PHTITLE = 'Total Phytoplankton!C!C(Cells L!U-1!N x 10!U6!N)'
;
;		GROUPS = ['TOTAL_DIATOMS','MICROFLAGELLATES','DINOFLAGELLATES','OTHER','PHAEOCYSTIS']
;		LGD = ['Diatoms','Microflagellates','Dinoflagellates','Other','Phaeocystis']
;		LGD2 = 'Total Phytoplankton'
;		COLORS = [12,34,19,9,22]
;		CIR = DRAW_CIRCLE(0,0,1,49)
;		USERSYM, CIR(0,*),CIR(1,*),THICK=3,/FILL
;		SYMSIZE=0.75
;		!P.MULTI = [0,1,3]
;
;		FOR NTH =0L, 1 DO BEGIN
;		PRINT, NTH
;			IF NTH EQ 0 THEN OK = WHERE(P.SURFACE NE MISSINGS(''),COUNT) ELSE OK = WHERE(P.SURFACE EQ MISSINGS(''),COUNT)
;			IF COUNT GE 30 THEN BEGIN
;				SP  = P[OK]
;				DD = WHERE_SETS(SP.EVENT)
;				NEWP = CREATE_STRUCT('EVENT','','DATE','','DEPTH',0.0,'N',0L,'TOTAL',0.0,'TOTAL_DIATOMS',0.0,'MICROFLAGELLATES',0.0,'DINOFLAGELLATES',0.0,'OTHER',0.0,'PHAEOCYSTIS',0.0)
;				NEWP = STRUCT_2MISSINGS(NEWP)
;				NEWP = REPLICATE(NEWP,N_ELEMENTS(DD))
;				NAMES = TAG_NAMES(NEWP)
;				FOR DTH = 0L, N_ELEMENTS(DD)-1 DO BEGIN
;					SUBS = WHERE_SETS_SUBS(DD(DTH))
;					SPD = SP(SUBS)
;					NEWP(DTH).EVENT = DD(DTH).VALUE
;					NEWP(DTH).DATE = JD_2DATE(MEAN(DATE_2JD(SPD.DATE)))
;					NEWP(DTH).N = DD(DTH).N
;					NEWP(DTH).DEPTH = MEAN(SPD.DEPTH)
;					NEWP(DTH).TOTAL = MEAN(SPD.TOTAL)
;					NEWP(DTH).TOTAL_DIATOMS = MEAN(SPD.TOTAL_DIATOMS)
;					NEWP(DTH).MICROFLAGELLATES = MEAN(SPD.MICROFLAGELLATES)
;					NEWP(DTH).DINOFLAGELLATES = MEAN(SPD.DINOFLAGELLATES)
;					NEWP(DTH).OTHER = MEAN(SPD.OTHER)
;					NEWP(DTH).PHAEOCYSTIS = MEAN(SPD.PHAEOCYSTIS)
;				ENDFOR
;				NEWP = NEWP[SORT(NEWP.DATE)]
;
;				PDATE = DATE_2JD(NEWP.DATE)
;				YY = REPLICATE(8000,N_ELEMENTS(PDATE))
;				AVEDEPTH = MEAN(NEWP.DEPTH)
;				PDEPTH = NEWP.DEPTH
;				TOT = NEWP.TOTAL
;				AVETOT = MEAN(NEWP.TOTAL)
;				BOTTOM = 0
;				PER1 = REPLICATE(0,N_ELEMENTS(NEWP))
;				XP = FINDGEN(N_ELEMENTS(NEWP))
;				FOR PTH = 0L, N_ELEMENTS(GROUPS) -1 DO BEGIN
;					GROUP = GROUPS(PTH)
;					POS = WHERE(NAMES EQ GROUP,COUNT)
;					IF COUNT EQ 1 THEN PHY = NEWP.(POS) ELSE STOP
;					PER = (PHY/TOT)*100
;					OK = WHERE(PHY EQ MISSINGS(0.0),COUNT) & IF COUNT GE 1 THEN PER[OK] = 0
;					IF PTH EQ 0 THEN BEGIN
;						IF NTH EQ 1 THEN XTICKNAME = AX.TICKNAME ELSE XTICKNAME = XTICKNAMES
;						YTITLE='Percent Composition (%)'
;						PLOT, AX.JD, PY,YTITLE=YTITLE,XRANGE=AX.JD,YRANGE=[0,100],/XSTYLE,YSTYLE=8,XMARGIN=XMARGIN,YMARGIN=YMARGIN,$
;							XTICKS=AX.TICKS,XTICKNAME=XTICKNAME,XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
;							BOT = REPLICATE(0, N_ELEMENTS(PER))
;							YY = [PER,BOT]
;							XX = [PDATE,REVERSE(PDATE)]
;							POLYFILL, XX, YY, COLOR = COLORS(PTH)
;					ENDIF
;					PER1 = PER + PER1
;					YY = [PER1,REVERSE(BOTTOM)]
;					XX = [PDATE,REVERSE(PDATE)]
;					IF PTH GE 1 THEN POLYFILL, XX, YY, COLOR = COLORS(PTH)
;					BOTTOM = PER1
;				ENDFOR
;				IF NTH EQ 1 THEN BEGIN
;					USERSYM, [-3.5,1.5,1.5,-3.5],[-1.3,-1.3,1.7,1.7],THICK=3,/FILL
;					LEGEND,LGD,POSITION=[0.02,0.27],/NORMAL,BOX=0,/HORIZONTAL,PSYM=8,CHARSIZE=1.25,COLOR=COLORS
;				;	LEGEND,LGD(3:4),POSITION=[0.23,-0.055],/NORMAL,BOX=0,/HORIZONTAL,PSYM=8,CHARSIZE=1.25,COLOR=COLORS(3:4)
;					CIR = DRAW_CIRCLE(0,0,1,49)
;					USERSYM, CIR(0,*),CIR(1,*),THICK=3,/FILL
;					LEGEND,LGD2,POSITION=[0.74,0.27],/NORMAL,BOX=0,/HORIZONTAL,PSYM=8,CHARSIZE=1.25,COLOR=0,THICK=8,NUM=1
;				ENDIF
;
;				AXIS,XAXIS=0, XRANGE=AX.JD, CHARSIZE=CHARSIZE,XTICKS=N_ELEMENTS(AX.TICKV),XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,XTICKNAME=REPLICATE(' ',N_ELEMENTS(XTICKNAME)),COLOR=0,XTICKLEN=0.05
;				AXIS,XAXIS=1, XRANGE=AX.JD, CHARSIZE=CHARSIZE,XTICKS=N_ELEMENTS(AX.TICKV),XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,XTICKNAME=REPLICATE(' ',N_ELEMENTS(XTICKNAME)),COLOR=0,XTICKLEN=0.05
;				CIR = DRAW_CIRCLE(0,0,1,49)
;				USERSYM, CIR(0,*),CIR(1,*),THICK=3,/FILL
;				AXIS,YAXIS=1,YRANGE=[0,10],/SAVE, YTITLE=PHTITLE ,CHARSIZE=CHARSIZE
;				OPLOT, PDATE,TOT/1000,COLOR=0,THICK=4,LINESTYLE=0,PSYM=-8,SYMSIZE=SYMSIZE
;				GRIDS,XX=AYR.TICKV, /NO_Y
;				LAB = ' Mean Depth = ' + STRMID(STRTRIM(AVEDEPTH,2),0,4) + ' m !CMean Abundance = ' + STRMID(STRTRIM(AVETOT/1000,2),0,4) + ' x 10!U6!N'
;				COOR = COORD_2PLOT(0.65,0.9)
;				XYOUTS, COOR.X,COOR.Y,LAB, ALIGN=-0.1, CHARSIZE=1.25, COLOR=0, CHARTHICK=1
;			ENDIF
;		ENDFOR

;		TAGS = TAG_NAMES(D)
;		VAR = ['TEMP_DOWN','NO3','CHLA']
;
;		FOR VTH = 0L, N_ELEMENTS(VAR)-1 DO BEGIN
;			VOK = WHERE(TAGS EQ VAR(VTH))
;			OK = WHERE(STRMID(D.GMT_DATE,0,4) EQ '2003' AND D.LOCATION EQ 'WEST_SHORE' AND D.(VOK) NE MISSINGS(0.0) AND D.DEPTH LT 40)
;			DD = D[OK]
;			MIN_DEPTH = [0,5,10,15,20,25,30,35,40]
;			MAX_DEPTH = [5,10,15,20,25,30,35,40,45]
;			CODES = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]
;			ND = N_ELEMENTS(MIN_DEPTH)
;			SETS = WHERE_SETS(DD.EVENT)
;			STRUCT = CREATE_STRUCT('EVENT','','YEAR','','GMT_DATE','','DOY',0L,'MIN_DEPTH',0.0,'MAX_DEPTH',0.0,'MEAN_DEPTH',0.0,'N',0L,'VARIABLE',0.0)
;			STRUCT = STRUCT_2MISSINGS(STRUCT)
;			STRUCT = REPLICATE(STRUCT, N_ELEMENTS(SETS)*ND)
;			CT = 0
;			FOR NTH = 0L, N_ELEMENTS(SETS)-1 DO BEGIN
;				SUBS = WHERE_SETS_SUBS(SETS[NTH])
;				SET = DD(SUBS)
;				EVENT = SET[0].EVENT
;				STRUCT(CT:CT + ND-1).EVENT = EVENT
;				STRUCT(CT:CT + ND-1).YEAR = STRMID(SET[0].GMT_DATE,0,4)
;				STRUCT(CT:CT + ND-1).GMT_DATE = SET[0].GMT_DATE
;				STRUCT(CT:CT + ND-1).MIN_DEPTH = MIN_DEPTH
;				STRUCT(CT:CT + ND-1).MAX_DEPTH = MAX_DEPTH
;				FOR STH = 0L, ND-1 DO BEGIN
;					OK = WHERE(SET.DEPTH GE STRUCT(CT).MIN_DEPTH AND SET.DEPTH LT STRUCT(CT).MAX_DEPTH,COUNT)
;					IF COUNT GE 1 THEN BEGIN
;						STRUCT(CT).VARIABLE = MEAN(SET[OK].(VOK))
;						STRUCT(CT).MEAN_DEPTH = MEAN(SET[OK].DEPTH)
;					ENDIF
;					STRUCT(CT).N = COUNT
;					CT = CT + 1
;				ENDFOR
;			ENDFOR
;
;		STRUCT = STRUCT[SORT(STRUCT.GMT_DATE)]
;		STRUCT.DOY = DATE_2DOY(STRUCT.GMT_DATE)
;		OK = WHERE(STRUCT.VARIABLE NE MISSINGS(0.0))
;		TDG = STRUCT[OK]
;		DOY = YDOY_2DATE('2020',TDG.DOY)
;		MAXDEPTH = 35
;		DEPTHS = INDGEN((MAXDEPTH)*2)*0.5
;		ND = N_ELEMENTS(DEPTHS)
;		YRANGE = [-MAXDEPTH,0]
;		MINDATE = 20200101
;		MAXDATE = 20210101
;		PAL_SW3,R,G,B
;		IF VAR(VTH) EQ 'CHLA' THEN BEGIN & VRANGE = [0.1,22] & VNAME = 'Chlorophyll !8a!7' & ENDIF
;		IF VAR(VTH) EQ 'NO3' THEN BEGIN & VRANGE = [0,8] & VNAME = 'Nitrate' & ENDIF
;		IF VAR(VTH) EQ 'TEMP_DOWN' THEN BEGIN & VRANGE = [-1,20] & VNAME = 'Temperature' & ENDIF
;		IF VAR(VTH) EQ 'CHLA' THEN $
;		TIME_DEPTH_GRID,DOY,TDG.MEAN_DEPTH,TDG.VARIABLE,DEPTH_INTERVAL=1,NEAR=0.25,MDATE=[MINDATE,MAXDATE],MDEPTH=[MAXDEPTH,0],VRANGE=VRANGE,CUTOFF=[MAXDEPTH,1],$
;			DIMENSIONS=[4000,500],AX_INTERVAL='MONTH',AY_GRID='MONTH',/FYEAR,YTITLE='Depth (m)',YMARGIN=[0.5,0.5],XMARGIN=[10,20],CHARSIZE=CHARSIZE,/INTERPOLATE,YMINOR=5,/LOG $
;		ELSE $
;		TIME_DEPTH_GRID,DOY,TDG.MEAN_DEPTH,TDG.VARIABLE,DEPTH_INTERVAL=1,NEAR=0.25,MDATE=[MINDATE,MAXDATE],MDEPTH=[MAXDEPTH,0],VRANGE=VRANGE,CUTOFF=[MAXDEPTH,1],$
;			DIMENSIONS=[4000,500],AX_INTERVAL='MONTH',AY_GRID='MONTH',/FYEAR,YTITLE='Depth (m)',YMARGIN=[0.5,0.5],XMARGIN=[10,20],CHARSIZE=CHARSIZE,/INTERPOLATE,YMINOR=5
;		PAL_36,R,G,B
;		LABEL = 'Western Shore !C' + VNAME
;		COOR = COORD_2PLOT(0.005,0.15)
;		XYOUTS, COOR.X,COOR.Y,LABEL, ALIGN=-0.1, CHARSIZE=1.5, COLOR=0, CHARTHICK=1
;	ENDFOR




; ****** Do River, Precip and Salinity plots

;		!P.MULTI=[0,1,3]
;		XTICKNAME = REPLICATE(' ',N_ELEMENTS(AX.TICKNAME))
;		OK = WHERE(E.MID_PRECIP_CM NE MISSINGS(0.0),COUNT)
;	;	PLOT,AX.JD,[0,10],YTITLE='Precipitation (cm)',YRANGE=[0,15],/XSTYLE,/YSTYLE,YMARGIN=YMARGIN,XMARGIN=XMARGIN,YTICKS=5,$
;	;		XTICKS=AX.TICKS,XTICKNAME=XTICKNAME,XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA, YMINOR=3;,YTICKLEN=-0.01
;	;	OPLOT,DATE_2JD(E[OK].DATE),E[OK].MID_PRECIP_CM,COLOR=6,PSYM=-3,SYMSIZE=0.75,THICK=3
;	;	GRIDS,XX=AYR.TICKV, /NO_Y
;
;		OK = WHERE(E.MR_RIVER_FLOW NE MISSINGS(0.0),COUNT)
;		PLOT,AX.JD,[0,15],YTITLE='River Flow (100 m!E3!Ns!E-1!N)',YRANGE=[0,15],/XSTYLE,/YSTYLE,YMARGIN=YMARGIN,XMARGIN=XMARGIN,$
;			XTICKS=AX.TICKS,XTICKNAME=XTICKNAME,XTICKV=AX.TICKV,CHARSIZE=CHARSIZE,/NODATA, YTICKS=5,YMINOR=3;, YTICKLEN=-0.01
;		OPLOT,DATE_2JD(E[OK].DATE),E[OK].MR_RIVER_FLOW/100,COLOR=22,PSYM=-3,SYMSIZE=0.75,THICK=3
;		OPLOT,DATE_2JD(E[OK].DATE),E[OK].MR_LT_MEAN/100,COLOR=32,PSYM=-3,SYMSIZE=0.75,THICK=5
;		GRIDS,XX=AYR.TICKV, /NO_Y
;		COOR = COORD_2PLOT(0.05, 0.85)
;	;	XYOUTS, COOR.X, COOR.Y, 'Merrimack River', CHARSIZE=1.5, COLOR = 0, CHARTHICK=1
;		TXT=['Daily Flow','Mean Flow !C(1923-2004)']
; 		LEG,POS=[0.75,0.82,0.78,0.92],LABEL=TXT,LCOLOR=0, color=[22,31],THICK=5,LSIZE=1.5,FONT=FONT
; 		COOR = COORD_2PLOT(0.01, 0.9)
;		XYOUTS, COOR.X, COOR.Y, 'A', CHARSIZE=1.5, COLOR = 0, CHARTHICK=1
;
;		OK = WHERE(D.LOCATION EQ 'NORTH_SHORE' AND D.SAL_DOWN NE MISSINGS(0.0) AND D.SAL_DOWN GT 10 AND D.DEPTH LT 45)
;		DD = D[OK]
;		MIN_DEPTH = [0,5,10,15,20,25,30,35,40]
;		MAX_DEPTH = [5,10,15,20,25,30,35,40,45]
;		CODES = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]
;		ND = N_ELEMENTS(MIN_DEPTH)
;		SETS = WHERE_SETS(DD.EVENT)
;		STRUCT = CREATE_STRUCT('EVENT','','YEAR','','GMT_DATE','','MIN_DEPTH',0.0,'MAX_DEPTH',0.0,'MEAN_DEPTH',0.0,'N',0L,'VARIABLE',0.0)
;		STRUCT = STRUCT_2MISSINGS(STRUCT)
;		STRUCT = REPLICATE(STRUCT, N_ELEMENTS(SETS)*ND)
;		CT = 0
;		FOR NTH = 0L, N_ELEMENTS(SETS)-1 DO BEGIN
;			SUBS = WHERE_SETS_SUBS(SETS[NTH])
;			SET = DD(SUBS)
;			EVENT = SET[0].EVENT
;			STRUCT(CT:CT + ND-1).EVENT = EVENT
;			STRUCT(CT:CT + ND-1).YEAR = STRMID(SET[0].GMT_DATE,0,4)
;			STRUCT(CT:CT + ND-1).GMT_DATE = SET[0].GMT_DATE
;			STRUCT(CT:CT + ND-1).MIN_DEPTH = MIN_DEPTH
;			STRUCT(CT:CT + ND-1).MAX_DEPTH = MAX_DEPTH
;			FOR STH = 0L, ND-1 DO BEGIN
;				OK = WHERE(SET.SAL_DOWN NE MISSINGS(0.0) AND SET.DEPTH GE STRUCT(CT).MIN_DEPTH AND SET.DEPTH LT STRUCT(CT).MAX_DEPTH,COUNT)
;				IF COUNT GE 1 THEN BEGIN
;					STRUCT(CT).VARIABLE = MEAN(SET[OK].SAL_DOWN)
;					STRUCT(CT).MEAN_DEPTH = MEAN(SET[OK].DEPTH)
;				ENDIF
;				STRUCT(CT).N = COUNT
;				CT = CT + 1
;			ENDFOR
;		ENDFOR
;		STRUCT = STRUCT[SORT(STRUCT.GMT_DATE)]
;		OK = WHERE(STRUCT.VARIABLE NE MISSINGS(0.0))
;		TDG = STRUCT[OK]
;		MAXDEPTH = 40
;		DEPTHS = INDGEN((MAXDEPTH)*2)*0.5
;		ND = N_ELEMENTS(DEPTHS)
;		YRANGE = [-MAXDEPTH,0]
;		MINDATE = 19980101
;		MAXDATE = 20040101
;		PAL_SW3,R,G,B
;		TIME_DEPTH_GRID,TDG.GMT_DATE,TDG.MEAN_DEPTH,TDG.VARIABLE,DEPTH_INTERVAL=1,NEAR=0.25,MDATE=[MINDATE,MAXDATE],MDEPTH=[MAXDEPTH,0],VRANGE=[27,34],CUTOFF=[45,1],$
;			DIMENSIONS=[4000,500],AX_INTERVAL='MONTH',AY_GRID='YEAR',YTITLE='Depth (m)',YMARGIN=[0.5,0.5],XMARGIN=XMARGIN,CHARSIZE=CHARSIZE,/INTERPOLATE,YMINOR=5
;		COLORBAR,BOTTOM=1,NCOLORS=250,POSITION=[0.1,0.24,0.9,0.27],DIVISIONS=5,MINOR=2,RANGE=[25,35],CHARSIZE=2.5
;		;TIME_DEPTH_GRID,TDG.GMT_DATE,TDG.MEAN_DEPTH,TDG.VARIABLE,DEPTH_INTERVAL=1,NEAR=0.5,MDATE=[MINDATE,MAXDATE],MDEPTH=[MAXDEPTH,0],VRANGE=VRANGE,CUTOFF=[MAXDEPTH,1],/MAKE_MISSING,$
;		;	DIMENSIONS=[4000,500],AX_INTERVAL='MONTH',YTITLE='Depth (m)',YMARGIN=YMARGIN,XMARGIN=XMARGIN,CHARSIZE=CHARSIZE,/INTERPOLATE,/FYEAR
;		PAL_36,R,G,B
;		LABEL = 'Salinity (psu)'
;		COOR = COORD_2PLOT(0.4,-0.6)
;		XYOUTS, COOR.X,COOR.Y,LABEL, ALIGN=-0.1, CHARSIZE=1.5, COLOR=0, CHARTHICK=1
;	;	LABEL = 'North Shore'
;	;	COOR = COORD_2PLOT(0.005,0.15)
;	;	XYOUTS, COOR.X,COOR.Y,LABEL, ALIGN=-0.1, CHARSIZE=1.5, COLOR=0, CHARTHICK=1
;		COOR = COORD_2PLOT(0.01, 0.9)
;		XYOUTS, COOR.X, COOR.Y, 'B', CHARSIZE=1.5, COLOR = 0, CHARTHICK=1


!Y.OMARGIN = [0,0]
		P = IDL_RESTORE(PHYTO_FILE)
		OK = WHERE(STRMID(P.DATE,0,4) GE 1998 AND STRMID(P.DATE,0,4) LE 2006)
		P = P[OK]
		PRANGE=[0,5]
		PY = PRANGE
		XMARGIN = [4,4]
		POS = [0.74 ,0.5,0.78,0.9]
		!Y.OMARGIN = [1,0]
		GROUPS = ['TOTAL_DIATOMS','MICROFLAGELLATES','DINOFLAGELLATES','OTHER','PHAEOCYSTIS']
		GPS = ['Diatoms','Microflagellates','Dinoflagellates','Other','Phaeocystis']
		LGD = 			GPS[0]
		LGD = [LGD, GPS[1]]
		LGD = [LGD, GPS(2)]
		LGD = [LGD, GPS(3)]
		LGD = [LGD, GPS(4)]
		LGD2 = 'Total Phytoplankton'
		PHTITLE = '                                Total Phytoplankton (cells L!U-1!N x 10!U6!N)'
		_YTITLE = '                                       Percent Composition (%)'
		COLORS = [12,34,19,9,22]
		CIR = DRAW_CIRCLE(0,0,1,49)
		USERSYM, CIR(0,*),CIR(1,*),THICK=3,/FILL
		SYMSIZE=0.75
		!P.MULTI = [0,1,4]

		LOCATIONS = ['NORTH_SHORE','WEST_SHORE','CAPE_COD','EAST_MASS_BAY']
		STATIONS = ['F01','F02','F06','F13','F24','N18','F27','N04','N16']
		REGS = [' North Shore',' West Shore',' Cape Cod Bay','East Massachusetts Bay']
		OK = WHERE(P.SURFACE NE MISSINGS(''))
		SURF = P[OK]
		FOR NTH =0L, N_ELEMENTS(LOCATIONS)-1 DO BEGIN
			OK = WHERE(SURF.LOCATION EQ LOCATIONS[NTH] AND SURF.STATION NE 'F19',COUNT)
			IF LOCATIONS[NTH] EQ 'NORTH_SHORE' THEN OK = WHERE(SURF.LOCATION EQ LOCATIONS[NTH] OR SURF.STATION EQ 'F27')
			IF COUNT GE 30 THEN BEGIN
				_SP  = SURF[OK]
				DD = WHERE_SETS(_SP.EVENT)
				NEW = CREATE_STRUCT('EVENT','','DATE','','DEPTH',0.0,'N',0L,'TOTAL',0.0,'TOTAL_DIATOMS',0.0,'MICROFLAGELLATES',0.0,'DINOFLAGELLATES',0.0,'OTHER',0.0,'PHAEOCYSTIS',0.0)
				NEW = STRUCT_2MISSINGS(NEW)
				NEW = REPLICATE(NEW,N_ELEMENTS(DD))
				NAMES = TAG_NAMES(NEW)
				FOR DTH = 0L, N_ELEMENTS(DD)-1 DO BEGIN
					SUBS = WHERE_SETS_SUBS(DD(DTH))
					SPD = _SP(SUBS)
					NEW(DTH).EVENT = DD(DTH).VALUE
					NEW(DTH).DATE = JD_2DATE(MEAN(DATE_2JD(SPD.DATE)))
					NEW(DTH).N = DD(DTH).N
					NEW(DTH).DEPTH = MEAN(SPD.DEPTH)
					NEW(DTH).TOTAL = MEAN(SPD.TOTAL)
					NEW(DTH).TOTAL_DIATOMS = MEAN(SPD.TOTAL_DIATOMS)
					NEW(DTH).MICROFLAGELLATES = MEAN(SPD.MICROFLAGELLATES)
					NEW(DTH).DINOFLAGELLATES = MEAN(SPD.DINOFLAGELLATES)
					NEW(DTH).OTHER = MEAN(SPD.OTHER)
					NEW(DTH).PHAEOCYSTIS = MEAN(SPD.PHAEOCYSTIS)
				ENDFOR
				NEW = NEW[SORT(NEW.DATE)]

				PDATE = DATE_2JD(NEW.DATE)
				YY = REPLICATE(8000,N_ELEMENTS(PDATE))
				AVEDEPTH = MEAN(NEW.DEPTH)
				PDEPTH = NEW.DEPTH
				TOT = NEW.TOTAL
				BOTTOM = 0
				PER1 = REPLICATE(0,N_ELEMENTS(NEW))
				XP = FINDGEN(N_ELEMENTS(NEW))
				FOR PTH = 0L, N_ELEMENTS(GROUPS) -1 DO BEGIN
					GROUP = GROUPS(PTH)
					POS = WHERE(NAMES EQ GROUP,COUNT)
					IF COUNT EQ 1 THEN PHY = NEW.(POS) ELSE STOP
					PER = (PHY/TOT)*100
					OK = WHERE(PHY EQ MISSINGS(0.0),COUNT) & IF COUNT GE 1 THEN PER[OK] = 0
					IF PTH EQ 0 THEN BEGIN
						IF NTH EQ N_ELEMENTS(LOCATIONS)-1 THEN XTICKNAME = AX.TICKNAME ELSE XTICKNAME = XTICKNAMES
						IF NTH EQ 2 THEN YTITLE=_YTITLE ELSE YTITLE = ' '
						PLOT, AX.JD, PY,YTITLE=YTITLE,YRANGE=[0,100],/XSTYLE,YSTYLE=8,XMARGIN=XMARGIN,YMARGIN=YMARGIN,$
							XTICKS=AX.TICKS,XTICKNAME=XTICKNAME,XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
							BOT = REPLICATE(0, N_ELEMENTS(PER))
							YY = [PER,BOT]
							XX = [PDATE,REVERSE(PDATE)]
							POLYFILL, XX, YY, COLOR = COLORS(PTH)
					ENDIF
					PER1 = PER + PER1
					YY = [PER1,REVERSE(BOTTOM)]
					XX = [PDATE,REVERSE(PDATE)]
					IF PTH GE 1 THEN POLYFILL, XX, YY, COLOR = COLORS(PTH)
					BOTTOM = PER1
				ENDFOR
				GRIDS,X=AYR.TICKV, /NO_Y
				AXIS,XAXIS=0, XRANGE=AX.JD, CHARSIZE=CHARSIZE,XTICKS=N_ELEMENTS(AX.TICKV),XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,XTICKNAME=REPLICATE(' ',N_ELEMENTS(XTICKNAME)),COLOR=0,XTICKLEN=0.05
				AXIS,XAXIS=1, XRANGE=AX.JD, CHARSIZE=CHARSIZE,XTICKS=N_ELEMENTS(AX.TICKV),XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,XTICKNAME=REPLICATE(' ',N_ELEMENTS(XTICKNAME)),COLOR=0,XTICKLEN=0.05
				CIR = DRAW_CIRCLE(0,0,1,49)
				USERSYM, CIR(0,*),CIR(1,*),THICK=3,/FILL
				IF NTH EQ 2 THEN Y2TITLE = PHTITLE ELSE Y2TITLE = ' '
				AXIS,YAXIS=1,YRANGE=[0,10],/SAVE, YTITLE=Y2TITLE ,CHARSIZE=CHARSIZE
				OPLOT, PDATE,TOT/1000,COLOR=0,THICK=4,LINESTYLE=0,PSYM=-8,SYMSIZE=SYMSIZE
				LAB = REGS[NTH] ;+ '!CMean Depth = ' + STRMID(STRTRIM(AVEDEPTH,2),0,4) + ' m'
				COOR = COORD_2PLOT(0.01,0.85)
				XYOUTS, COOR.X,COOR.Y,LAB, ALIGN=-0.1, CHARSIZE=1.25, COLOR=0, CHARTHICK=1
				IF NTH EQ N_ELEMENTS(LOCATIONS)-1 THEN BEGIN
					USERSYM, [-3.5,1.5,1.5,-3.5],[-1.3,-1.3,1.7,1.7],THICK=3,/FILL
					LEGEND,LGD,POSITION=[0.06,-0.035],/NORMAL,BOX=0,/HORIZONTAL,PSYM=8,CHARSIZE=1.2,COLOR=COLORS
					;LEGEND,LGD(3:4),POSITION=[0.23,-0.055],/NORMAL,BOX=0,/HORIZONTAL,PSYM=8,CHARSIZE=1.25,COLOR=COLORS(3:4)
					CIR = DRAW_CIRCLE(0,0,1,49)
					USERSYM, CIR(0,*),CIR(1,*),THICK=3,/FILL
					LEGEND,LGD2,POSITION=[0.75,-0.035],/NORMAL,BOX=0,/HORIZONTAL,PSYM=8,CHARSIZE=1.2,COLOR=0,THICK=8,NUM=1
				ENDIF
			ENDIF
		ENDFOR

		CODES = [9]
		COLORS = [2,7,10,13,18,22,29,19,4]
		SYMSIZE = 0.45
		CHARSIZE = 1.75
		REGIONS = [' Massachusetts Bay']
		PRODS = ['CHLOR_A','PPD']
		YEARS = ['1998','1999','2000','2001','2002','2003','2004','2005','2006']
		LEG_POS = [0.028 ,0.4,0.045,0.95]
		CTITLE = 'Chlorophyll !8a!7 (mg m!E-3!N)'
		PTITLE = 'Production (gC m!E-2!N d!E-1!N)'
		XMARGIN = [1.5,1.5]
		!P.MULTI = [0,1,2]
		FOR PTH = 0L, N_ELEMENTS(PRODS)-1 DO BEGIN
			APROD = PRODS(PTH)
			IF APROD EQ 'CHLOR_A' THEN BEGIN & TT = MB_STAT_CHL & _YTITLE = CTITLE & YRANGE = [0,10] & ENDIF
			IF APROD EQ 'PPD' THEN BEGIN & TT = MB_STAT_PPD & _YTITLE = PTITLE & YRANGE = [0,2] & ENDIF
			OK = WHERE(STRMID(TT.FIRST_NAME,0,2) EQ '!W')
			T = TT[OK]
			TFP = PARSE_IT(T.FIRST_NAME,/ALL)
			FOR CTH = 0L, N_ELEMENTS(CODES)-1 DO BEGIN
				PYTICKS = 2
				PYMINOR = 5

				OK = WHERE(T.SUBAREA_CODE EQ CODES(CTH) AND TFP.PERIOD_CODE EQ '!W' AND TFP.YEAR_START GE '1998' AND TFP.YEAR_END LE '2006')
				MONS = T[OK]
				MFP = TFP[OK]
				NEW = CREATE_STRUCT('WEEK_MIN','','WEEK_MAX','','WEEK','','DEPTH',0.0,'ALL_MEAN',0.0,$
														'DATA_MIN',0.0,'DATA_MAX',0.0,'DATA_MEAN',0.0,'DATA_98',0.0,'DATA_99',0.0,'DATA_00',0.0,$
														'DATA_01',0.0,'DATA_02',0.0,'DATA_03',0.0,'DATA_04',0.0,'DATA_05',0.0,'DATA_06',0.0)
				NEW = STRUCT_2MISSINGS(NEW)
				TAGS = TAG_NAMES(NEW)
				OK = WHERE(T.SUBAREA_CODE EQ CODES(CTH) AND TFP.PERIOD_CODE EQ '!WEEK')
				WKS = T[OK]
				WFP = TFP[OK]
				NEW = REPLICATE(NEW, N_ELEMENTS(WKS))
				NEW.DEPTH = 0.5
				NEW.WEEK_MIN = WFP.DATE_START
				NEW.WEEK_MAX = WFP.DATE_END
				NEW.WEEK = STRMID(WFP.PERIOD,6,2)
				NEW.DATA_MIN = WKS.MIN
				NEW.DATA_MAX = WKS.MAX
				NEW.DATA_MEAN = WKS.MEAN
				DATE = YDOY_2DATE('2020',DATE_2DOY(NEW.WEEK_MIN)+3)


				OK = WHERE(TT.SUBAREA_CODE EQ CODES(CTH) AND STRMID(TT.FIRST_NAME,0,5) EQ '!YEAR')
				NEW.ALL_MEAN	= TT[OK].MEAN

				YSET = WHERE_SETS(MFP.YEAR_START)
				YSET = YSET[SORT(YSET.VALUE)]
				POS = WHERE(TAGS EQ 'DATA_98')
				CT = 0
				FOR YTH = 0L, N_ELEMENTS(YSET) -1  DO BEGIN
					SUBS = WHERE_SETS_SUBS(YSET(YTH))
					YR = MONS(SUBS)
					YFP = MFP(SUBS)
					WK = STRMID(YFP.PERIOD,7,2)
					OK = WHERE_MATCH(NEW.WEEK,WK,COUNT,VALID=VALID,COMPLEMENT=COMPLEMENT,NCOMPLEMENT=NCOMPLEMENT)
					NEW[OK].(POS+CT) = YR(VALID).MEAN
					CT = CT + 1
				ENDFOR

				IF APROD EQ 'PPD' THEN XTICKNAME = AX2.TICKNAME ELSE XTICKNAME = X2TICKNAME
				PLOT, AX2.JD,YRANGE, YTITLE=_YTITLE,YRANGE=YRANGE,/XSTYLE,/YSTYLE,XMARGIN=XMARGIN,YMARGIN=YMARGIN,YTICKS=PYTICKS,YMINOR=PYMINOR,$
					XTICKS=AX2.TICKS,XTICKNAME=XTICKNAME,XTICKV=AX2.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
				OPLOT, DATE_2JD(DATE),NEW.DATA_MEAN, COLOR = 0, THICK = 8
				YY = [NEW.DATA_MAX,REVERSE(NEW.DATA_MIN)]
				XX = [DATE,REVERSE(DATE)]
				POLYFILL, DATE_2JD(XX), YY, COLOR = 35
				OPLOT, DATE_2JD(DATE),NEW.DATA_MEAN, COLOR = 0, THICK = 8
				POS = WHERE(TAGS EQ 'DATA_98')
				FOR YTH = 0L, N_ELEMENTS(YEARS)-1  DO BEGIN
					OK = WHERE(NEW.(POS) NE MISSINGS(0.0))
					OPLOT, DATE_2JD(DATE[OK]),NEW[OK].(POS),THICK=3,PSYM=-8,SYMSIZE=SYMSIZE,COLOR=COLORS(YTH)
					YEAR = YEARS(YTH)
					IF YTH EQ 0 THEN TXT = STRTRIM(YEAR,2) ELSE TXT = [TXT,STRTRIM(YEAR,2)]
					POS = POS + 1
				ENDFOR
				TXT = [TXT,'Mean']
				OPLOT, DATE_2JD(DATE),NEW.DATA_MEAN, COLOR = 0, THICK = 8
				IF CTH EQ 0 OR CTH EQ N_ELEMENTS(CODES)-1 THEN LEG,pos=LEG_POS,color=[COLORS,0],label=TXT,THICK=THICK,LSIZE=1.25,FONT=FONT
				LABEL = 'Mean = ' + STRMID(NUM2STR(NEW[0].ALL_MEAN),0,4) + UNITS(APROD,/NO_NAME)
				COOR = COORD_2PLOT(0.75,0.9)
				XYOUTS, COOR.X,COOR.Y,LABEL, ALIGN=-0.1, CHARSIZE=1.2, COLOR=0, CHARTHICK=1
			ENDFOR
		ENDFOR


		!P.MULTI = [0,1,2]
		PAL_36,R,G,B
		X  = DATE_2JD([19980101,20070101]) & AX  = DATE_AXIS(X,/MONTH, STEP_SIZE=4) & AYR = DATE_AXIS(X,/YEAR)
		XTICKNAME = REPLICATE(' ',N_ELEMENTS(AX.TICKNAME))
		LEG_POS = [0.028 ,0.32,0.045,0.92]
;		YMARGIN = [0.3,0.3]
		XMARGIN = [4,1]
;		!X.OMARGIN = [0,0]
;		!Y.OMARGIN = [0,0]
;		CHARSIZE = 1.5
;		SYMSIZE = 0.45
;		THICK = 2
;		FONT = 0
;		CIR = DRAW_CIRCLE(0,0,1,49)
;		USERSYM, CIR(0,*),CIR(1,*),THICK=3,/FILL
;		PSYM = 8
;		PRODS = ['CHLOR_A-MB','PPD-VGMB']


		CODES = 9
		PRODS = ['PPD']
		OK = WHERE(STRMID(MB_STAT_PPD.FIRST_NAME,0,3) EQ '!M_')
		MP = MB_STAT_PPD[OK]
		MFP = PARSE_IT(MP.FIRST_NAME,/ALL)
		PYTICKS = 2
		PYMINOR = 5
		OK = WHERE(MP.SUBAREA_CODE EQ CODES AND MFP.PERIOD_CODE EQ '!M' AND MFP.YEAR_START GE '1998' AND MFP.YEAR_END LE '2006')
		MPROD = MP[OK].MEAN
		MPDATE = MFP[OK].DATE_START
		OK = WHERE(STRMID(MB_ANOM_PPD.FIRST_NAME,0,3) EQ '!M_')
		APP = MB_ANOM_PPD[OK]
		AFP = PARSE_IT(APP.FIRST_NAME,/ALL)
		OK = WHERE(APP.SUBAREA_CODE EQ CODES AND AFP.PERIOD_CODE EQ '!M' AND STRMID(APP.ANOM_RATIO,11,4) EQ 'YEAR' AND AFP.YEAR_START GE '1998' AND AFP.YEAR_END LE '2006')
		ANPROD = APP[OK].ANOM
		ANDATE = AFP[OK].DATE_START

		ECHL = STRUCT_SD_READ('F:\SEAWIFS_MLAC-MASS_BAY\ts_images\anom\eof\!M-SEAWIFS-MASS_BAY-CHLOR_A-MB-EOF.SAVE',STRUCT=CSTRUCT)
		EPPD = STRUCT_SD_READ('F:\SEAWIFS_MLAC-MASS_BAY\ts_images\anom\eof\!M-SEAWIFS-MASS_BAY-PPD-VGMB-EOF.SAVE',STRUCT=PSTRUCT)

		W = IDL_RESTORE(MONTHLY_WINDS)
		OK = WHERE(DATE_2JD(W.DATE) GE X[0] AND DATE_2JD(W.DATE) LE X[1]) & W = W[OK]
		OK = WHERE(W.WIND_SP NE MISSINGS(0.0),COUNT)
		WSPEED = W[OK].WIND_SP
		WDATE = JD_ADD(DATE_2JD(W[OK].DATE),15,/DAY)
		OK = WHERE(W.WIND_GUST NE MISSINGS(0.0),COUNT)
		GUST = W[OK].WIND_GUST
		GDATE = DATE_2JD(W[OK].DATE)
		AY = MINMAX(WSPEED)


		OK = WHERE(W.WIND_DIR NE MISSINGS(0L) AND W.WIND_SP NE MISSINGS(0.0),COUNT)
		DDATE = JD_ADD(DATE_2JD(W[OK].DATE),15,/DAY)
		SPEED = W[OK].WIND_SP
		DIR	  = W[OK].WIND_DIR
		DIR2	= TS_SMOOTH(W[OK].WIND_DIR,25)
		SP2		= TS_SMOOTH(W[OK].WIND_SP,25)
		POSX = DDATE
		POSY = REPLICATE(0,COUNT)

		d2r=!pi/180.
		N_S= -cos(DIR*d2r)*SPEED
		E_W= -sin(DIR*d2r)*SPEED
		NW_SE = -cos((DIR+45)*d2r)*SPEED
		SW_NE = -cos((DIR-45)*d2r)*SPEED

		A = 360 - (DIR - 90)
		POLREC, SPEED, A, XDATE, SPEED, /degrees
		VELX = XDATE
		VELY = SPEED

		WC = LONARR(N_ELEMENTS(SPEED))
		OKC = WHERE(DIR GE 0 OR  DIR LT 90, COUNT)	  & IF COUNT GE 1 THEN WC(OKC) = 4
		OKC = WHERE(DIR GE 90  AND DIR LT 180,COUNT)	& IF COUNT GE 1 THEN WC(OKC) = 12
		OKC = WHERE(DIR GE 180 AND DIR LT 270,COUNT)	& IF COUNT GE 1 THEN WC(OKC) = 18
		OKC = WHERE(DIR GE 270 AND DIR LE 360,COUNT)	& IF COUNT GE 1 THEN WC(OKC) = 22
!p.multi = [0,1,2]
CHARSIZE = 2
;		YTITLE = 'Chlorophyll !8a!7!C Mode 1 Amplitude'
;		PLOT, AX.JD,[-1,1], YTITLE=YTITLE,YRANGE=[-100,300],/XSTYLE,/YSTYLE,XMARGIN=XMARGIN,YMARGIN=YMARGIN,$
;						XTICKS=AX.TICKS,XTICKNAME=XTICKNAME,XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
;		OK = WHERE(DATE_2JD(CSTRUCT.DATES) GE X[0] AND DATE_2JD(CSTRUCT.DATES) LT X[1])
;		OPLOT, JD_ADD(DATE_2JD(CSTRUCT.DATES[OK]),15,/DAY),CSTRUCT.PC(OK,0), COLOR = 0, THICK = 8
;		OPLOT, X,[0,0],COLOR=33, THICK=2
;		GRIDS,X=AYR.TICKV, /NO_Y
		YTITLE = 'Mode 1 Amplitude'
		PLOT, AX.JD,[-1,1], YTITLE=YTITLE,YRANGE=[-100,250],/XSTYLE,YSTYLE=8,XMARGIN=XMARGIN,YMARGIN=YMARGIN,$
						XTICKS=AX.TICKS,XTICKNAME=XTICKNAME,XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
		OK = WHERE(DATE_2JD(PSTRUCT.DATES) GE X[0] AND DATE_2JD(PSTRUCT.DATES) LT X[1])
		OPLOT, JD_ADD(DATE_2JD(PSTRUCT.DATES[OK]),15,/DAY),PSTRUCT.PC(OK,0), COLOR = 0, THICK = 8
		OPLOT, X,[0,0],COLOR=33, THICK=2
		AXIS,YAXIS=1,YRANGE=[0,2],/SAVE, YTITLE=PTITLE ,CHARSIZE=CHARSIZE,YTICKS=PYTICKS,YMINOR=PYMINOR
		OPLOT, JD_ADD(DATE_2JD(MPDATE),15,/DAY),MPROD, COLOR = 33, THICK = 5, linestyle=1
		GRIDS,X=AYR.TICKV, /NO_Y
		TXT = ['Mode 1','Production']
		LEG_POS = [0.028 ,0.87,0.05,0.95]
		LEG,POS=LEG_POS,LABEL=TXT,LCOLOR=0, color=[0,32],THICK=[8,8],LSIZE=1.25,FONT=FONT,LINESTYLE=[0,1]

		YTITLE = 'Mode 2 Amplitude'
		PLOT, AX.JD,[-5,5], YTITLE=YTITLE,YRANGE=[-60,60],/XSTYLE,/YSTYLE,XMARGIN=XMARGIN,YMARGIN=YMARGIN,$
						XTICKS=AX.TICKS,XTICKNAME=AX.TICKNAME,XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
		OK = WHERE(DATE_2JD(PSTRUCT.DATES) GE X[0] AND DATE_2JD(PSTRUCT.DATES) LT X[1])
		OPLOT, JD_ADD(DATE_2JD(PSTRUCT.DATES[OK]),15,/DAY),PSTRUCT.PC(OK,1), COLOR = 0, THICK = 8
		OPLOT, X,[0,0],COLOR=33, THICK=2
		GRIDS,X=AYR.TICKV, /NO_Y
	;	AXIS,YAXIS=1,YRANGE=[-10,10],/SAVE, YTITLE='Wind Vector', CHARSIZE=CHARSIZE,YTICKS=PYTICKS,YMINOR=PYMINOR
	;	PARTVELVEC,VELX,VELY,POSX,POSY,/OVER,VECCOLORS=WC, LENGTH = 0.0035, VECTHICKS=REPLICATE(8,N_ELEMENTS(WC))
;		AXIS,YAXIS=1,YRANGE=[-2,8],YTITLE='SW-NE Wind Component',/SAVE, CHARSIZE=CHARSIZE
;	;	OK = WHERE(W.WIND_NORTH NE MISSINGS(0.0),COUNT)
;		OPLOT,DDATE,ABS(SW_NE),COLOR=32,THICK=5,LINESTYLE=1
;	;	OK = WHERE(W.WIND_EAST NE MISSINGS(0.0),COUNT)
;	;	OPLOT,JD_ADD(DATE_2JD(W[OK].DATE),15,/DAY),W[OK].WIND_EAST,COLOR=0,THICK=8, LINESTYLE=1
;		TXT = ['Mode 1','Wind'];,'E-W Wind']
;		LEG_POS = [0.028 ,0.87,0.05,0.95]
;		LEG,POS=LEG_POS,LABEL=TXT,LCOLOR=0, color=[0,32],THICK=[8,5],LSIZE=1.25,FONT=FONT,LINESTYLE=[0,1]

;		YTITLE = 'Mode 2 Amplitude'
;		PLOT, AX.JD,[-5,5], YTITLE=YTITLE,YRANGE=[-60,60],/XSTYLE,YSTYLE=8,XMARGIN=XMARGIN,YMARGIN=YMARGIN,$
;						XTICKS=AX.TICKS,XTICKNAME=XTICKNAME,XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
;		OK = WHERE(DATE_2JD(PSTRUCT.DATES) GE X[0] AND DATE_2JD(PSTRUCT.DATES) LT X[1])
;		OPLOT, JD_ADD(DATE_2JD(PSTRUCT.DATES[OK]),15,/DAY),PSTRUCT.PC(OK,1), COLOR = 0, THICK = 8
;		OPLOT, X,[0,0],COLOR=33, THICK=2
;		GRIDS,X=AYR.TICKV, /NO_Y
;	;	AXIS,YAXIS=1,YRANGE=[-10,10],/SAVE, YTITLE='Wind Vector', CHARSIZE=CHARSIZE,YTICKS=PYTICKS,YMINOR=PYMINOR
;	;	PARTVELVEC,VELX,VELY,POSX,POSY,/OVER,VECCOLORS=WC, LENGTH = 0.0035, VECTHICKS=REPLICATE(8,N_ELEMENTS(WC))
;		AXIS,YAXIS=1,YRANGE=[-10,10],YTITLE='Wind Component',/SAVE, CHARSIZE=CHARSIZE
;	;	OK = WHERE(W.WIND_NORTH NE MISSINGS(0.0),COUNT)
;	;	OPLOT,JD_ADD(DATE_2JD(W[OK].DATE),15,/DAY),W[OK].WIND_NORTH,COLOR=32,THICK=5
;		OK = WHERE(W.WIND_EAST NE MISSINGS(0.0),COUNT)
;		OPLOT,DDATE,N_S,COLOR=32,THICK=6, LINESTYLE=2
;		OPLOT,DDATE,E_W,COLOR=22,THICK=2, LINESTYLE=2
;		;OPLOT,XDATE,W[OK].WIND_EAST,COLOR=22,THICK=2, LINESTYLE=0
;		TXT = ['Mode 1','N_S Wind','E_W Wind']
;		LEG_POS = [0.028 ,0.825,0.05,0.95]
;		LEG,POS=LEG_POS,LABEL=TXT,LCOLOR=0, color=[0,32,22],THICK=[8,6],LSIZE=1.25,FONT=FONT,LINESTYLE=[0,2]



		YTITLE = 'Mode 3 Amplitude'
		PLOT, AX.JD,[-1,1], YTITLE=YTITLE,YRANGE=[-100,100],/XSTYLE,/YSTYLE,XMARGIN=XMARGIN,YMARGIN=YMARGIN,$
						XTICKS=AX.TICKS,XTICKNAME=AX.TICKNAME,XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
		OK = WHERE(DATE_2JD(PSTRUCT.DATES) GE X[0] AND DATE_2JD(PSTRUCT.DATES) LT X[1])
		OPLOT, JD_ADD(DATE_2JD(PSTRUCT.DATES[OK]),15,/DAY),PSTRUCT.PC(OK,2), COLOR = 0, THICK = 8
		OPLOT, X,[0,0],COLOR=33, THICK=2
		GRIDS,X=AYR.TICKV, /NO_Y
	;	AXIS,YAXIS=1,YRANGE=[-2,4],/SAVE, YTITLE='Production Anomaly' ,CHARSIZE=CHARSIZE,YTICKS=PYTICKS,YMINOR=PYMINOR
	;	OPLOT, JD_ADD(DATE_2JD(ANDATE),15,/DAY),ANPROD, COLOR = 33, THICK = 5, linestyle=1
		GRIDS,X=AYR.TICKV, /NO_Y
	;	TXT = ['Mode 3','Anomaly']
	;	LEG_POS = [0.028 ,0.87,0.05,0.95]
	;	LEG,POS=LEG_POS,LABEL=TXT,LCOLOR=0, color=[0,32],THICK=[8,8],LSIZE=1.25,FONT=FONT,LINESTYLE=[0,1]


;		YTITLE = 'Chlorophyll !8a!7!C Mode 2 Amplitude'
;		PLOT, AX.JD,[-5,5], YTITLE=YTITLE,YRANGE=[-100,100],/XSTYLE,/YSTYLE,XMARGIN=XMARGIN,YMARGIN=YMARGIN,$
;						XTICKS=AX.TICKS,XTICKNAME=XTICKNAME,XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
;		OK = WHERE(DATE_2JD(CSTRUCT.DATES) GE X[0] AND DATE_2JD(CSTRUCT.DATES) LT X[1])
;		OPLOT, JD_ADD(DATE_2JD(CSTRUCT.DATES[OK]),15,/DAY),CSTRUCT.PC(OK,1), COLOR = 0, THICK = 8
;		PARTVELVEC,VELX,VELY,POSX,POSY,/OVER,VECCOLORS=WC, LENGTH = 0.02, THICK=REPLICATE(15,N_ELEMENTS(WC))
;		OPLOT, X,[0,0],COLOR=33, THICK=2
;		GRIDS,X=AYR.TICKV, /NO_Y

!p.multi = [0,1,4]
		YTITLE = 'Production!C Mode 2 Amplitude'
		ELABEL = 'East Wind Component'
		NLABEL = 'North Wind Component'
		PLOT, AX.JD,[-5,5], YTITLE=YTITLE,YRANGE=[-50,50],/XSTYLE,/YSTYLE,XMARGIN=XMARGIN,YMARGIN=YMARGIN,$
						XTICKS=AX.TICKS,XTICKNAME=XTICKNAME,XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
		OK = WHERE(DATE_2JD(PSTRUCT.DATES) GE X[0] AND DATE_2JD(PSTRUCT.DATES) LT X[1])
		OPLOT, JD_ADD(DATE_2JD(PSTRUCT.DATES[OK]),15,/DAY),PSTRUCT.PC(OK,1), COLOR = 0, THICK = 8
		OPLOT, X,[0,0],COLOR=33, THICK=2
		GRIDS,X=AYR.TICKV, /NO_Y
		TXT = ['Mode 2','Winds']
		LEG,POS=LEG_POS,LABEL=TXT,LCOLOR=0, color=[0,22],THICK=[8,5],LSIZE=1.5,FONT=FONT
		AXIS,YAXIS=1,YRANGE=[0,10],/SAVE, YTITLE='Wind Speed', CHARSIZE=CHARSIZE,YTICKS=PYTICKS,YMINOR=PYMINOR
		OPLOT,WDATE,WSPEED,COLOR=22,PSYM=-3,SYMSIZE=0.75,THICK=5

		PLOT, AX.JD,[-5,5], YTITLE=YTITLE,YRANGE=[-50,50],/XSTYLE,/YSTYLE,XMARGIN=XMARGIN,YMARGIN=YMARGIN,$
						XTICKS=AX.TICKS,XTICKNAME=XTICKNAME,XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
		OK = WHERE(DATE_2JD(PSTRUCT.DATES) GE X[0] AND DATE_2JD(PSTRUCT.DATES) LT X[1])
		OPLOT, JD_ADD(DATE_2JD(PSTRUCT.DATES[OK]),15,/DAY),PSTRUCT.PC(OK,1), COLOR = 0, THICK = 8
		OPLOT, X,[0,0],COLOR=33, THICK=2
		GRIDS,X=AYR.TICKV, /NO_Y
		AXIS,YAXIS=1,YRANGE=[-10,10],/SAVE, YTITLE='Wind Vector', CHARSIZE=CHARSIZE,YTICKS=PYTICKS,YMINOR=PYMINOR
		PARTVELVEC,VELX,VELY,POSX,POSY,/OVER,VECCOLORS=WC, LENGTH = 0.0035, VECTHICKS=REPLICATE(8,N_ELEMENTS(WC))


		PLOT, AX.JD,[-5,5], YTITLE=YTITLE,YRANGE=[-50,50],/XSTYLE,/YSTYLE,XMARGIN=XMARGIN,YMARGIN=YMARGIN,$
						XTICKS=AX.TICKS,XTICKNAME=XTICKNAME,XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
		OK = WHERE(DATE_2JD(PSTRUCT.DATES) GE X[0] AND DATE_2JD(PSTRUCT.DATES) LT X[1])
		OPLOT, JD_ADD(DATE_2JD(PSTRUCT.DATES[OK]),15,/DAY),PSTRUCT.PC(OK,1), COLOR = 0, THICK = 8
		OPLOT, X,[0,0],COLOR=33, THICK=2
		GRIDS,X=AYR.TICKV, /NO_Y
		OK = WHERE(W.WIND_EAST NE MISSINGS(0.0),COUNT)
		AXIS,YAXIS=1,YRANGE=[-10,10],YTITLE=ELABEL,/SAVE, CHARSIZE=CHARSIZE
		OPLOT,JD_ADD(DATE_2JD(W[OK].DATE),15,/DAY),W[OK].WIND_EAST,COLOR=22,THICK=5


		PLOT, AX.JD,[-5,5], YTITLE=YTITLE,YRANGE=[-50,50],/XSTYLE,/YSTYLE,XMARGIN=XMARGIN,YMARGIN=YMARGIN,$
						XTICKS=AX.TICKS,XTICKNAME=AX.TICKNAME,XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
		OK = WHERE(DATE_2JD(PSTRUCT.DATES) GE X[0] AND DATE_2JD(PSTRUCT.DATES) LT X[1])
		OPLOT, JD_ADD(DATE_2JD(PSTRUCT.DATES[OK]),15,/DAY),PSTRUCT.PC(OK,1), COLOR = 0, THICK = 8
		OPLOT, X,[0,0],COLOR=33, THICK=2
		GRIDS,X=AYR.TICKV, /NO_Y
		OK = WHERE(W.WIND_NORTH NE MISSINGS(0.0),COUNT)
		AXIS,YAXIS=1,YRANGE=[-10,10],YTITLE=NLABEL,/SAVE, CHARSIZE=CHARSIZE
		OPLOT,JD_ADD(DATE_2JD(W[OK].DATE),15,/DAY),W[OK].WIND_NORTH,COLOR=22,THICK=5



!p.multi = [0,1,2]
		YTITLE = 'Chlorophyll !8a!7!C Mode 3 Amplitude'
		PLOT, AX.JD,[-1,1], YTITLE=YTITLE,YRANGE=[-100,100],/XSTYLE,/YSTYLE,XMARGIN=XMARGIN,YMARGIN=YMARGIN,$
						XTICKS=AX.TICKS,XTICKNAME=XTICKNAME,XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
		OK = WHERE(DATE_2JD(CSTRUCT.DATES) GE X[0] AND DATE_2JD(CSTRUCT.DATES) LT X[1])
		OPLOT, JD_ADD(DATE_2JD(CSTRUCT.DATES[OK]),15,/DAY),CSTRUCT.PC(OK,2), COLOR = 0, THICK = 8
		OPLOT, X,[0,0],COLOR=33, THICK=2
		GRIDS,X=AYR.TICKV, /NO_Y
		YTITLE = 'Production!C Mode 3 Amplitude'
		PLOT, AX.JD,[-1,1], YTITLE=YTITLE,YRANGE=[-100,100],/XSTYLE,/YSTYLE,XMARGIN=XMARGIN,YMARGIN=YMARGIN,$
						XTICKS=AX.TICKS,XTICKNAME=AX.TICKNAME,XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
		OK = WHERE(DATE_2JD(PSTRUCT.DATES) GE X[0] AND DATE_2JD(PSTRUCT.DATES) LT X[1])
		OPLOT, JD_ADD(DATE_2JD(PSTRUCT.DATES[OK]),15,/DAY),PSTRUCT.PC(OK,2), COLOR = 0, THICK = 8
		OPLOT, X,[0,0],COLOR=33, THICK=2
	;	AXIS,YAXIS=1,YRANGE=[0,2],/SAVE, YTITLE=PTITLE ,CHARSIZE=CHARSIZE,YTICKS=PYTICKS,YMINOR=PYMINOR
	;	OPLOT, JD_ADD(DATE_2JD(MPDATE),15,/DAY),MPROD, COLOR = 33, THICK = 8
		GRIDS,X=AYR.TICKV, /NO_Y
	;	TXT = ['Mode 1','Production']
	;	LEG,POS=LEG_POS,LABEL=TXT,LCOLOR=0, color=[0,32],THICK=[8,5],LSIZE=1.5,FONT=FONT






;		LABEL = 'Wind Speed'
;		PLOT,AX.JD,AY,YTITLE='(ms!E-1!N)',YRANGE=[0,30],/XSTYLE,/YSTYLE,YMARGIN=YMARGIN,XMARGIN=XMARGIN,$
;			XTICKS=AX.TICKS,XTICKNAME=XTICKNAME,XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=1.25,/NODATA
;		XCRANGE= !X.CRANGE
;		XPOS = XCRANGE[0]+15
;		OPLOT,WDATE,WSPEED,COLOR=10,PSYM=-3,SYMSIZE=0.75,THICK=3
;		OPLOT,GDATE,GUST,COLOR=22,PSYM=2,SYMSIZE=0.25,THICK=1
;		COOR = COORD_2PLOT(0.01,0.8)
;		XYOUTS, COOR.X,COOR.Y, LABEL, ALIGN=-0.1, CHARSIZE=1, COLOR=0, CHARTHICK=1
;		GRIDS,X=AYR.TICKV, /NO_Y
;		TXT='Wind Gust'
;		COLORS = [34]
; 		THICKS = [3]
; 		LSTYLE = 2
; 		LCOLOR=[0]
; 		FONT = 7
; 		PSYM = 2
;		LEG,POS=LEG_POS,LABEL=TXT,LCOLOR=LCOLOR, color=colors,THICK=THICKS,LSIZE=1,FONT=FONT,PSYM=PSYM
;
;
;; ===> Wind direction is measured from 0 degrees clockwise starting at true north (0 = NORTH, 90 = WEST, 180 = SOUTH, 270 = EAST)
;;			 In order to plot the vector arrows in the correct 'wind' direction, need to shift the coordinates
;;			 New angle = 360 - (Wind angle - 90)
;
;
;	;	AX = DATE_AXIS(POSX,/MONTH)
;	;	AYR = DATE_AXIS(POSX,/YEAR)
;		PLOT,AX.JD,[-10,10],YTITLE='',YRANGE=[-10,10],/XSTYLE,/YSTYLE,YMARGIN=YMARGIN,XMARGIN=XMARGIN,$
;			XTICKS=AX.TICKS,XTICKNAME=AX.TICKNAME,XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=1.25,/NODATA
;		OPLOT, AX.JD,[0,0],COLOR=0,THICK=1.5
;		PARTVELVEC,VELX,VELY,POSX,POSY,/OVER,VECCOLORS=WC, LENGTH = 0.004, THICK=REPLICATE(15,N_ELEMENTS(WC))
;		LABEL = 'Wind Vector'
;		COOR = COORD_2PLOT(0.01,0.8)
;		XYOUTS, COOR.X,COOR.Y, LABEL, ALIGN=-0.1, CHARSIZE=1, COLOR=0, CHARTHICK=1
;		GRIDS,X=AYR.TICKV, /NO_Y
;
;
;		OK = WHERE(W.WIND_NORTH NE MISSINGS(0.0),COUNT)
;		N2 = TS_SMOOTH(W[OK].WIND_NORTH,7)
;		PLOT,AX.JD,[-10,10],YTITLE='',YRANGE=[-20,20],/XSTYLE,/YSTYLE,YMARGIN=YMARGIN,XMARGIN=XMARGIN,$
;			XTICKS=AX.TICKS,XTICKNAME=XTICKNAME,XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=1.25,/NODATA
;		OPLOT,DATE_2JD(W[OK].DATE),W[OK].WIND_NORTH,COLOR=2,PSYM=-3,SYMSIZE=0.75,THICK=2
;		OPLOT,DATE_2JD(W[OK].DATE),N2,COLOR=0,PSYM=-3,SYMSIZE=0.75,THICK=2
;		OPLOT,AX.JD,[0,0],COLOR=0,THICK=1.5
;		LABEL = 'Wind North Component'
;		COOR = COORD_2PLOT(0.01,0.8)
;		XYOUTS, COOR.X,COOR.Y, LABEL, ALIGN=-0.1, CHARSIZE=1, COLOR=0, CHARTHICK=1
;		GRIDS,X=AYR.TICKV, /NO_Y
;
;		OK = WHERE(W.WIND_EAST NE MISSINGS(0.0),COUNT)
;		E2 = TS_SMOOTH(W[OK].WIND_EAST,7)
;		PLOT,AX.JD,[-10,10],YTITLE='',YRANGE=[-20,20],/XSTYLE,/YSTYLE,YMARGIN=YMARGIN,XMARGIN=XMARGIN,$
;			XTICKS=AX.TICKS,XTICKNAME=AX.TICKNAME,XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=1.25,/NODATA
;		OPLOT,DATE_2JD(W[OK].DATE),W[OK].WIND_EAST,COLOR=27,PSYM=-3,SYMSIZE=0.75,THICK=2
;		OPLOT,DATE_2JD(W[OK].DATE),E2,COLOR=0,PSYM=-3,SYMSIZE=0.75,THICK=2
;		OPLOT,AX.JD,[0,0],COLOR=0,THICK=1.5
;		LABEL = 'Wind East Component'
;		COOR = COORD_2PLOT(0.01,0.8)
;		XYOUTS, COOR.X,COOR.Y, LABEL, ALIGN=-0.1, CHARSIZE=1, COLOR=0, CHARTHICK=1
;		GRIDS,X=AYR.TICKV, /NO_Y
;;
;
		psprint

STOP
		!Y.OMARGIN = [0,0]



		PSPRINT,FILENAME=FINAL_PORTRAIT,/COLOR,/Full,/TIMES;,/LANDSCAPE
		!P.MULTI = [0,1,4]
;		YRS = [1998,1999,2000,2001,2002,2003]
;		TAGS = TAG_NAMES(NEW)
;		OK = WHERE(TAGS EQ 'WIND1')
;		POS = OK
;		FOR NTH = 0L, N_ELEMENTS(YRS)-1 DO BEGIN
;			IF NTH EQ N_ELEMENTS(YRS)-1 THEN XTICKNAME=AX2.TICKNAME ELSE XTICKNAME = X2TICKNAME
;			PLOT, AX2.JD,[0,2], YTITLE='Wind Stress',YRANGE=[-10,10],/XSTYLE,/YSTYLE,XMARGIN=[6,1],YMARGIN=YMARGIN,$
;				XTICKS=AX2.TICKS,XTICKNAME=XTICKNAME,XTICKV=AX2.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
;			YY = [NEW.WIND_MAX,REVERSE(NEW.WIND_MIN)]
;			XX = [NEW.DATE,REVERSE(NEW.DATE)]
;			POLYFILL, DATE_2JD(XX), YY, COLOR = 35
;			OK = WHERE(NEW.(POS) NE MISSINGS(0.0))
;			OPLOT, DATE_2JD(NEW[OK].DATE),NEW[OK].(POS),THICK=5,COLOR=0
;			POS = POS + 2
;			OPLOT, DATE_2JD(NEW.DATE),NEW.WIND_MEAN, COLOR = 33, THICK = 4, LINESTYLE=2
;			OPLOT, AX2.JD,[0,0],COLOR=0,THICK=3
;			YR = YRS[NTH]
;			COOR = COORD_2PLOT(0.005,0.85)
;			XYOUTS, COOR.X,COOR.Y,YR, ALIGN=-0.1, CHARSIZE=1.25, COLOR=0, CHARTHICK=1
;		ENDFOR

;		CODES = [1,3,4,2]
;		COLORS = [2,7,10,13,18,22,29,19,4]
;		SYMSIZE = 0.45
;		REGIONS = ['  North Shore','  West Shore','  Cape Cod Bay','Eastern Massachusetts Bay']
;		PRODS = ['CHL','AMCHL','PROD','AMPROD','SST','AMSST','SST2']
;		PRODS = ['CHL','PROD','PROD2','SPAN','ANCHL','ANPROD']
;		PRODS = ['CHLOR_A','PPD']
;		YEARS = ['1998','1999','2000','2001','2002','2003','2004','2005','2006']
;		AS = [0,25]
;		FOR PTH = 0L, N_ELEMENTS(PRODS)-1 DO BEGIN
;			!P.MULTI = [0,1,4]
;			IF PRODS(PTH) EQ 'CHLOR_A' THEN TT = SC
;			IF PRODS(PTH) EQ 'PPD'     THEN TT = SP
;			OK = WHERE(STRMID(TT.FIRST_NAME,0,2) EQ '!W')
;			T = TT[OK]
;			TFP = PARSE_IT(T.FIRST_NAME,/ALL)
;			FOR CTH = 0L, N_ELEMENTS(CODES)-1 DO BEGIN
;				IF CTH GE 4 THEN BEGIN
;					RC = [0,8]
;					RP = [0,2]
;					CYTICKS = 4
;					PYTICKS = 4
;					DCTICKS = 5
;					CYMINOR = 4
;					PYMINOR = 5
;				ENDIF ELSE BEGIN
;					RC = [0,16]
;					RP = [0,4]
;					CYTICKS = 4
;					PYTICKS = 4
;					CYMINOR = 6
;					PYMINOR = 5
;				ENDELSE
;
;
;				OK = WHERE(T.SUBAREA_CODE EQ CODES(CTH) AND TFP.PERIOD_CODE EQ '!W' AND TFP.YEAR_START GE '1998' AND TFP.YEAR_END LE '2006')
;				MONS = T[OK]
;				MFP = TFP[OK]
;;				NEW = CREATE_STRUCT('DATE_MIN',0L,'DATE_MAX',0L,'DATE','','DEPTH',0.0,'CHL_MIN',0.0,'CHL_MAX',0.0,'CHL_MEAN',0.0,'CHL_STD',0.0,'CHL_CV',0.0,$
;;					'PROD_MIN',0.0,'PROD_MAX',0.0,'PROD_MEAN',0.0,'PROD_STD',0.0,'PROD_CV',0.0,'SST_MIN',0.0,'SST_MAX',0.0,'SST_MEAN',0.0,'SST_STD',0.0,'SST_CV',0.0,$
;;					'ACHL_MIN',0.0,'ACHL_MAX',0.0,'ACHL_MEAN',0.0,'ACHL_STD',0.0,'ACHL_CV',0.0,'APROD_MIN',0.0,'APROD_MAX',0.0,'APROD_MEAN',0.0,'APROD_STD',0.0,'APROD_CV',0.0,$
;;					'MEANCHL',0.0,'CHL1',0.0,'N1',0L,'ANCHL1',0.0,'CHL2',0.0,'N2',0L,'ANCHL2',0.0,'CHL3',0.0,'N3',0L,'ANCHL3',0.0,'CHL4',0.0,'N4',0L,'ANCHL4',0.0,'CHL5',0.0,'N5',0L,'ANCHL5',0.0,'CHL6',0.0,'N6',0L,'ANCHL6',0.0,  $
;;					'MEANPROD',0.0,'PROD1',0.0,'NP1',0L,'ANPROD1',0.0,'PROD2',0.0,'NP2',0L,'ANPROD2',0.0,'PROD3',0.0,'NP3',0L,'ANPROD3',0.0,'PROD4',0.0,'NP4',0L,'ANPROD4',0.0,'PROD5',0.0,'NP5',0L,'ANPROD5',0.0,'PROD6',0.0,'NP6',0L,'ANPROD6',0.0,  $
;;					'MEANSST',0.0,'SST1',0.0,'NS1',0L,'ANSST1',0.0,'SST2',0.0,'NS2',0L,'ANSST2',0.0,'SST3',0.0,'NS3',0L,'ANSST3',0.0,'SST4',0.0,'NS4',0L,'ANSST4',0.0,'SST5',0.0,'N5S',0L,'ANSST5',0.0,'SST6',0.0,'NS6',0L,'ANSST6',0.0)
;
;
;
;				NEW = CREATE_STRUCT('WEEK_MIN','','WEEK_MAX','','WEEK','','DEPTH',0.0,'ALL_MEAN',0.0,$
;														'DATA_MIN',0.0,'DATA_MAX',0.0,'DATA_MEAN',0.0,'DATA_98',0.0,'DATA_99',0.0,'DATA_00',0.0,$
;														'DATA_01',0.0,'DATA_02',0.0,'DATA_03',0.0,'DATA_04',0.0,'DATA_05',0.0,'DATA_06',0.0)
;				NEW = STRUCT_2MISSINGS(NEW)
;				TAGS = TAG_NAMES(NEW)
;				OK = WHERE(T.SUBAREA_CODE EQ CODES(CTH) AND TFP.PERIOD_CODE EQ '!WEEK')
;				WKS = T[OK]
;				WFP = TFP[OK]
;				NEW = REPLICATE(NEW, N_ELEMENTS(WKS))
;				NEW.DEPTH = 0.5
;				NEW.WEEK_MIN = WFP.DATE_START
;				NEW.WEEK_MAX = WFP.DATE_END
;				NEW.WEEK = STRMID(WFP.PERIOD,6,2)
;				NEW.DATA_MIN = WKS.MIN
;				NEW.DATA_MAX = WKS.MAX
;				NEW.DATA_MEAN = WKS.MEAN
;				DATE = YDOY_2DATE('2020',DATE_2DOY(NEW.WEEK_MIN)+3)
;
;
;				OK = WHERE(TT.SUBAREA_CODE EQ CODES(CTH) AND STRMID(TT.FIRST_NAME,0,5) EQ '!YEAR')
;				NEW.ALL_MEAN	= TT[OK].MEAN
;
;				YSET = WHERE_SETS(MFP.YEAR_START)
;				YSET = YSET[SORT(YSET.VALUE)]
;				POS = WHERE(TAGS EQ 'DATA_98')
;				CT = 0
;				FOR YTH = 0L, N_ELEMENTS(YSET) -1  DO BEGIN
;					SUBS = WHERE_SETS_SUBS(YSET(YTH))
;					YR = MONS(SUBS)
;					YFP = MFP(SUBS)
;					WK = STRMID(YFP.PERIOD,7,2)
;					OK = WHERE_MATCH(NEW.WEEK,WK,COUNT,VALID=VALID,COMPLEMENT=COMPLEMENT,NCOMPLEMENT=NCOMPLEMENT)
;					NEW[OK].(POS+CT) = YR(VALID).MEAN
;					CT = CT + 1
;				ENDFOR
;
;
;				IF PRODS(PTH) EQ 'CHLOR_A' THEN BEGIN
;					IF CTH EQ 0 OR CTH EQ N_ELEMENTS(CODES)-1 THEN YTITLE = CTITLE ELSE YTITLE = ' '
;					IF CTH EQ N_ELEMENTS(CODES)-1 THEN XTICKNAME = AX2.TICKNAME ELSE XTICKNAME = X2TICKNAME
;					PLOT, AX2.JD,RC, YTITLE=YTITLE,YRANGE=RC,/XSTYLE,/YSTYLE,XMARGIN=XMARGIN,YMARGIN=YMARGIN,YTICKS=CYTICKS,YMINOR=CYMINOR,$
;						XTICKS=AX2.TICKS,XTICKNAME=XTICKNAME,XTICKV=AX2.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
;					YY = [NEW.DATA_MAX,REVERSE(NEW.DATA_MIN)]
;					XX = [DATE,REVERSE(DATE)]
;					POLYFILL, DATE_2JD(XX), YY, COLOR = 35
;					POS = WHERE(TAGS EQ 'DATA_98')
;					FOR YTH = 0L, N_ELEMENTS(YEARS)-1  DO BEGIN
;						OK = WHERE(NEW.(POS) NE MISSINGS(0.0))
;						OPLOT, DATE_2JD(DATE[OK]),NEW[OK].(POS),THICK=3,PSYM=-8,SYMSIZE=SYMSIZE,COLOR = COLORS(YTH)
;						YEAR = YEARS(YTH)
;						IF YTH EQ 0 THEN TXT = STRTRIM(YEAR,2) ELSE TXT = [TXT,STRTRIM(YEAR,2)]
;						POS = POS + 1
;					ENDFOR
;					TXT = [TXT,'Mean']
;					OPLOT, DATE_2JD(DATE),NEW.DATA_MEAN,COLOR=0,THICK=8
;					IF CTH EQ 0 OR CTH EQ N_ELEMENTS(CODES)-1 THEN LEG,pos=LEG_POS,color=[COLORS,0],label=TXT,THICK=THICK,LSIZE=1,FONT=FONT
;					LABEL = REGIONS(CTH) + '!C Mean = ' + STRMID(NUM2STR(NEW[0].ALL_MEAN),0,4) + ' mg m!E-3!N'
;					COOR = COORD_2PLOT(0.67,0.85)
;					XYOUTS, COOR.X,COOR.Y,LABEL, ALIGN=-0.1, CHARSIZE=1, COLOR=0, CHARTHICK=1
;				ENDIF
;
;
;				IF PRODS(PTH) EQ 'PPD' THEN BEGIN
;					IF CTH EQ 0 OR CTH EQ N_ELEMENTS(CODES)-1 THEN YTITLE = PTITLE ELSE YTITLE = ' '
;					IF CTH EQ N_ELEMENTS(CODES)-1 THEN XTICKNAME = AX2.TICKNAME ELSE XTICKNAME = X2TICKNAME
;					PLOT, AX2.JD,RP, YTITLE=YTITLE,YRANGE=RP,/XSTYLE,/YSTYLE,XMARGIN=XMARGIN,YMARGIN=YMARGIN,YTICKS=PYTICKS,YMINOR=PYMINOR,$
;						XTICKS=AX2.TICKS,XTICKNAME=XTICKNAME,XTICKV=AX2.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
;					YY = [NEW.DATA_MAX,REVERSE(NEW.DATA_MIN)]
;					XX = [DATE,REVERSE(DATE)]
;					POLYFILL, DATE_2JD(XX), YY, COLOR = 35
;					POS = WHERE(TAGS EQ 'DATA_98')
;					FOR YTH = 0L, N_ELEMENTS(YEARS)-1  DO BEGIN
;						OK = WHERE(NEW.(POS) NE MISSINGS(0.0))
;						OPLOT, DATE_2JD(DATE[OK]),NEW[OK].(POS),THICK=3,PSYM=-8,SYMSIZE=SYMSIZE,COLOR=COLORS(YTH)
;						YEAR = YEARS(YTH)
;						IF YTH EQ 0 THEN TXT = STRTRIM(YEAR,2) ELSE TXT = [TXT,STRTRIM(YEAR,2)]
;						POS = POS + 1
;					ENDFOR
;					TXT = [TXT,'Mean']
;					OPLOT, DATE_2JD(DATE),NEW.DATA_MEAN, COLOR = 0, THICK = 8
;					IF CTH EQ 0 OR CTH EQ N_ELEMENTS(CODES)-1 THEN LEG,pos=LEG_POS,color=[COLORS,0],label=TXT,THICK=THICK,LSIZE=1,FONT=FONT
;
;				;	OK = WHERE(S.SUB_AREA_CODE EQ CODES(CTH) AND S.YEAR EQ '1998_2003')
;				;	TOT = STRMID(STRTRIM(S[OK].ANN_PROD_MEAN,2),0,3)
;					LABEL = REGIONS(CTH) + '!CMean = ' + STRMID(NUM2STR(NEW[0].ALL_MEAN),0,4) + ' gC m!E-2!N day!E-1!N'; + '!C Total = ' + TOT + ' gC m!E-2!N'
;					COOR = COORD_2PLOT(0.67,0.85)
;					XYOUTS, COOR.X,COOR.Y,LABEL, ALIGN=-0.1, CHARSIZE=1, COLOR=0, CHARTHICK=1
;				ENDIF
;			ENDFOR
;		ENDFOR
;

;		***** MAKE TIME ANOMALY PLOTS *****
		CODES = [1,3,4,2]
		REGIONS = ['  North Shore','  West Shore','  Cape Cod Bay','Eastern Massachusetts Bay']
		FOR PTH = 0L, N_ELEMENTS(PRODS)-1 DO BEGIN
			IF PRODS(PTH) EQ 'CHLOR_A' THEN TT = AC
			IF PRODS(PTH) EQ 'PPD'     THEN TT = AP
			OK = WHERE(STRMID(TT.FIRST_NAME,0,4) EQ '!DD_')
			T = TT[OK]
			TFP = PARSE_IT(T.FIRST_NAME,/ALL)
			FOR CTH = 0L, N_ELEMENTS(CODES)-1 DO BEGIN
				OK = WHERE(T.SUBAREA_CODE EQ CODES(CTH) AND TFP.PERIOD_CODE EQ '!DD' AND STRPOS(T.ANOM_RATIO,'!YEAR') NE -1 AND TFP.YEAR_START GE '1998' AND TFP.YEAR_END LE '2006')
				MONS = T[OK]
				MFP = TFP[OK]
				YSET = WHERE_SETS(MFP.YEAR_START)
				IF CTH EQ 0L THEN !P.MULTI = [0,1,40]
				MAXDEPTH = 1
				DEPTHS = 3
				ND = N_ELEMENTS(DEPTHS)
				YRANGE = [-MAXDEPTH,0]
				MINDATE = 20200101000000
				MAXDATE = 20210101000000
				AXC2 = DATE_AXIS([MINDATE,MAXDATE], /FYEAR)
				X2TICKNAME = REPLICATE(' ',N_ELEMENTS(AXC2.TICKNAME))
				PAL_RATIO ,R,G,B
				YTICKNAMES=[' ',' ',' ']
				CHARSIZE2 = 2
				TXTSIZE = 1.2

				FOR YTH = 0L, N_ELEMENTS(YSET)-1 DO BEGIN
					SUBS = WHERE_SETS_SUBS(YSET(YTH))
					YRSET = MONS(SUBS)
					YFP = MFP(SUBS)
					DATA = YRSET.ANOM
					DATE = YDOY_2DATE('2020',DATE_2DOY(YFP.DATE_START))
					DEPTH = REPLICATE(0.5,N_ELEMENTS(DATA))

					IF PRODS(PTH) EQ 'CHLOR_A' THEN BEGIN
						OK = WHERE(SC.SUBAREA_CODE EQ CODES(CTH) AND STRMID(SC.FIRST_NAME,0,5) EQ '!YEAR',COUNT)
						IF COUNT EQ 1 THEN ME = STRMID(NUM2STR(SC[OK].MEAN),0,4) ELSE STOP
						LABEL2 = 'Mean = ' + ME + ' mg m!E-3!N'
						VRANGE = [0.08,12]
						TITLE_LABEL = 'Chlorophyll !8a!7 Anomaly'
						COOR_TITLE = COORD_2PLOT(0.35,-0.50)
					ENDIF
					IF PRODS(PTH) EQ 'PPD' THEN BEGIN
						OK = WHERE(SP.SUBAREA_CODE EQ CODES(CTH) AND STRMID(SP.FIRST_NAME,0,5) EQ '!YEAR',COUNT)
						IF COUNT EQ 1 THEN ME = STRMID(NUM2STR(SP[OK].MEAN),0,4) ELSE STOP
						LABEL2 = 'Mean = ' + ME + ' mg m!E-2!N d!E-1!N'
						VRANGE = [0.08,12]
						TITLE_LABEL = 'Primary Production Anomaly'
						COOR_TITLE = COORD_2PLOT(0.35,-0.5)
					ENDIF

					IF YTH EQ 0 THEN BEGIN
						IF CTH EQ 0 THEN TITLE = TITLE_LABEL ELSE TITLE = ' '
						PLOT,AXC2.JD,[0,1],YSTYLE=1,XMARGIN=[4,8],YMARGIN=[0,0],YTICKS=1,YMINOR=0,YTICKNAME=YTICKNAMES,XTICKNAME=X2TICKNAME,/NODATA,CHARSIZE=CHARSIZE2, TITLE=TITLE
						LABEL = REGIONS(CTH)
						COOR = COORD_2PLOT(-0.01,0.2)
						XYOUTS, COOR.X,COOR.Y,LABEL, ALIGN=-0.1, CHARSIZE=TXTSIZE, COLOR=0, CHARTHICK=1
						COOR = COORD_2PLOT(0.67,0.2)
						XYOUTS, COOR.X,COOR.Y,LABEL2, ALIGN=-0.1, CHARSIZE=TXTSIZE, COLOR=0, CHARTHICK=1
;						IF CTH EQ 0 THEN XYOUTS, COOR_TITLE.X, COOR_TITLE.Y, TITLE_LABEL, CHARSIZE=TXTSIZE+0.25, COLOR=0, CHARTHICK=0
					ENDIF
					X2MARGIN = [4,8]
					Y2MARGIN = [0,0]
					OK = WHERE(YRSET.ANOM NE MISSINGS(0.0))
					IF CTH EQ N_ELEMENTS(CODES)-1 AND YTH EQ N_ELEMENTS(YSET)-1 THEN $
					TIME_DEPTH_GRID,DATE[OK],DEPTH[OK],DATA[OK],/LOG,DEPTH_INTERVAL=0.5,MDATE=[MINDATE,MAXDATE],MDEPTH=[MAXDEPTH,0],VRANGE=VRANGE,CUTOFF=[1,0],YTICKS=1,YTICKNAME=[' ',' ',' '],$
						/NODEPTH,DIMENSIONS=[500,50],AX_INTERVAL='MONTH',AY_GRID='YEAR',/FYEAR,YTITLE=' ',YMARGIN=Y2MARGIN,XMARGIN=X2MARGIN,CHARSIZE=CHARSIZE2,/INTERPOLATE,YMINOR=0 $
					ELSE $
					TIME_DEPTH_GRID,DATE[OK],DEPTH[OK],DATA[OK],/LOG,DEPTH_INTERVAL=0.5,MDATE=[MINDATE,MAXDATE],MDEPTH=[MAXDEPTH,0],VRANGE=VRANGE,CUTOFF=[1,0],YTICKS=1,YTICKNAME=[' ',' ',' '],$
						/NODEPTH,DIMENSIONS=[500,50],AX_INTERVAL='MONTH',AY_GRID='YEAR',/FYEAR,YTITLE=' ',YMARGIN=Y2MARGIN,XMARGIN=X2MARGIN,CHARSIZE=CHARSIZE2,/INTERPOLATE,YMINOR=0,/NOXDATES
					LABEL = YSET(YTH).VALUE
					COOR = COORD_2PLOT(-0.08,0.3)
					XYOUTS, COOR.X,COOR.Y,LABEL, ALIGN=-0.1, CHARSIZE=TXTSIZE, COLOR=0, CHARTHICK=1
				ENDFOR
				IF CTH EQ N_ELEMENTS(CODES)-1 THEN $
					BAR=COLOR_BAR_SCALE(PROD='RATIO_12',POSITION=[0.92, 0.002, 0.945, 0.998],PAL='PAL_RATIO',CHARSIZE=2,FONT=0,TITLE=' ',/VERTICAL)
			ENDFOR
		ENDFOR
		FOR PTH = 0L, N_ELEMENTS(PRODS)-1 DO BEGIN
			IF PRODS(PTH) EQ 'CHLOR_A' THEN TT = AC
			IF PRODS(PTH) EQ 'PPD'     THEN TT = AP
			OK = WHERE(STRMID(TT.FIRST_NAME,0,3) EQ '!D_')
			T = TT[OK]
			TFP = PARSE_IT(T.FIRST_NAME,/ALL)
			FOR CTH = 0L, N_ELEMENTS(CODES)-1 DO BEGIN
				OK = WHERE(T.SUBAREA_CODE EQ CODES(CTH) AND TFP.PERIOD_CODE EQ '!D' AND STRPOS(T.ANOM_RATIO,'!YEAR') NE -1 AND TFP.YEAR_START GE '1998' AND TFP.YEAR_END LE '2006')
				MONS = T[OK]
				MFP = TFP[OK]
				YSET = WHERE_SETS(MFP.YEAR_START)
				IF CTH EQ 0L THEN !P.MULTI = [0,1,40]
				MAXDEPTH = 1
				DEPTHS = 3
				ND = N_ELEMENTS(DEPTHS)
				YRANGE = [-MAXDEPTH,0]
				MINDATE = 20200101000000
				MAXDATE = 20210101000000
				AXC2 = DATE_AXIS([MINDATE,MAXDATE], /FYEAR)
				X2TICKNAME = REPLICATE(' ',N_ELEMENTS(AXC2.TICKNAME))
				PAL_RATIO ,R,G,B
				YTICKNAMES=[' ',' ',' ']
				CHARSIZE2 = 2
				TXTSIZE = 1.2

				FOR YTH = 0L, N_ELEMENTS(YSET)-1 DO BEGIN
					SUBS = WHERE_SETS_SUBS(YSET(YTH))
					YRSET = MONS(SUBS)
					YFP = MFP(SUBS)
					DATA = YRSET.ANOM
					DATE = YDOY_2DATE('2020',DATE_2DOY(YFP.DATE_START))
					DEPTH = REPLICATE(0.5,N_ELEMENTS(DATA))

					IF PRODS(PTH) EQ 'CHLOR_A' THEN BEGIN
						OK = WHERE(SC.SUBAREA_CODE EQ CODES(CTH) AND STRMID(SC.FIRST_NAME,0,5) EQ '!YEAR',COUNT)
						IF COUNT EQ 1 THEN ME = STRMID(NUM2STR(SC[OK].MEAN),0,4) ELSE STOP
						LABEL2 = 'Mean = ' + ME + ' mg m!E-3!N'
						VRANGE = [0.08,12]
						TITLE_LABEL = 'Chlorophyll !8a!7 Anomaly'
						COOR_TITLE = COORD_2PLOT(0.35,-0.50)
					ENDIF
					IF PRODS(PTH) EQ 'PPD' THEN BEGIN
						OK = WHERE(SP.SUBAREA_CODE EQ CODES(CTH) AND STRMID(SP.FIRST_NAME,0,5) EQ '!YEAR',COUNT)
						IF COUNT EQ 1 THEN ME = STRMID(NUM2STR(SP[OK].MEAN),0,4) ELSE STOP
						LABEL2 = 'Mean = ' + ME + ' mg m!E-2!N d!E-1!N'
						VRANGE = [0.08,12]
						TITLE_LABEL = 'Primary Production Anomaly'
						COOR_TITLE = COORD_2PLOT(0.35,-0.5)
					ENDIF

					IF YTH EQ 0 THEN BEGIN
						IF CTH EQ 0 THEN TITLE = TITLE_LABEL ELSE TITLE = ' '
						PLOT,AXC2.JD,[0,1],YSTYLE=1,XMARGIN=[4,8],YMARGIN=[0,0],YTICKS=1,YMINOR=0,YTICKNAME=YTICKNAMES,XTICKNAME=X2TICKNAME,/NODATA,CHARSIZE=CHARSIZE2, TITLE=TITLE
						LABEL = REGIONS(CTH)
						COOR = COORD_2PLOT(-0.01,0.2)
						XYOUTS, COOR.X,COOR.Y,LABEL, ALIGN=-0.1, CHARSIZE=TXTSIZE, COLOR=0, CHARTHICK=1
						COOR = COORD_2PLOT(0.67,0.2)
						XYOUTS, COOR.X,COOR.Y,LABEL2, ALIGN=-0.1, CHARSIZE=TXTSIZE, COLOR=0, CHARTHICK=1
;						IF CTH EQ 0 THEN XYOUTS, COOR_TITLE.X, COOR_TITLE.Y, TITLE_LABEL, CHARSIZE=TXTSIZE+0.25, COLOR=0, CHARTHICK=0
					ENDIF
					X2MARGIN = [4,8]
					Y2MARGIN = [0,0]
					OK = WHERE(YRSET.ANOM NE MISSINGS(0.0))
					IF CTH EQ N_ELEMENTS(CODES)-1 AND YTH EQ N_ELEMENTS(YSET)-1 THEN $
					TIME_DEPTH_GRID,DATE[OK],DEPTH[OK],DATA[OK],/LOG,DEPTH_INTERVAL=0.5,MDATE=[MINDATE,MAXDATE],MDEPTH=[MAXDEPTH,0],VRANGE=VRANGE,CUTOFF=[1,0],YTICKS=1,YTICKNAME=[' ',' ',' '],$
						/NODEPTH,DIMENSIONS=[500,50],AX_INTERVAL='MONTH',AY_GRID='YEAR',/FYEAR,YTITLE=' ',YMARGIN=Y2MARGIN,XMARGIN=X2MARGIN,CHARSIZE=CHARSIZE2,/INTERPOLATE,YMINOR=0 $
					ELSE $
					TIME_DEPTH_GRID,DATE[OK],DEPTH[OK],DATA[OK],/LOG,DEPTH_INTERVAL=0.5,MDATE=[MINDATE,MAXDATE],MDEPTH=[MAXDEPTH,0],VRANGE=VRANGE,CUTOFF=[1,0],YTICKS=1,YTICKNAME=[' ',' ',' '],$
						/NODEPTH,DIMENSIONS=[500,50],AX_INTERVAL='MONTH',AY_GRID='YEAR',/FYEAR,YTITLE=' ',YMARGIN=Y2MARGIN,XMARGIN=X2MARGIN,CHARSIZE=CHARSIZE2,/INTERPOLATE,YMINOR=0,/NOXDATES
					LABEL = YSET(YTH).VALUE
					COOR = COORD_2PLOT(-0.08,0.3)
					XYOUTS, COOR.X,COOR.Y,LABEL, ALIGN=-0.1, CHARSIZE=TXTSIZE, COLOR=0, CHARTHICK=1
				ENDFOR
				IF CTH EQ N_ELEMENTS(CODES)-1 THEN $
					BAR=COLOR_BAR_SCALE(PROD='RATIO_12',POSITION=[0.92, 0.002, 0.945, 0.998],PAL='PAL_RATIO',CHARSIZE=2,FONT=0,TITLE=' ',/VERTICAL)
			ENDFOR
		ENDFOR
		PAL_36,R,G,B
		!Y.OMARGIN = [0,0]
		P = IDL_RESTORE(PHYTO_FILE)
		OK = WHERE(STRMID(P.DATE,0,4) GE 1998 AND STRMID(P.DATE,0,4) LE 2006)
		P = P[OK]
		PRANGE=[0,5]
		PY = PRANGE
		XMARGIN = [4,8]
		POS = [0.74 ,0.5,0.78,0.9]
		!Y.OMARGIN = [1,0]
		GROUPS = ['TOTAL_DIATOMS','MICROFLAGELLATES','DINOFLAGELLATES','OTHER','PHAEOCYSTIS']
		GPS = ['Diatoms','Microflagellates','Dinoflagellates','Other','Phaeocystis']
		LGD = 			GPS[0]
		LGD = [LGD, GPS[1]]
		LGD = [LGD, GPS(2)]
		LGD = [LGD, GPS(3)]
		LGD = [LGD, GPS(4)]
		LGD2 = 'Total Phytoplankton'
		PHTITLE = 'Total Phytoplankton!C!C(Cells L!U-1!N x 10!U6!N)'
		COLORS = [12,34,19,9,22]
		CIR = DRAW_CIRCLE(0,0,1,49)
		USERSYM, CIR(0,*),CIR(1,*),THICK=3,/FILL
		SYMSIZE=0.75
		!P.MULTI = [0,1,4]

		LOCATIONS = ['NORTH_SHORE','WEST_SHORE','CAPE_COD','EAST_MASS_BAY']
		STATIONS = ['F01','F02','F06','F13','F24','N18','F27','N04','N16']
		REGS = [' North Shore',' West Shore',' Cape Cod Bay','East Massachusetts Bay']
		OK = WHERE(P.SURFACE NE MISSINGS(''))
		SURF = P[OK]
		FOR NTH =0L, N_ELEMENTS(LOCATIONS)-1 DO BEGIN
			OK = WHERE(SURF.LOCATION EQ LOCATIONS[NTH] AND SURF.STATION NE 'F19',COUNT)
			IF LOCATIONS[NTH] EQ 'NORTH_SHORE' THEN OK = WHERE(SURF.LOCATION EQ LOCATIONS[NTH] OR SURF.STATION EQ 'F27')
			IF COUNT GE 30 THEN BEGIN
				SP  = SURF[OK]
				DD = WHERE_SETS(SP.EVENT)
				NEW = CREATE_STRUCT('EVENT','','DATE','','DEPTH',0.0,'N',0L,'TOTAL',0.0,'TOTAL_DIATOMS',0.0,'MICROFLAGELLATES',0.0,'DINOFLAGELLATES',0.0,'OTHER',0.0,'PHAEOCYSTIS',0.0)
				NEW = STRUCT_2MISSINGS(NEW)
				NEW = REPLICATE(NEW,N_ELEMENTS(DD))
				NAMES = TAG_NAMES(NEW)
				FOR DTH = 0L, N_ELEMENTS(DD)-1 DO BEGIN
					SUBS = WHERE_SETS_SUBS(DD(DTH))
					SPD = SP(SUBS)
					NEW(DTH).EVENT = DD(DTH).VALUE
					NEW(DTH).DATE = JD_2DATE(MEAN(DATE_2JD(SPD.DATE)))
					NEW(DTH).N = DD(DTH).N
					NEW(DTH).DEPTH = MEAN(SPD.DEPTH)
					NEW(DTH).TOTAL = MEAN(SPD.TOTAL)
					NEW(DTH).TOTAL_DIATOMS = MEAN(SPD.TOTAL_DIATOMS)
					NEW(DTH).MICROFLAGELLATES = MEAN(SPD.MICROFLAGELLATES)
					NEW(DTH).DINOFLAGELLATES = MEAN(SPD.DINOFLAGELLATES)
					NEW(DTH).OTHER = MEAN(SPD.OTHER)
					NEW(DTH).PHAEOCYSTIS = MEAN(SPD.PHAEOCYSTIS)
				ENDFOR
				NEW = NEW[SORT(NEW.DATE)]

				PDATE = DATE_2JD(NEW.DATE)
				YY = REPLICATE(8000,N_ELEMENTS(PDATE))
				AVEDEPTH = MEAN(NEW.DEPTH)
				PDEPTH = NEW.DEPTH
				TOT = NEW.TOTAL
				BOTTOM = 0
				PER1 = REPLICATE(0,N_ELEMENTS(NEW))
				XP = FINDGEN(N_ELEMENTS(NEW))
				FOR PTH = 0L, N_ELEMENTS(GROUPS) -1 DO BEGIN
					GROUP = GROUPS(PTH)
					POS = WHERE(NAMES EQ GROUP,COUNT)
					IF COUNT EQ 1 THEN PHY = NEW.(POS) ELSE STOP
					PER = (PHY/TOT)*100
					OK = WHERE(PHY EQ MISSINGS(0.0),COUNT) & IF COUNT GE 1 THEN PER[OK] = 0
					IF PTH EQ 0 THEN BEGIN
						IF NTH EQ N_ELEMENTS(LOCATIONS)-1 THEN XTICKNAME = AX.TICKNAME ELSE XTICKNAME = XTICKNAMES
						IF NTH EQ 0 OR NTH EQ N_ELEMENTS(LOCATIONS)-1 THEN YTITLE='Percent Composition (%)' ELSE YTITLE = ' '
						PLOT, AX.JD, PY,YTITLE=YTITLE,YRANGE=[0,100],/XSTYLE,YSTYLE=8,XMARGIN=XMARGIN,YMARGIN=YMARGIN,$
							XTICKS=AX.TICKS,XTICKNAME=XTICKNAME,XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,CHARSIZE=CHARSIZE,/NODATA
							BOT = REPLICATE(0, N_ELEMENTS(PER))
							YY = [PER,BOT]
							XX = [PDATE,REVERSE(PDATE)]
							POLYFILL, XX, YY, COLOR = COLORS(PTH)
					ENDIF
					PER1 = PER + PER1
					YY = [PER1,REVERSE(BOTTOM)]
					XX = [PDATE,REVERSE(PDATE)]
					IF PTH GE 1 THEN POLYFILL, XX, YY, COLOR = COLORS(PTH)
					BOTTOM = PER1
				ENDFOR
				GRIDS,X=AYR.TICKV, /NO_Y
				AXIS,XAXIS=0, XRANGE=AX.JD, CHARSIZE=CHARSIZE,XTICKS=N_ELEMENTS(AX.TICKV),XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,XTICKNAME=REPLICATE(' ',N_ELEMENTS(XTICKNAME)),COLOR=0,XTICKLEN=0.05
				AXIS,XAXIS=1, XRANGE=AX.JD, CHARSIZE=CHARSIZE,XTICKS=N_ELEMENTS(AX.TICKV),XTICKV=AX.TICKV,XTICK_GET=XTICK_GET,XTICKNAME=REPLICATE(' ',N_ELEMENTS(XTICKNAME)),COLOR=0,XTICKLEN=0.05
				CIR = DRAW_CIRCLE(0,0,1,49)
				USERSYM, CIR(0,*),CIR(1,*),THICK=3,/FILL
				IF NTH EQ 0 OR NTH EQ N_ELEMENTS(LOCATIONS)-1 THEN Y2TITLE = PHTITLE ELSE Y2TITLE = ' '
				AXIS,YAXIS=1,YRANGE=[0,10],/SAVE, YTITLE=Y2TITLE ,CHARSIZE=CHARSIZE
				OPLOT, PDATE,TOT/1000,COLOR=0,THICK=4,LINESTYLE=0,PSYM=-8,SYMSIZE=SYMSIZE
				LAB = REGS[NTH] ;+ '!CMean Depth = ' + STRMID(STRTRIM(AVEDEPTH,2),0,4) + ' m'
				COOR = COORD_2PLOT(0.01,0.85)
				XYOUTS, COOR.X,COOR.Y,LAB, ALIGN=-0.1, CHARSIZE=1.25, COLOR=0, CHARTHICK=1
				IF NTH EQ N_ELEMENTS(LOCATIONS)-1 THEN BEGIN
					USERSYM, [-3.5,1.5,1.5,-3.5],[-1.3,-1.3,1.7,1.7],THICK=3,/FILL
					LEGEND,LGD(0:2),POSITION=[0.2,-0.035],/NORMAL,BOX=0,/HORIZONTAL,PSYM=8,CHARSIZE=1.25,COLOR=COLORS(0:2)
					LEGEND,LGD(3:4),POSITION=[0.23,-0.055],/NORMAL,BOX=0,/HORIZONTAL,PSYM=8,CHARSIZE=1.25,COLOR=COLORS(3:4)
					CIR = DRAW_CIRCLE(0,0,1,49)
					USERSYM, CIR(0,*),CIR(1,*),THICK=3,/FILL
					LEGEND,LGD2,POSITION=[0.52,-0.055],/NORMAL,BOX=0,/HORIZONTAL,PSYM=8,CHARSIZE=1,COLOR=0,THICK=8,NUM=1
				ENDIF
			ENDIF
		ENDFOR
psprint
stop
		!Y.OMARGIN = [0,0]

		SKIP_FINAL:
	ENDIF





; *******************************************************
	IF DO_SEA_COMP GE 2 THEN BEGIN
; *******************************************************
		OVERWRITE = DO_SEA_COMP GE 2

; !M CHL AND PROD COMPOSITES


		PAL = 'PAL_SW3'
		BACKGROUND = 255

; UPWELLING EXAMPLE

;		PSPRINT,FILENAME=WINDROSE,/COLOR,/Full,/TIMES
;		!P.MULTI = [0,1,2]
		_DIR_OUT = 'D:\PROJECTS\MASS_BAY\PLOT\MANUSCRIPT3\'
;		E = IDL_RESTORE(ENV_DATA)
;		OK = WHERE(STRMID(E.DATE,0,8) GE '20000615' AND STRMID(E.DATE,0,8) LE '20000701',COUNT)
;		DIR = E[OK].WIND_DIR
;		SP = E[OK].WIND_SPEED
;		AD = 360 - (DIR - 90)
;		!P.THICK=4
;		PLOT, /POLAR, SP, !DTOR * DIR,XRANGE=[-10,10],YRANGE=[-10,10],XSTYLE=1,YSTYLE=1,XTICKS=4,YTICKS=4,XMINOR=5,YMINOR=5,CHARSIZE=2,$
;			XMARGIN=[6,6],YMARGIN=[0.25,0.25],/NODATA,COLOR=0,THICK=2,BACKGROUND=255
;		FOR NTH=0L, N_ELEMENTS(SP)-1 DO BEGIN
;			OPLOT, [0,SP[NTH]],[0,!DTOR*AD[NTH]], COLOR=0,SYMSIZE=0.25, PSYM=-2,/POLAR
;		ENDFOR
;		OPLOT,[0,0],[-8,8],COLOR=0,THICK=3
;		OPLOT,[-8,8],[0,0],COLOR=0,THICK=3
;		n_circ=[0.5,1.0]
;		!P.THICK=2
;	 	PlotS, DRAW_CIRCLE(0, 0, 4,361)
;	 	TXT = '4 ms!U-1!N'
;	 	COOR = COORD_2PLOT(0.62,0.53)
;		XYOUTS, COOR.X,COOR.Y,TXT, ALIGN=-0.1, CHARSIZE=1.35, COLOR=0, CHARTHICK=1
;	 	!P.THICK=3
;	 	PlotS, DRAW_CIRCLE(0, 0, 8,361)
;	 	TXT = '8 ms!U-1!N'
;	 	COOR = COORD_2PLOT(0.78,0.3)
;		XYOUTS, COOR.X,COOR.Y,TXT, ALIGN=-0.1, CHARSIZE=1.35, COLOR=0, CHARTHICK=1
;		LABEL = 'West												                                          								East'
;		COOR = COORD_2PLOT(0.0,-0.15)
;		XYOUTS,COOR.X,COOR.Y,LABEL, CHARSIZE=1.75, COLOR=0, CHARTHICK=1
;		LABEL = 'South																										                    North'
;		COOR = COORD_2PLOT(-0.12,0.0)
;		XYOUTS,COOR.X,COOR.Y,LABEL, CHARSIZE=1.78, COLOR=0, CHARTHICK=1, ORIENTATION=90
;
;	 	!P.THICK=1
;		PSPRINT
;		IMAGE_TRIM, WINDROSE, GRACE=[150,250,50,50],DPI=600, DIR_OUT=_DIR_OUT
;		ROSE = _DIR_OUT + 'WINDROSE-PS_1.PNG'


;		PX_OUT = 640
;		PY_OUT = 640
;		MAP_OUT = 'MASS_BAY'

		SFILE='E:\SST_GEQ-MASS_BAY\stats\!W_200027-N4ATG-MASS_BAY-SST-MEAN.SAVE'
		STRUCT_SD_2PNG,SFILE,/ADD_LAND,/ADD_COAST,/ADD_COLORBAR,SPECIAL_SCALE='MEDIUM',DIR_OUT = _DIR_OUT,/OVERWRITE,COLORBAR_TITLE=' ',PX_OUT=PX_OUT,PY_OUT=PY_OUT,MAP_OUT=MAP_OUT
		CFILE='F:\SEAWIFS_MLAC-MASS_BAY\stats\!W_200027-SEAWIFS-MASS_BAY-CHLOR_A-MB-MEAN.SAVE'
		STRUCT_SD_2PNG,CFILE,/ADD_LAND,/ADD_COAST,/ADD_COLORBAR,SPECIAL_SCALE='HIGH',DIR_OUT = _DIR_OUT,/OVERWRITE,COLORBAR_TITLE=' ',PX_OUT=PX_OUT,PY_OUT=PY_OUT,MAP_OUT=MAP_OUT
		PFILE='F:\SEAWIFS_MLAC-MASS_BAY\stats\!W_200027-SEAWIFS-MASS_BAY-PPD-VGMB-MEAN.SAVE'
		STRUCT_SD_2PNG,PFILE,/ADD_LAND,/ADD_COAST,/ADD_COLORBAR,SPECIAL_SCALE='LOW',DIR_OUT = _DIR_OUT,/OVERWRITE,COLORBAR_TITLE=' ' ,PX_OUT=PX_OUT,PY_OUT=PY_OUT,MAP_OUT=MAP_OUT
;
		FILES = [FILE_SEARCH(_DIR_OUT + '!W_200027*PXY_640_640*.PNG')]
		FOR NTH=0L, N_ELEMENTS(FILE)-1 DO BEGIN
			PS_IMAGE,	FILES=FILES[NTH], /COLOR,/center,FULL=full,SCALE=2.75
		ENDFOR

;		FOR NTH=0L, N_ELEMENTS(FILES)-1 DO BEGIN
;			NN = NTH
;			FN = FILE_PARSE(FILES[NTH])
;			IMAGE = READ_PNG(FILES[NTH],R,G,B)
;			TRUE  = IMAGE_2TRUE(IMAGE,R,G,B)
;			WRITE_PNG,'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/'+STRTRIM(STRING(NN),2)+'_TRUE_'+FN.FIRST_NAME+'.PNG',TRUE,R,G,B
;		ENDFOR

		SPACE = 20
		PX = 160
		PY = 160
		ROWS = 2
		COLS  = 3
		PNGFILE = 'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/WIND_COMPOSITE.PNG'
	;	IMAGE_WELD_PAGE,FILES=[FILES],ROWS=ROWS,COLS=COLS,PNGFILE=pngfile,SPACE=SPACE,PX=PX,py=PY,BACKGROUND=BACKGROUND,/NOTRIM


		IMAGE = READ_PNG(PNGFILE,r,g,b)
		PS_IMAGE,	FILES=PNGFILE, /COLOR,FULL=full,/NO_CLOSE,SCALE=1.5,/LANDSCAPE
		STITLE = 'Temperature ' + UNITS('SST',/NO_NAME)
		CTITLE = 'Chlorophyll !8a!7' + UNITS('CHLOR_A',/NO_NAME)
		PTITLE = 'Primary production ' + UNITS('PPD',/NO_NAME)
		X = -0.115
		Y = 0.955
		IX = 0.30
		JX = 0.575
		CHARSIZE = 0.65
		!P.FONT=0
		DEVICE,/COLOR
		CALL_PROCEDURE,PAL,R,G,B
		XYOUTS,X,Y,STITLE, ALIGN=-1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1,/NORMAL;,FONT=2
		XYOUTS,X+IX,Y,CTITLE, ALIGN=-1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1,/NORMAL;,FONT=3
		XYOUTS,X+JX,Y,PTITLE, ALIGN=-1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1,/NORMAL;,FONT=4
   DEVICE,/CLOSE





		ECHL = STRUCT_SD_READ('F:\SEAWIFS_MLAC-MASS_BAY\ts_images\anom\eof\!M-SEAWIFS-MASS_BAY-CHLOR_A-MB-EOF.SAVE',STRUCT=CSTRUCT)
		EPPD = STRUCT_SD_READ('F:\SEAWIFS_MLAC-MASS_BAY\ts_images\anom\eof\!M-SEAWIFS-MASS_BAY-PPD-VGMB-EOF.SAVE',STRUCT=PSTRUCT)

		PAL_SW3,R,G,B
		MAP = 'MASS_BAY'
		MASK = READ_LANDMASK(MAP=MAP,/STRUCT)
		CHL1 = CSTRUCT.EOF1 & OK = WHERE(CHL1 NE MISSINGS(0.0),COMPLEMENT=CCHL1)
		CHL1[OK] = BYTSCL(CHL1[OK],MIN=-0.02,MAX=0.02,TOP=250) & CHL1(CCHL1) = 252 & CHL1(MASK.LAND) = 252 & CHL1(MASK.COAST) = 0
		CHL2 = CSTRUCT.EOF2 & OK = WHERE(CHL2 NE MISSINGS(0.0),COMPLEMENT=CCHL2)
		CHL2[OK] = BYTSCL(CHL2[OK],MIN=-0.02,MAX=0.02,TOP=250) & CHL2(CCHL2) = 252   & CHL2(MASK.LAND) = 252 & CHL2(MASK.COAST) = 0
		CHL3 = CSTRUCT.EOF3 & OK = WHERE(CHL3 NE MISSINGS(0.0),COMPLEMENT=CCHL3)
		CHL3[OK] = BYTSCL(CHL3[OK],MIN=-0.02,MAX=0.02,TOP=250) & CHL3(CCHL3) = 252   & CHL3(MASK.LAND) = 252 & CHL3(MASK.COAST) = 0

		PPD1 = PSTRUCT.EOF1 & OK = WHERE(PPD1 NE MISSINGS(0.0),COMPLEMENT=CPPD1)
		PPD1[OK] = BYTSCL(PPD1[OK],MIN=-0.02,MAX=0.02,TOP=250) & PPD1(CPPD1) = 0 & PPD1(MASK.LAND) = 252 & PPD1(MASK.COAST) = 0
		PPD2 = PSTRUCT.EOF2 & OK = WHERE(PPD2 NE MISSINGS(0.0),COMPLEMENT=CPPD2)
		PPD2[OK] = BYTSCL(PPD2[OK],MIN=-0.02,MAX=0.02,TOP=250) & PPD2(CPPD2) = 0 & PPD2(MASK.LAND) = 252 & PPD2(MASK.COAST) = 0
		PPD3 = PSTRUCT.EOF3 & OK = WHERE(PPD3 NE MISSINGS(0.0),COMPLEMENT=CPPD3)
		PPD3[OK] = BYTSCL(PPD3[OK],MIN=-0.02,MAX=0.02,TOP=250) & PPD3(CPPD3) = 0 & PPD3(MASK.LAND) = 252 & PPD3(MASK.COAST) = 0

;		WRITE_PNG,'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/TRIM/CHL_EOF1.PNG',CONGRID(CHL1,640,640),R,G,B
;		WRITE_PNG,'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/TRIM/CHL_EOF2.PNG',CONGRID(CHL2,640,640),R,G,B
;		WRITE_PNG,'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/TRIM/CHL_EOF3.PNG',CONGRID(CHL3,640,640),R,G,B
;		WRITE_PNG,'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/TRIM/PPD_EOF1.PNG',CONGRID(PPD1,640,640),R,G,B
;		WRITE_PNG,'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/TRIM/PPD_EOF2.PNG',CONGRID(PPD2,640,640),R,G,B
;		WRITE_PNG,'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/TRIM/PPD_EOF3.PNG',CONGRID(PPD3,640,640),R,G,B


	;	IMAGE_TRIM, EOF_FIGURE, GRACE=[150,250,50,50],DPI=600, DIR_OUT='D:\PROJECTS\MASS_BAY\PLOT\MANUSCRIPT3\'
		EOF1 = 'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/TRIM/EOF_FIGURE-PS_1-trim.PNG'
		EOF2 = 'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/TRIM/EOF_FIGURE-PS_2-trim.PNG'
		ECHL1 = 'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/TRIM/CHL_EOF1.PNG'
		ECHL2 = 'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/TRIM/CHL_EOF2.PNG'
		ECHL3 = 'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/TRIM/CHL_EOF3.PNG'
		EPPD1 = 'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/TRIM/PPD_EOF1.PNG'
		EPPD2 = 'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/TRIM/PPD_EOF2.PNG'
		EPPD3 = 'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/TRIM/PPD_EOF3.PNG'

		SPACE = 20
		PX = 160
		PY = 160
		ROWS = 2
		COLS  = 2
		PNGFILEPPD = 'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/EOF_COMPOSITE_PPD.PNG'
		IMAGE_WELD_PAGE,FILES=[EPPD1,EPPD2],ROWS=ROWS,COLS=COLS,PNGFILE=pngfilePPD,SPACE=SPACE,PX=PX,py=PY,BACKGROUND=BACKGROUND,/NOTRIM
		ROWS = 1
		COLS  = 2
		PNGFILE1 = 'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/EOF_COMPOSITE1.PNG'
		IMAGE_WELD_PAGE,FILES=[ECHL1,EPPD1],ROWS=ROWS,COLS=COLS,PNGFILE=pngfile1,SPACE=SPACE,PX=PX,py=PY,BACKGROUND=BACKGROUND,/NOTRIM
		PNGFILE2 = 'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/EOF_COMPOSITE2.PNG'
		IMAGE_WELD_PAGE,FILES=[ECHL2,EPPD2],ROWS=ROWS,COLS=COLS,PNGFILE=pngfile2,SPACE=SPACE,PX=PX,py=PY,BACKGROUND=BACKGROUND,/NOTRIM
		PNGFILE3 = 'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/EOF_COMPOSITE3.PNG'
		IMAGE_WELD_PAGE,FILES=[ECHL3,EPPD3],ROWS=ROWS,COLS=COLS,PNGFILE=pngfile3,SPACE=SPACE,PX=PX,py=PY,BACKGROUND=BACKGROUND,/NOTRIM

;		PSFILE =  'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/EOF.PS'
;		IMAGE = READ_PNG(PNGFILE,r,g,b)
		PS_IMAGE,	FILES=PNGFILEPPD, /COLOR,FULL=full,/NO_CLOSE,SCALE=1.5,/LANDSCAPE
		X = -0.1225
		Y = 0.95
		IX = 0.505
		CHARSIZE = 1.1
		DEVICE,/COLOR
		CALL_PROCEDURE,PAL,R,G,B
		XYOUTS,X,Y,'Mode 1', ALIGN=-1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1,/NORMAL
		XYOUTS,X+IX,Y,'Mode 2', ALIGN=-1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1,/NORMAL
		;XYOUTS,X+2*IX,Y,'Mode 3', ALIGN=-1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1,/NORMAL


;;		TICKNAMES = ['0','5','10','15','20','25']
;;		COLORBAR,BOTTOM=36, NCOLORS=182, POSITION=[0.54, 0.555,0.97, 0.575],DIVISIONS=5, MINOR=1,charsize=2.5,TICKNAMES=TICKNAMES;, TITLE = 'Euphotic Production (gC m!E-2!N day!E-1!N)'

		BAR = COLOR_BAR_SCALE(minval=-0.02, maxval=0.02,MINCOLOR=1,maxcolor=250,TITLE='',CHARSIZE=1.5,$
										TRIM=TRIM,FONT=font,PX=px,PY=py,POS=[0.01, 0.45,0.99, 0.485], GRACE=grace, CUT=CUT,$
  									XTICKS=4, TICKLEN=-0.45,BACKGROUND=255,  PAL='PAL_SW3',/HORIZONTAL, /BOTTOM);,$
  									;XTICKv= [-0.02,-0.01,0,0.01,0.02],XTICKname = NUM2STR([-0.02,-0.01,0,0.01,0.02],TRIM=2)

		DEVICE,/CLOSE
STOP

		FILES = [ECHL1,EPPD1,EOF1,ECHL2,EPPD2,EOF2]
		FOR NTH=0L, N_ELEMENTS(FILES)-1 DO BEGIN
			NN = NTH
			FN = FILE_PARSE(FILES[NTH])
			IMAGE = READ_PNG(FILES[NTH],R,G,B)
			IF FILES[NTH] EQ EOF1 OR FILES[NTH] EQ EOF2 THEN IMAGE = ROTATE(IMAGE,1)
			TRUE  = IMAGE_2TRUE(IMAGE,R,G,B)
			WRITE_PNG,'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/TRIM/'+NUM2STR(NN)+'_TRUE_EOF.PNG',TRUE,R,G,B
		ENDFOR
		FILES = FILE_SEARCH('D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/TRIM/*TRUE*.PNG')
		SPACE = 20
		PX = 160
		PY = 160
		ROWS = 1
		COLS  = 2
		PNGFILE1 = 'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/EOF_COMPOSITE1.PNG'
		IMAGE_WELD_PAGE,FILES=FILES(0:1),ROWS=ROWS,COLS=COLS,PNGFILE=pngfile1,SPACE=SPACE,PX=PX,py=PY,BACKGROUND=BACKGROUND,/NOTRIM
		PNGFILE2 = 'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/EOF_COMPOSITE2.PNG'
		IMAGE_WELD_PAGE,FILES=FILES(3:4),ROWS=ROWS,COLS=COLS,PNGFILE=pngfile2,SPACE=SPACE,PX=PX,py=PY,BACKGROUND=BACKGROUND,/NOTRIM
		ROWS = 4
		COLS  = 1
		PNGFILE = 'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/EOF_COMPOSITE_FINAL.PNG'
	;	PFILES = [PNGFILE1,FILES(2),PNGFILE2,FILES(5)]
	;	IMAGE_WELD_PAGE,FILES=PFILES,ROWS=ROWS,COLS=COLS,PNGFILE=pngfile,SPACE=SPACE,PX=PX,py=PY,BACKGROUND=BACKGROUND,/NOTRIM
;		PSFILE =  'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/EOF.PS'
;		IMAGE = READ_PNG(PNGFILE,r,g,b)
;		PS_IMAGE,	FILES=PNGFILE, /COLOR,/center,FULL=full,/NO_CLOSE,SCALE=1.25
;		X = 0.018
;		Y = 0.96
;		IX = 0.51
;		IY = -0.5
;		CHARSIZE = 3
;		DEVICE,/COLOR
;		CALL_PROCEDURE,PAL,R,G,B
;;		XYOUTS,X,Y,'!7A', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1
;;		XYOUTS,X+IX,Y,'!7B', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1
;;		XYOUTS,X,Y+IY,'!7C', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1
;;		XYOUTS,X+IX,Y+IY,'!7D', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1
;;		TICKNAMES = ['0','5','10','15','20','25']
;;		COLORBAR,BOTTOM=36, NCOLORS=182, POSITION=[0.54, 0.555,0.97, 0.575],DIVISIONS=5, MINOR=1,charsize=2.5,TICKNAMES=TICKNAMES;, TITLE = 'Euphotic Production (gC m!E-2!N day!E-1!N)'
;
;
;    DEVICE,/CLOSE

stop



;		PRODS = ['CHLOR_A-MB','PPD-VGMB']
;		DIR_OUT = 'D:\PROJECTS\MASS_BAY\PLOT\MANUSCRIPT3\'
;		FOR PTH = 0L, N_ELEMENTS(PRODS)-1 DO BEGIN
;			APROD = PRODS(PTH)
;			IF APROD EQ 'CHLOR_A-MB' THEN BEGIN & _TITLE = UNITS('CHLOROPHYLL') & _SCALE = 'HIGH' & ENDIF
;			IF APROD EQ 'PPD-VGMB'   THEN BEGIN & _TITLE = UNITS('PRIMARY_PRODUCTION') & _SCALE = 'LOW' & ENDIF
;			FILES = FILELIST('F:\SEAWIFS_MLAC-MASS_BAY\stats\!M*' + PRODS(PTH) + '-MEAN.SAVE')
;			FP = PARSE_IT(FILES,/ALL)
;			OK = WHERE(FP.YEAR_START GE 1998 AND FP.YEAR_START LE 2006)
;			FILES = FILES[OK]
;	;		STRUCT_SD_2PNG,FILES,DIR_OUT=DIR_OUT+'TEMP_IMAGES\',/ADD_LAND,/ADD_COAST,PAL='PAL_SW3',/OVERWRITE,SPECIAL_SCALE=_SCALE
;			OUTFILE = DIR_OUT + 'TEMP_IMAGES\!M-' + APROD + '-COMPOSITE.PNG'
;			PNGFILE = DIR_OUT + '!M-' + APROD + '-COMPOSITE-FINAL.PNG'
;			ROWS = 10
;			COLS = 12
;			FILES2 = FILELIST(DIR_OUT+'TEMP_IMAGES\!M*' + APROD+'*-MEAN.PNG')
;	;		IMAGE_WELD_PAGE,FILES=FILES2,ROWS=ROWS,COLS=COLS,PNGFILE=OUTFILE,SPACE=SPACE,PX=PX,py=PY,BACKGROUND=BACKGROUND,/NOTRIM
;			PS_IMAGE,	FILES=OUTFILE, /COLOR,FULL=full,/LANDSCAPE,/NO_CLOSE,SCALE=0.355,XOFFSET=0.0,YOFFSET=26.8
;			CHARSIZE = 4
;			X = -0.005
;			Y = 1.01
;			IX = 0.0835
;			X2 = -0.085
;			Y2 = 0.98
;			IY = -0.10
;			BAR  = COLOR_BAR_SCALE(PROD=VALIDS('PRODS',APROD),POSITION=[0.05, 0.075,0.95, 0.095],PAL='PAL_SW3',CHARSIZE=3.5,/BOTTOM,TITLE=_TITLE,$
;						TICKLEN=-0.5, SPECIAL_SCALE=_SCALE,GRACE=[15,1,15,5],/CUT)
;			MONTHS = MONTH_NAMES([1,2,3,4,5,6,7,8,9,10,11,12],/SHORT)
;			YEARS  = ['1998','1999','2000','2001','2002','2003','2004','2005','2006']
;			FOR MTH = 0L, N_ELEMENTS(MONTHS)-1 DO BEGIN
;				XYOUTS,X+MTH*IX,Y,MONTHS(MTH),ALIGN=-1,COLOR=0,CHARSIZE=CHARSIZE,CHARTHICK=1,/NORMAL
;			ENDFOR
;			FOR YTH = 0L, N_ELEMENTS(YEARS)-1 DO BEGIN
;				XYOUTS,X2,Y2+YTH*IY,YEARS(YTH),ALIGN=-1,COLOR=0,CHARSIZE=CHARSIZE,CHARTHICK=1,/NORMAL
;			ENDFOR
;    	DEVICE,/CLOSE
;		ENDFOR

		PRODS = ['CHLOR_A-MB','PPD-VGMB']
		DIR_OUT = 'D:\PROJECTS\MASS_BAY\PLOT\MANUSCRIPT3\'
		FOR PTH = 0L, N_ELEMENTS(PRODS)-1 DO BEGIN
			APROD = PRODS(PTH)
			IF APROD EQ 'CHLOR_A-MB' THEN BEGIN & _TITLE = 'Chlorophyll !8a!7 Anomaly' & _SCALE = '14' & ENDIF
			IF APROD EQ 'PPD-VGMB'   THEN BEGIN & _TITLE = 'Primary Production Anomaly' & _SCALE = '14' & ENDIF
			FILES = FILELIST('F:\SEAWIFS_MLAC-MASS_BAY\anom\save\!M_*-!YEAR*' + PRODS(PTH) + '-MEAN*.SAVE')
			FP = PARSE_IT(FILES,/ALL)
			OK = WHERE(FP.YEAR_START GE 1998 AND FP.YEAR_START LE 2006)
			FILES = FILES[OK]
		;	STRUCT_SD_2PNG,USE_PROD='RATIO',FILES,DIR_OUT=DIR_OUT+'TEMP_IMAGES\',/ADD_LAND,/ADD_COAST,PAL='PAL_SW3',/OVERWRITE,SPECIAL_SCALE=_SCALE
			OUTFILE = DIR_OUT + 'TEMP_IMAGES\!M-!YEAR-' + APROD + '-COMPOSITE.PNG'
			PNGFILE = DIR_OUT + '!M-!YEAR-' + APROD + '-COMPOSITE-FINAL.PNG'
			ROWS = 10
			COLS = 12
			FILES2 = FILELIST(DIR_OUT+'TEMP_IMAGES\!M*-!YEAR*' + APROD+'*-MEAN-RATIO.PNG')
		;	IMAGE_WELD_PAGE,FILES=FILES2,ROWS=ROWS,COLS=COLS,PNGFILE=OUTFILE,SPACE=SPACE,PX=PX,py=PY,BACKGROUND=BACKGROUND,/NOTRIM
			PS_IMAGE,	FILES=OUTFILE, /COLOR,FULL=full,/LANDSCAPE,/NO_CLOSE,SCALE=0.355,XOFFSET=0.0,YOFFSET=26.8
			CHARSIZE = 4
			X = -0.005
			Y = 1.01
			IX = 0.0835
			X2 = -0.085
			Y2 = 0.98
			IY = -0.10
			BAR  = COLOR_BAR_SCALE(PROD='RATIO',POSITION=[0.05, 0.075,0.95, 0.095],PAL='PAL_SW3',CHARSIZE=3.5,/BOTTOM,TITLE=_TITLE,$
						TICKLEN=-0.5, SPECIAL_SCALE=_SCALE,GRACE=[15,1,15,5],/CUT)
			MONTHS = MONTH_NAMES([1,2,3,4,5,6,7,8,9,10,11,12],/SHORT)
			YEARS  = ['1998','1999','2000','2001','2002','2003','2004','2005','2006']
			FOR MTH = 0L, N_ELEMENTS(MONTHS)-1 DO BEGIN
				XYOUTS,X+MTH*IX,Y,MONTHS(MTH),ALIGN=-1,COLOR=0,CHARSIZE=CHARSIZE,CHARTHICK=1,/NORMAL
			ENDFOR
			FOR YTH = 0L, N_ELEMENTS(YEARS)-1 DO BEGIN
				XYOUTS,X2,Y2+YTH*IY,YEARS(YTH),ALIGN=-1,COLOR=0,CHARSIZE=CHARSIZE,CHARTHICK=1,/NORMAL
			ENDFOR
    	DEVICE,/CLOSE
		ENDFOR

;GOTO, DO_PINGS
STOP
;		FOR NTH=0L, N_ELEMENTS(FILES)-1 DO BEGIN
;			FA = PARSE_IT(FILES[NTH])
;			IM=STRUCT_SD_CONTOUR(FILES[NTH], LEVELS=[0.5],C_COLOR=[0],C_THICK=3, MED=7,MISS_COLOR=0, SPECIAL_SCALE='LOW',/ADD_LAND,/ADD_COASTM,/ADDDATE)
;			PNG_FILE = DIR_OUT + '2007\' + FA.NAME + '-CONTOUR.PNG'
;			WRITE_PNG,PNG_FILE,IM,R,G,B
;		ENDFOR
;		PPDFILE = DIR_OUT + '!MONTH-PPD-COMPOSITE-CONTOUR.PNG'
;		PNGFILE = DIR_OUT + '!MONTH-PPD-COMPOSITE-CONTOUR-FINAL.PNG'
;		ROWS = 3
;		COLS = 4
;		IMAGE_WELD_PAGE,FILES=FILELIST(DIR_OUT+'2007\'+'!MONTH*PPD*CONTOUR*'),ROWS=ROWS,COLS=COLS,PNGFILE=PPDfile,SPACE=SPACE,PX=PX,py=PY,BACKGROUND=BACKGROUND,/NOTRIM
;
;		PAGE  = READ_PNG(PPDFILE,R,G,B)
;		BAR  = COLOR_BAR_SCALE(PROD='PPD',POSITION=[0.1, 0.52,0.9, 0.58],PAL='PAL_SW3',CHARSIZE=1.5,/BOTTOM,TITLE=UNITS('PRIMARY_PRODUCTION'),$
;													TICKLEN=-0.75, SPECIAL_SCALE='LOW',GRACE=[15,1,15,5],/CUT)
;		PAGE = IMAGE_WELD(BAR,PAGE)
;
;		MONTHS = MONTH_NAMES([1,2,3,4,5,6,7,8,9,10,11,12],/SHORT)
;		SZ = SIZE(PAGE,/STRUCT)
;		PX = SZ.DIMENSIONS[0]
;		PY = SZ.DIMENSIONS[1]
;		X  = 0.005
;		Y  = 0.97
;		XX = 0.251
;		YY = -0.2925
;		CHARSIZE = 2
;		PAGE = MAP_ADD_TXT(PAGE,X,Y,MONTHS[0],      COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+XX,Y,MONTHS[1],   COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+2*XX,Y,MONTHS(2), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+3*XX,Y,MONTHS(3), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X,Y+YY,MONTHS(4), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+XX,Y+YY,MONTHS(5), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+2*XX,Y+YY,MONTHS(6),      COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+3*XX,Y+YY,MONTHS(7),   COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X,Y+2*YY,MONTHS(8), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+XX,Y+2*YY,MONTHS(9), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+2*XX,Y+2*YY,MONTHS(10),COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+3*XX,Y+2*YY,MONTHS(11),COLOR=0,charsize=charsize)
;
;		WRITE_PNG,PNGFILE,PAGE,R,G,B







;		MAKE SMALL BLANK TO FIT IN BETWEEN IMAGES
		IM = BYTARR(576,100)
		IM(*,*) = 255
		BLANK = 'D:\IDL\Images\BLANK_576_BY_100_IMAGE.PNG'
		WRITE_PNG,BLANK, IM, R,G,B

		IM = BYTARR(120,576)
		IM(*,*) = 255
		BLANK = 'D:\IDL\Images\BLANK_120_BY_576_IMAGE.PNG'
		WRITE_PNG,BLANK, IM, R,G,B

		IM = BYTARR(640,240)
		IM(*,*) = 255
		BLANK = 'D:\IDL\Images\BLANK_640_BY_240_IMAGE.PNG'
		WRITE_PNG,BLANK, IM, R,G,B

		BLANK = 'D:\IDL\IMAGES\BLANK_576_BY_576_IMAGE.PNG'
		BLANK2 = 'D:\IDL\IMAGES\BLANK_576_BY_100_IMAGE.PNG'
		BLANKA = 'D:\IDL\IMAGES\BLANK_120_BY_576_IMAGE.PNG'
		BLANKV= 'D:\IDL\IMAGES\BLANK_100_BY_576_IMAGE.PNG'
		BLANKS = 'D:\IDL\Images\BLANK_640_BY_240_IMAGE.PNG'

		SPACE = 20
		PX = 160
		PY = 160
		!P.FONT = 0
		FIGSIZE = 1.5

;;   BATHY MAP
;		PAL_BATHY,R,G,B
;		!P.CHARSIZE=2
;		FILE = 'D:\IDL\IMAGES\SRTM30-MASS_BAY-PXY_640_640-BATHY-SMOOTH_3.SAVE'
;		DIR_OUT='D:\PRESENTATIONS\ERF\'
;;		STRUCT_SD_2PNG, FILE, DIR_OUT=DIR_OUT,/ADD_LAND,/ADD_COAST,PAL='PAL_BATHY',/OVERWRITE,SPECIAL_SCALE='LOW'
;;		IM=STRUCT_SD_CONTOUR(FILE, LEVELS=[40,100],C_COLOR=[0,0],C_ANNOTATION=['40 m','100 m'],C_THICK=1, MED=14,MISS_COLOR=32, SPECIAL_SCALE='LOW',/ADD_LAND,/ADD_COAST)
;		PNG_FILE = DIR_OUT + 'SRTM30-MASS_BAY-PXY_640_640-BATHY-SMOOTH_3-CONTOUR.PNG'
;;		BAR=COLOR_BAR_SCALE(PROD='BATHY',PAL=_PAL,BACKGROUND=252,SPECIAL_SCALE='LOW',$
;;    	    PX=80, PY=600,charsize=1.5,pos=[.02,.04,.12,.94],TICKLEN= -0.8,TITLE=' ',/VERTICAL)
;;		IM = IMAGE_PASTE(IM,BAR,X=2.5,Y=20,BACKGROUND=252,/TRANSPARENT)
;;		IM = MAP_ADD_TXT(IM,0.001,0.925,'Depth (m)', 	COLOR=0,charsize=1.5,CHARTHICK=3)
;;		WRITE_PNG,PNG_FILE,IM,R,G,B

;;		MAP MONTHLY PROD
;		PAL_SW3,R,G,B
;		PAL = 'PAL_SW3'
;
;		FILES = FILELIST('F:\SEAWIFS_MLAC-MASS_BAY\stats\!MONTH*PPD-VGMB-MEAN.SAVE')
;;		STRUCT_SD_2PNG,FILES,DIR_OUT=DIR_OUT+'2007\',/ADD_LAND,/ADD_COAST,PAL='PAL_SW3',/OVERWRITE,SPECIAL_SCALE='LOW'
;		PPDFILE = DIR_OUT + '!MONTH-PPD-COMPOSITE2.PNG'
;		PNGFILE = DIR_OUT + '!MONTH-PPD-COMPOSITE-FINAL.PNG'
;		ROWS = 3
;		COLS = 4
;	;	IMAGE_WELD_PAGE,FILES=FILELIST(DIR_OUT+'2007\'+'!MONTH*PPD*'),ROWS=ROWS,COLS=COLS,PNGFILE=PPDfile,SPACE=SPACE,PX=PX,py=PY,BACKGROUND=BACKGROUND,/NOTRIM
;
;		PAGE  = READ_PNG(PPDFILE,R,G,B)
;		BAR  = COLOR_BAR_SCALE(PROD='PPD',POSITION=[0.1, 0.52,0.9, 0.58],PAL='PAL_SW3',CHARSIZE=1.5,/BOTTOM,TITLE=UNITS('PRIMARY_PRODUCTION'),$
;													TICKLEN=-0.75, SPECIAL_SCALE='LOW',GRACE=[15,1,15,5],/CUT)
;		PAGE = IMAGE_WELD(BAR,PAGE)
;
;		MONTHS = MONTH_NAMES([1,2,3,4,5,6,7,8,9,10,11,12],/SHORT)
;		SZ = SIZE(PAGE,/STRUCT)
;		PX = SZ.DIMENSIONS[0]
;		PY = SZ.DIMENSIONS[1]
;		X  = 0.005
;		Y  = 0.97
;		XX = 0.251
;		YY = -0.2925
;		CHARSIZE = 2
;		PAGE = MAP_ADD_TXT(PAGE,X,Y,MONTHS[0],      COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+XX,Y,MONTHS[1],   COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+2*XX,Y,MONTHS(2), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+3*XX,Y,MONTHS(3), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X,Y+YY,MONTHS(4), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+XX,Y+YY,MONTHS(5), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+2*XX,Y+YY,MONTHS(6),      COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+3*XX,Y+YY,MONTHS(7),   COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X,Y+2*YY,MONTHS(8), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+XX,Y+2*YY,MONTHS(9), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+2*XX,Y+2*YY,MONTHS(10),COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+3*XX,Y+2*YY,MONTHS(11),COLOR=0,charsize=charsize)
;
;		WRITE_PNG,PNGFILE,PAGE,R,G,B
;
;		FOR NTH=0L, N_ELEMENTS(FILES)-1 DO BEGIN
;			FA = PARSE_IT(FILES[NTH])
;			IM=STRUCT_SD_CONTOUR(FILES[NTH], LEVELS=[0.5],C_COLOR=[0],C_THICK=3, MED=7,MISS_COLOR=0, SPECIAL_SCALE='LOW',/ADD_LAND,/ADD_COASTM,/ADDDATE)
;			PNG_FILE = DIR_OUT + '2007\' + FA.NAME + '-CONTOUR.PNG'
;			WRITE_PNG,PNG_FILE,IM,R,G,B
;		ENDFOR
;		PPDFILE = DIR_OUT + '!MONTH-PPD-COMPOSITE-CONTOUR.PNG'
;		PNGFILE = DIR_OUT + '!MONTH-PPD-COMPOSITE-CONTOUR-FINAL.PNG'
;		ROWS = 3
;		COLS = 4
;		IMAGE_WELD_PAGE,FILES=FILELIST(DIR_OUT+'2007\'+'!MONTH*PPD*CONTOUR*'),ROWS=ROWS,COLS=COLS,PNGFILE=PPDfile,SPACE=SPACE,PX=PX,py=PY,BACKGROUND=BACKGROUND,/NOTRIM
;
;		PAGE  = READ_PNG(PPDFILE,R,G,B)
;		BAR  = COLOR_BAR_SCALE(PROD='PPD',POSITION=[0.1, 0.52,0.9, 0.58],PAL='PAL_SW3',CHARSIZE=1.5,/BOTTOM,TITLE=UNITS('PRIMARY_PRODUCTION'),$
;													TICKLEN=-0.75, SPECIAL_SCALE='LOW',GRACE=[15,1,15,5],/CUT)
;		PAGE = IMAGE_WELD(BAR,PAGE)
;
;		MONTHS = MONTH_NAMES([1,2,3,4,5,6,7,8,9,10,11,12],/SHORT)
;		SZ = SIZE(PAGE,/STRUCT)
;		PX = SZ.DIMENSIONS[0]
;		PY = SZ.DIMENSIONS[1]
;		X  = 0.005
;		Y  = 0.97
;		XX = 0.251
;		YY = -0.2925
;		CHARSIZE = 2
;		PAGE = MAP_ADD_TXT(PAGE,X,Y,MONTHS[0],      COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+XX,Y,MONTHS[1],   COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+2*XX,Y,MONTHS(2), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+3*XX,Y,MONTHS(3), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X,Y+YY,MONTHS(4), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+XX,Y+YY,MONTHS(5), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+2*XX,Y+YY,MONTHS(6),      COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+3*XX,Y+YY,MONTHS(7),   COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X,Y+2*YY,MONTHS(8), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+XX,Y+2*YY,MONTHS(9), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+2*XX,Y+2*YY,MONTHS(10),COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+3*XX,Y+2*YY,MONTHS(11),COLOR=0,charsize=charsize)
;
;		WRITE_PNG,PNGFILE,PAGE,R,G,B
;stop


;;		MAP MONTHLY CHL AND PROD
;		PAL_SW3,R,G,B
;		PAL = 'PAL_SW3'
;		FILES = FILELIST('F:\SEAWIFS_MLAC-MASS_BAY\stats\!MONTH*CHLOR_A-MB-MEAN.SAVE');
;;		STRUCT_SD_2PNG,FILES,DIR_OUT=DIR_OUT+'2007\',/ADD_LAND,/ADD_COAST,PAL='PAL_SW3',/OVERWRITE
;		FILES = FILELIST('F:\SEAWIFS_MLAC-MASS_BAY\stats\!MONTH*PPD-VGMB-MEAN.SAVE')
;;		STRUCT_SD_2PNG,FILES,DIR_OUT=DIR_OUT+'2007\',/ADD_LAND,/ADD_COAST,PAL='PAL_SW3',/OVERWRITE,SPECIAL_SCALE='LOW'
;		FILES = [FILELIST(DIR_OUT+'2007\'+'!MONTH*CHLOR_A*'),REPLICATE(BLANKS,6),FILELIST(DIR_OUT+'2007\'+'!MONTH*PPD*'),REPLICATE(BLANKS,6)]
;		CHLFILE = DIR_OUT + '!MONTH-CHLOR_A-COMPOSITE.PNG'
;		PPDFILE = DIR_OUT + '!MONTH-PPD-COMPOSITE.PNG'
;		PNGFILE = DIR_OUT + '!MONTH-CHLOR_A-PPD-COMPOSITE-FINAL.PNG'
;		ROWS = 2
;		COLS = 6
;;		IMAGE_WELD_PAGE,FILES=FILELIST(DIR_OUT+'2007\'+'!MONTH*CHLOR_A*'),ROWS=ROWS,COLS=COLS,PNGFILE=CHLfile,SPACE=SPACE,PX=PX,py=PY,BACKGROUND=BACKGROUND,/NOTRIM
;;		IMAGE_WELD_PAGE,FILES=FILELIST(DIR_OUT+'2007\'+'!MONTH*PPD*'),    ROWS=ROWS,COLS=COLS,PNGFILE=PPDfile,SPACE=SPACE,PX=PX,py=PY,BACKGROUND=BACKGROUND,/NOTRIM
;
;		CHL  = READ_PNG(CHLFILE,R,G,B)
;		PPD  = READ_PNG(PPDFILE,R,G,B)
;		BAR  = COLOR_BAR_SCALE(PROD='CHLOR_A',POSITION=[0.1, 0.52,0.9, 0.58],PAL='PAL_SW3',CHARSIZE=1.5,/BOTTOM,TITLE=UNITS('CHLOROPHYLL'),$
;													TICKLEN=-0.75,GRACE=[15,1,15,5],/CUT)
;		PAGE = IMAGE_WELD(BAR,CHL)
;		PAGE = IMAGE_WELD(PPD,PAGE)
;		BAR  = COLOR_BAR_SCALE(PROD='PPD',POSITION=[0.1, 0.52,0.9, 0.58],PAL='PAL_SW3',CHARSIZE=1.5,/BOTTOM,TITLE=UNITS('PRIMARY_PRODUCTION'),$
;													TICKLEN=-0.75, SPECIAL_SCALE='LOW',GRACE=[15,1,15,5],/CUT)
;		PAGE = IMAGE_WELD(BAR,PAGE)
;
;		MONTHS = MONTH_NAMES([1,2,3,4,5,6,7,8,9,10,11,12],/SHORT)
;		SZ = SIZE(PAGE,/STRUCT)
;		PX = SZ.DIMENSIONS[0]
;		PY = SZ.DIMENSIONS[1]
;		X  = 0.005
;		Y  = 0.97
;		XX = 0.1667
;		YY = -0.18
;		CHARSIZE = 1.9
;		PAGE = MAP_ADD_TXT(PAGE,X,Y,MONTHS[0],      COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+XX,Y,MONTHS[1],   COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+2*XX,Y,MONTHS(2), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+3*XX,Y,MONTHS(3), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+4*XX,Y,MONTHS(4), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+5*XX,Y,MONTHS(5), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X,Y+YY,MONTHS(6),      COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+XX,Y+YY,MONTHS(7),   COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+2*XX,Y+YY,MONTHS(8), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+3*XX,Y+YY,MONTHS(9), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+4*XX,Y+YY,MONTHS(10),COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+5*XX,Y+YY,MONTHS(11),COLOR=0,charsize=charsize)
;		Y = 0.47
;		PAGE = MAP_ADD_TXT(PAGE,X,Y,MONTHS[0],      COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+XX,Y,MONTHS[1],   COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+2*XX,Y,MONTHS(2), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+3*XX,Y,MONTHS(3), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+4*XX,Y,MONTHS(4), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+5*XX,Y,MONTHS(5), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X,Y+YY,MONTHS(6),      COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+XX,Y+YY,MONTHS(7),   COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+2*XX,Y+YY,MONTHS(8), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+3*XX,Y+YY,MONTHS(9), COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+4*XX,Y+YY,MONTHS(10),COLOR=0,charsize=charsize)
;		PAGE = MAP_ADD_TXT(PAGE,X+5*XX,Y+YY,MONTHS(11),COLOR=0,charsize=charsize)
;
;		WRITE_PNG,PNGFILE,PAGE,R,G,B
;STOP
;		X = 0.018
;		Y = 0.96
;		IX = 0.51
;		IY = -0.33
;		CHARSIZE = 1
;		DEVICE,/COLOR
;		CALL_PROCEDURE,PAL,R,G,B
;		TICKNAMES = ['100','275','775','2150','6000']
;;		TITLE = ['March','April','May']
;;		XYOUTS,0.13,1.01,TITLE[0], ALIGN=-0.1, CHARSIZE=1.25, COLOR=0, CHARTHICK=1, /NORMAL
;;		XYOUTS,0.46,1.01,TITLE[1], ALIGN=-0.1, CHARSIZE=1.25, COLOR=0, CHARTHICK=1, /NORMAL
;;		XYOUTS,0.78,1.01,TITLE(2), ALIGN=-0.1, CHARSIZE=1.25, COLOR=0, CHARTHICK=1, /NORMAL
;
;		DEVICE,/CLOSE
;
;STOP

		PAL_SW3,R,G,B
		PAL = 'PAL_SW3'
;		SPRING 2000
		FILEC3 = 'D:\PROJECTS\MASS_BAY\SEAWIFS\MASS_BAY\MB_CHLOR_A_CORRECTED\AVERAGE_IMAGES\YM_200003_AVE.PNG'
		FILEC4 = 'D:\PROJECTS\MASS_BAY\SEAWIFS\MASS_BAY\MB_CHLOR_A_CORRECTED\AVERAGE_IMAGES\YM_200004_AVE.PNG'
		FILEC5 = 'D:\PROJECTS\MASS_BAY\SEAWIFS\MASS_BAY\MB_CHLOR_A_CORRECTED\AVERAGE_IMAGES\YM_200005_AVE.PNG'

		FILEP3 = 'D:\PROJECTS\MASS_BAY\SEAWIFS\MASS_BAY\MB_VGPM_MB2\AVERAGE_IMAGES\YM_200003_AVE.PNG'
		FILEP4 = 'D:\PROJECTS\MASS_BAY\SEAWIFS\MASS_BAY\MB_VGPM_MB2\AVERAGE_IMAGES\YM_200004_AVE.PNG'
		FILEP5 = 'D:\PROJECTS\MASS_BAY\SEAWIFS\MASS_BAY\MB_VGPM_MB2\AVERAGE_IMAGES\YM_200005_AVE.PNG'

		FILES = [BLANKV,FILEC3,FILEC4,FILEC5,BLANKA,$
						 BLANKV,FILEP3,FILEP4,FILEP5,BLANKA]


		FILES = [FILEP3,FILEP4,FILEP5,BLANK2]
		ROWS = 2
		COLS = 3
		PNGFILE = 'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/SEAWIFS_WS_2000.PNG'
;		IMAGE_WELD_PAGE,FILES=FILES,ROWS=ROWS,COLS=COLS,PNGFILE=pngfile,SPACE=SPACE,PX=PX,py=PY,BACKGROUND=BACKGROUND,/NOTRIM
		DIR_OUT = 'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/'
		PS_IMAGE,	FILES=PNGFILE, /COLOR,FULL=full,/NO_CLOSE,SCALE=1.5,/landscape
		X = 0.018
		Y = 0.96
		IX = 0.51
		IY = -0.33
		CHARSIZE = 1
		DEVICE,/COLOR
		CALL_PROCEDURE,PAL,R,G,B
		TICKNAMES = ['100','275','775','2150','6000']
		COLORBAR,BOTTOM=70, NCOLORS=165,POSITION=[0.1, 0.22,0.9, 0.27],DIVISIONS=4, MINOR=1,charsize=CHARSIZE,/xlog,TICKNAMES=TICKNAMES;, TITLE = 'Euphotic Production (gC m!E-2!N day!E-1!N)'
		TITLE = '!7Primary Production (gC m!E-2!N d!E-1!N)'
		XYOUTS,0.275,0.08,TITLE, ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, /NORMAL
		TITLE = ['March','April','May']
		XYOUTS,0.13,1.01,TITLE[0], ALIGN=-0.1, CHARSIZE=1.25, COLOR=0, CHARTHICK=1, /NORMAL
		XYOUTS,0.46,1.01,TITLE[1], ALIGN=-0.1, CHARSIZE=1.25, COLOR=0, CHARTHICK=1, /NORMAL
		XYOUTS,0.78,1.01,TITLE(2), ALIGN=-0.1, CHARSIZE=1.25, COLOR=0, CHARTHICK=1, /NORMAL

		DEVICE,/CLOSE

;; UPWELLING EXAMPLE

;;;FILE='E:\SST_GEQ-MASS_BAY\stats\!W_200129-N4ATG-MASS_BAY-SST-MEAN.SAVE'
;;;STRUCT_SD_2PNG,FILE,/ADD_LAND,/ADD_COAST,/ADD_COLORBAR,SPECIAL_SCALE='MEDIUM',DIR_OUT = 'D:\PROJECTS\MASS_BAY\PLOT\MANUSCRIPT3\',/OVERWRITE,COLORBAR_TITLE=UNITS('SST')



;		PSPRINT,FILENAME=WINDROSE,/COLOR,/Full,/TIMES
;		!P.MULTI = [0,2,3]
;		E = IDL_RESTORE(ENV_DATA)
;		OK = WHERE(STRMID(E.DATE,0,8) GE '20010601' AND STRMID(E.DATE,0,8) LE '20010730',COUNT)
;		DIR = E[OK].WIND_DIR
;		SP = E[OK].WIND_SPEED
;		AD = 360 - (DIR - 90)
;		!P.THICK=4
;		PLOT, /POLAR, SP, !DTOR * DIR,XRANGE=[-10,10],YRANGE=[-10,10],XSTYLE=1,YSTYLE=1,XTICKS=4,YTICKS=4,XMINOR=5,YMINOR=5,CHARSIZE=2,$
;			XMARGIN=[6,6],YMARGIN=[0.25,0.25],/NODATA,COLOR=0,THICK=2,BACKGROUND=255
;		FOR NTH=0L, N_ELEMENTS(SP)-1 DO BEGIN
;			OPLOT, [0,SP[NTH]],[0,!DTOR*AD[NTH]], COLOR=0,SYMSIZE=0.25, PSYM=-2,/POLAR
;		ENDFOR
;		OPLOT,[0,0],[-8,8],COLOR=0,THICK=3
;		OPLOT,[-8,8],[0,0],COLOR=0,THICK=3
;		n_circ=[0.5,1.0]
;		!P.THICK=2
;	 	PlotS, DRAW_CIRCLE(0, 0, 4,361)
;	 	TXT = '4 ms!U-1!N'
;	 	COOR = COORD_2PLOT(0.62,0.53)
;		XYOUTS, COOR.X,COOR.Y,TXT, ALIGN=-0.1, CHARSIZE=1.35, COLOR=0, CHARTHICK=1
;	 	!P.THICK=3
;	 	PlotS, DRAW_CIRCLE(0, 0, 8,361)
;	 	TXT = '8  ms!U-1!N'
;	 	COOR = COORD_2PLOT(0.78,0.3)
;		XYOUTS, COOR.X,COOR.Y,TXT, ALIGN=-0.1, CHARSIZE=1.35, COLOR=0, CHARTHICK=1
;	 	!P.THICK=1
;		PSPRINT
;		IMAGE_TRIM, WINDROSE, GRACE=[150,250,50,50],DPI=600, DIR_OUT='D:\PROJECTS\MASS_BAY\PLOT\MANUSCRIPT3\'
		WINDFILE = FILE_SEARCH('D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/WINDROSE*TRIM*.PNG')
		TEMPFILE = FILE_SEARCH('D:/PROJECTS/MASS_BAY/SEAWIFS/MASS_BAY/MB_SST/AVERAGE_IMAGES/8_DAY/D8_20010715*.PNG')
		CHLFILE  = FILE_SEARCH('D:/PROJECTS/MASS_BAY/SEAWIFS/MASS_BAY/MB_CHLOR_A_CORRECTED/AVERAGE_IMAGES/8_DAY/D8_20010722*.PNG')
		PRODFILE = FILE_SEARCH('D:/PROJECTS/MASS_BAY/SEAWIFS/MASS_BAY/MB_VGPM_MB2/AVERAGE_IMAGES/8_DAY/D8_20010722*.PNG')

;		FILES = [WINDFILE,TEMPFILE,BLANK2,BLANK2,CHLFILE,PRODFILE,BLANK2,BLANK2]
;		FOR NTH=0L, N_ELEMENTS(FILES)-1 DO BEGIN
;			NN = NTH
;			FN = FILE_PARSE(FILES[NTH])
;			IMAGE = READ_PNG(FILES[NTH],R,G,B)
;			TRUE  = IMAGE_2TRUE(IMAGE,R,G,B)
;			WRITE_PNG,'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/'+STRTRIM(STRING(NN),2)+'_TRUE_'+FN.FIRST_NAME+'.PNG',TRUE,R,G,B
;		ENDFOR
;		FILES = FILE_SEARCH('D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/*TRUE*.PNG')
;		ROWS = 4
;		COLS  = 2
		PNGFILE = 'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/WIND_ROSE_EXAMPLE.PNG'
;		IMAGE_WELD_PAGE,FILES=FILES,ROWS=ROWS,COLS=COLS,PNGFILE=pngfile,SPACE=SPACE,PX=PX,py=PY,BACKGROUND=BACKGROUND,/NOTRIM
		PSFILE =  'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/WIND_ROSE_EXAMPLE.PNG'
		IMAGE = READ_PNG(PNGFILE,r,g,b)
		PS_IMAGE,	FILES=PNGFILE, /COLOR,/center,FULL=full,/NO_CLOSE,SCALE=0.5
		X = 0.018
		Y = 0.96
		IX = 0.51
		IY = -0.5
		CHARSIZE = 3
		DEVICE,/COLOR
		CALL_PROCEDURE,PAL,R,G,B
		XYOUTS,X,Y,'!7A', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1
		XYOUTS,X+IX,Y,'!7B', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1
		XYOUTS,X,Y+IY,'!7C', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1
		XYOUTS,X+IX,Y+IY,'!7D', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1
		TICKNAMES = ['0','5','10','15','20','25']
		COLORBAR,BOTTOM=36, NCOLORS=182, POSITION=[0.54, 0.555,0.97, 0.575],DIVISIONS=5, MINOR=1,charsize=2.5,TICKNAMES=TICKNAMES;, TITLE = 'Euphotic Production (gC m!E-2!N day!E-1!N)'
		TITLE = '!7 Temperature (!Eo!NC)'
		XYOUTS,0.61,0.505,TITLE, ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1
		TICKNAMES = ['0.1','0.2','0.4','0.7','1.4','2.7','5','10','20']
		COLORBAR,BOTTOM=75, NCOLORS=173, POSITION=[0.04, 0.05,0.46, 0.07],DIVISIONS=8, MINOR=1,charsize=2.5,/xlog,TICKNAMES=TICKNAMES
		TITLE = '!7 Chlorophyll !8a!7 (mg m!U-3!N)'
		XYOUTS,0.05,-0.01,TITLE, ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1
		TICKNAMES = ['100','275','775','2150','6000']
		COLORBAR,BOTTOM=70, NCOLORS=165, POSITION=[0.54, 0.05,0.97, 0.07],DIVISIONS=4, MINOR=1,charsize=2.5,/xlog,TICKNAMES=TICKNAMES;, TITLE = 'Euphotic Production (gC m!E-2!N day!E-1!N)'
		TITLE = '!7Primary Production (gC m!E-2!N d!E-1!N)'
		XYOUTS,0.485,-0.01,TITLE, ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1
		LABEL = 'West																														East'
		XYOUTS,0.05,0.55,LABEL, ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1
		LABEL = 'South																																	North'
		XYOUTS,0.01,0.6,LABEL, ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, ORIENTATION=90
    DEVICE,/CLOSE


;		CAPE COD BAY
		FILEC1 = 'D:\PROJECTS\MASS_BAY\SEAWIFS\MASS_BAY\MB_CHLOR_A_CORRECTED\AVERAGE_IMAGES\MON_01_AVE.PNG'
		FILEC2 = 'D:\PROJECTS\MASS_BAY\SEAWIFS\MASS_BAY\MB_CHLOR_A_CORRECTED\AVERAGE_IMAGES\MON_02_AVE.PNG'
		FILEC3 = 'D:\PROJECTS\MASS_BAY\SEAWIFS\MASS_BAY\MB_CHLOR_A_CORRECTED\AVERAGE_IMAGES\MON_03_AVE.PNG'
		FILEA1 = 'D:\PROJECTS\MASS_BAY\SEAWIFS\MASS_BAY\MB_CHLOR_A_CORRECTED\ANOMALY_IMAGES\MON_01_ANAM.PNG'
		FILEA2 = 'D:\PROJECTS\MASS_BAY\SEAWIFS\MASS_BAY\MB_CHLOR_A_CORRECTED\ANOMALY_IMAGES\MON_02_ANAM.PNG'
		FILEA3 = 'D:\PROJECTS\MASS_BAY\SEAWIFS\MASS_BAY\MB_CHLOR_A_CORRECTED\ANOMALY_IMAGES\MON_03_ANAM.PNG'
		FILEP1 = 'D:\PROJECTS\MASS_BAY\SEAWIFS\MASS_BAY\MB_VGPM_MB2\AVERAGE_IMAGES\MON_01_AVE.PNG'
		FILEP2 = 'D:\PROJECTS\MASS_BAY\SEAWIFS\MASS_BAY\MB_VGPM_MB2\AVERAGE_IMAGES\MON_02_AVE.PNG'
		FILEP3 = 'D:\PROJECTS\MASS_BAY\SEAWIFS\MASS_BAY\MB_VGPM_MB2\AVERAGE_IMAGES\MON_03_AVE.PNG'
		FILEB1 = 'D:\PROJECTS\MASS_BAY\SEAWIFS\MASS_BAY\MB_VGPM_MB2\ANOMALY_IMAGES\MON_01_ANAM.PNG'
		FILEB2 = 'D:\PROJECTS\MASS_BAY\SEAWIFS\MASS_BAY\MB_VGPM_MB2\ANOMALY_IMAGES\MON_02_ANAM.PNG'
		FILEB3 = 'D:\PROJECTS\MASS_BAY\SEAWIFS\MASS_BAY\MB_VGPM_MB2\ANOMALY_IMAGES\MON_03_ANAM.PNG'

		FILES = [BLANKV,FILEC1,FILEC2,FILEC3,BLANKA,$
						 BLANKV,FILEA1,FILEA2,FILEA3,BLANKA,$
						 BLANKV,FILEP1,FILEP2,FILEP3,BLANKA,$
						 BLANKV,FILEB1,FILEB2,FILEB3,BLANKA]


		ROWS = 4
		COLS = 5
		PNGFILE = 'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/CAPECODBAY_SPRING.PNG'
;		IMAGE_WELD_PAGE,FILES=FILES,ROWS=ROWS,COLS=COLS,PNGFILE=pngfile,SPACE=SPACE,PX=PX,py=PY,BACKGROUND=BACKGROUND,/NOTRIM
		DIR_OUT = 'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/'
		PS_IMAGE,	FILES=PNGFILE, /COLOR,/center,FULL=full,/NO_CLOSE,SCALE=1.2
		X = 0.018
		Y = 0.96
		IX = 0.51
		IY = -0.33
		CHARSIZE = 1
		DEVICE,/COLOR
		CALL_PROCEDURE,PAL,R,G,B

		TICKNAMES = ['0.1','0.2','0.4','0.7','1.4','2.7','5','10','20']
		COLORBAR,BOTTOM=75, NCOLORS=173,/RIGHT,/VERTICAL, POSITION=[0.94, 0.77,0.96, 0.99],DIVISIONS=8, MINOR=1,charsize=CHARSIZE,/xlog,TICKNAMES=TICKNAMES
		TITLE = '!7 Chlorophyll !8a!7 (mg m!U-3!N)'
		XYOUTS,0.035,0.975,TITLE, ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1
		COLORBAR,BOTTOM=2, NCOLORS=248,/RIGHT,/VERTICAL, POSITION=[0.94, 0.52,0.96, 0.74],DIVISIONS=6,RANGE=[0.1,10],TICKNAMES=['0.1','0.25','0.45','1','2','4.5','10'],/YLOG,MINOR=0, FORMAT='(F10.2)',charsize=CHARSIZE,FONT=FONT
		TITLE = '!7 Chlorophyll Anomaly'
		XYOUTS,0.035,0.725,TITLE, ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1
		TICKNAMES = ['100','275','775','2150','6000']
		COLORBAR,BOTTOM=70, NCOLORS=165, /RIGHT,/VERTICAL, POSITION=[0.94, 0.265,0.96, 0.485],DIVISIONS=4, MINOR=1,charsize=CHARSIZE,/xlog,TICKNAMES=TICKNAMES;, TITLE = 'Euphotic Production (gC m!E-2!N day!E-1!N)'
		TITLE = '!7Primary Production (gC m!E-2!N d!E-1!N)'
		XYOUTS,0.035,0.475,TITLE, ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1
		COLORBAR,BOTTOM=2, NCOLORS=248,/RIGHT,/VERTICAL, POSITION=[0.94, 0.01,0.96, 0.23],DIVISIONS=6,RANGE=[0.1,10],TICKNAMES=['0.1','0.25','0.45','1','2','4.5','10'],/YLOG,MINOR=0, FORMAT='(F10.2)',charsize=CHARSIZE,FONT=FONT
		TITLE = '!7 Production Anomaly'
		XYOUTS,0.035,0.225,TITLE, ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1
		TITLE = '!7 January																									February																										March'
		XYOUTS,0.12,1.01,TITLE, ALIGN=-0.1, CHARSIZE=1.25, COLOR=0, CHARTHICK=1
    DEVICE,/CLOSE

;		CAPE COD BAY 2
		FILEC1 = 'D:\PROJECTS\MASS_BAY\SEAWIFS\MASS_BAY\MB_CHLOR_A_CORRECTED\AVERAGE_IMAGES\MON_01_AVE.PNG'
		FILEC2 = 'D:\PROJECTS\MASS_BAY\SEAWIFS\MASS_BAY\MB_CHLOR_A_CORRECTED\AVERAGE_IMAGES\MON_02_AVE.PNG'
		FILEC3 = 'D:\PROJECTS\MASS_BAY\SEAWIFS\MASS_BAY\MB_CHLOR_A_CORRECTED\AVERAGE_IMAGES\MON_12_AVE.PNG'

		FILES = [BLANKV,FILEC1,FILEC2,BLANKA,FILEC3]
		ROWS = 2
		COLS = 5
		PNGFILE = 'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/CAPECODBAY.PNG'
	;	IMAGE_WELD_PAGE,FILES=FILES,ROWS=ROWS,COLS=COLS,PNGFILE=pngfile,SPACE=SPACE,PX=PX,py=PY,BACKGROUND=BACKGROUND,/NOTRIM
		DIR_OUT = 'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/'

		PS_IMAGE,	FILES=PNGFILE, /COLOR,FULL=full,/NO_CLOSE,SCALE=1.5,/landscape
		X = 0.018
		Y = 0.96
		IX = 0.51
		IY = -0.33
		CHARSIZE = 1
		DEVICE,/COLOR
		CALL_PROCEDURE,PAL,R,G,B
		TICKNAMES = ['0.1','0.2','0.4','0.7','1.4','2.7','5','10','20']
		COLORBAR,BOTTOM=75, NCOLORS=173, POSITION=[0.1, 0.32,0.90, 0.37],DIVISIONS=8, MINOR=1,charsize=CHARSIZE,/xlog,TICKNAMES=TICKNAMES
		TITLE = '!7 Chlorophyll !8a!7 (mg m!U-3!N)'
		XYOUTS,0.355,0.18,TITLE, ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1
		TITLE = ['January','February','December']
		XYOUTS,0.145,1.01,TITLE[0], ALIGN=-0.1, CHARSIZE=1.25, COLOR=0, CHARTHICK=1
		XYOUTS,0.43,1.01,TITLE[1], ALIGN=-0.1, CHARSIZE=1.25, COLOR=0, CHARTHICK=1
		XYOUTS,0.785,1.01,TITLE(2), ALIGN=-0.1, CHARSIZE=1.25, COLOR=0, CHARTHICK=1
    DEVICE,/CLOSE

;		WINTER 1999
		FILES = FILE_SEARCH('D:\PROJECTS\MASS_BAY\SEAWIFS\MASS_BAY\MB_VGPM_MB2\AVERAGE_IMAGES/SEA_1999_1W_AVE.PNG')
		FILES = [FILES,BLANK]
		ROWS = 2
		COLS  = 1
		PNGFILE = 'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/SEAWIFS_WINTER_1999.PNG'
;		IMAGE_WELD_PAGE,FILES=FILES,ROWS=ROWS,COLS=COLS,PNGFILE=pngfile,SPACE=SPACE,PX=PX,py=PY,BACKGROUND=BACKGROUND,/NOTRIM
		DIR_OUT = 'D:/PROJECTS/MASS_BAY/PLOT/MANUSCRIPT3/'
		PS_IMAGE,	FILES=PNGFILE, /COLOR,/center,FULL=full,/NO_CLOSE,SCALE=2
		X = 0.018
		Y = 0.96
		IX = 0.51
		IY = -0.33
		CHARSIZE = 0.75
		DEVICE,/COLOR
		CALL_PROCEDURE,PAL,R,G,B
		TICKNAMES = ['100','275','775','2150','6000']
		COLORBAR,BOTTOM=70, NCOLORS=165, POSITION=[0.05, 0.47,0.95, 0.49],DIVISIONS=4, MINOR=1,charsize=charsize,/xlog,TICKNAMES=TICKNAMES;, TITLE = 'Euphotic Production (gC m!E-2!N day!E-1!N)'
		TITLE = '!7Primary Production (gC m!E-2!N d!E-1!N)'
		XYOUTS,0.04,0.39,TITLE, ALIGN=-0.1, CHARSIZE=0.65, COLOR=0, /NORMAL
    DEVICE,/CLOSE


;MONTHLY COMPOSITES
		PRODS = ['CHL','PROD']
		FOR PTH = 0L, N_ELEMENTS(PRODS)-1 DO BEGIN
		 IF PRODS(PTH) EQ 'CHL'  THEN FILES = FILE_SEARCH('D:/PROJECTS/MASS_BAY/SEAWIFS/MASS_BAY/MB_CHLOR_A_CORRECTED/AVERAGE_IMAGES/YM*.PNG')
		 IF PRODS(PTH) EQ 'PROD' THEN FILES = FILE_SEARCH('D:/PROJECTS/MASS_BAY/SEAWIFS/MASS_BAY/MB_VGPM_MB2/AVERAGE_IMAGES/YM*.PNG')
			FP = FILE_PARSE(FILES)
			OK = WHERE(STRMID(FP.FIRST_NAME,3,4) GE '1998' AND STRMID(FP.FIRST_NAME,3,4) LE '2003')
			FILES = FILES[OK]
			FILES = FILES[SORT(FP[OK].FIRST_NAME)]
			FILES = [FILES,BLANK2]
			LIST, FP[OK].FIRST_NAME,/NOSEQ
			ROWS = 7
			COLS = 12
			PNGFILE = 'D:\PROJECTS\MASS_BAY\PLOT\MANUSCRIPT3\SEAWIFS_'+PRODS(PTH)+'_MONTHLY.PNG'
		;	IMAGE_WELD_PAGE,FILES=FILES,ROWS=ROWS,COLS=COLS,PAL=PAL,PNGFILE=pngfile,SPACE=space,PX=px,py=py,BACKGROUND=BACKGROUND,/NOTRIM
			PS_IMAGE,	FILES=PNGFILE, /COLOR,FULL=full,/LANDSCAPE,/NO_CLOSE,SCALE=0.44,XOFFSET=1.5,YOFFSET=27.3

			X = 0.018
			Y = 1.01
			IX = 0.0835
			CHARSIZE = 3
			XYOUTS,X,Y,'!7Jan', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, /NORMAL
			XYOUTS,X+IX,Y,'!7Feb', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, /NORMAL
			XYOUTS,X+2*IX,Y,'!7Mar', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, /NORMAL
			XYOUTS,X+3*IX,Y,'!7Apr', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, /NORMAL
			XYOUTS,X+4*IX,Y,'!7May', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, /NORMAL
			XYOUTS,X+5*IX,Y,'!7Jun', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, /NORMAL
			XYOUTS,X+6*IX,Y,'!7Jul', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, /NORMAL
			XYOUTS,X+7*IX,Y,'!7Aug', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, /NORMAL
			XYOUTS,X+8*IX,Y,'!7Sep', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, /NORMAL
			XYOUTS,X+9*IX,Y,'!7Oct', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, /NORMAL
			XYOUTS,X+10*IX,Y,'!7Nov', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, /NORMAL
			XYOUTS,X+11*IX,Y,'!7Dec', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, /NORMAL
			X2 = -0.001
			Y2 = 0.968
			IY2 = -0.151
			XYOUTS,X2,Y2,'!71998', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, /NORMAL
			XYOUTS,X2,Y2+IY2,'!71999', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, /NORMAL
			XYOUTS,X2,Y2+2*IY2,'!72000', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, /NORMAL
			XYOUTS,X2,Y2+3*IY2,'!72001', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, /NORMAL
			XYOUTS,X2,Y2+4*IY2,'!72002', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, /NORMAL
			XYOUTS,X2,Y2+5*IY2,'!72003', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, /NORMAL
			IF PRODS(PTH) EQ 'CHL' THEN BEGIN
				TICKNAMES = ['0.1','0.2','0.4','0.7','1.4','2.7','5','10','20']
				COLORBAR,BOTTOM=75, NCOLORS=173, POSITION=[0.1, 0.065,0.9, 0.095],DIVISIONS=8, MINOR=1,charsize=2.5,/xlog,TICKNAMES=TICKNAMES
				TITLE = '!7 Chlorophyll !8a!7 (mg m!U-3!N)'
				XYOUTS,0.38,-0.005,TITLE, ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, /NORMAL
			ENDIF
			IF PRODS(PTH) EQ 'PROD' THEN BEGIN
				TICKNAMES = ['100','275','775','2150','6000']
				COLORBAR,BOTTOM=70, NCOLORS=165, POSITION=[0.1, 0.065,0.9, 0.095],DIVISIONS=4, MINOR=1,charsize=charsize,/xlog,TICKNAMES=TICKNAMES;, TITLE = 'Euphotic Production (gC m!E-2!N day!E-1!N)'
				TITLE = '!7Primary Production (gC m!E-2!N d!E-1!N)'
				XYOUTS,0.33,-0.005,TITLE, ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, /NORMAL
			ENDIF
    	DEVICE,/CLOSE
    ENDFOR


; 1999 WINTER-SPRING BLOOM EXAMPLE
		PFILES = FILE_SEARCH('D:/PROJECTS/MASS_BAY/SEAWIFS/MASS_BAY/MB_VGPM_MB2/AVERAGE_IMAGES/8_DAY/D8_1999*.PNG')
		PFP = FILE_PARSE(PFILES)
		DATES = ['19990117','19990207','19990321','19990328','19990404','19990425']
		OK = WHERE(STRMID(PFP.FIRST_NAME,3,8) EQ DATES[0])
		FILES = PFILES[OK]
		FOR PTH=1L, N_ELEMENTS(DATES)-1 DO BEGIN
			OK = WHERE(STRMID(PFP.FIRST_NAME,3,8) EQ DATES(PTH))
			FILES = [FILES,PFILES[OK]]
		ENDFOR
		FILES = [FILES,BLANK2]
		LIST, FILES, /NOSEQ
		ROWS = 4
		COLS = 2
		PNGFILE = 'D:\PROJECTS\MASS_BAY\PLOT\MANUSCRIPT3\SEAWIFS_1999_WS_BLOOM.PNG'
	;	IMAGE_WELD_PAGE,FILES=FILES,ROWS=ROWS,COLS=COLS,PAL=PAL,PNGFILE=pngfile,SPACE=space,PX=px,py=py,BACKGROUND=BACKGROUND,/NOTRIM
		PS_IMAGE,	FILES=PNGFILE, /COLOR,FULL=full,/center,/NO_CLOSE,SCALE=1.5

		X = 0.01
		Y = 0.96
		IX = 0.51
		IY = -0.3
		CHARSIZE = 1.35
		XYOUTS,X+0*IX,Y+0*IY,'!7A', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, /NORMAL
		XYOUTS,X+1*IX,Y+0*IY,'!7B', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, /NORMAL
		XYOUTS,X+0*IX,Y+1*IY,'!7C', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, /NORMAL
		XYOUTS,X+1*IX,Y+1*IY,'!7D', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, /NORMAL
		XYOUTS,X+0*IX,Y+2*IY,'!7E', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, /NORMAL
		XYOUTS,X+1*IX,Y+2*IY,'!7F', ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1, /NORMAL

		CHARSIZE=1.25
		TICKNAMES = ['100','275','775','2150','6000']
		COLORBAR,BOTTOM=70, NCOLORS=165, POSITION=[0.05, 0.065,0.95, 0.09],DIVISIONS=4, MINOR=1,charsize=charsize,/xlog,TICKNAMES=TICKNAMES;, TITLE = 'Euphotic Production (gC m!E-2!N day!E-1!N)'
		TITLE = '!7Primary Production (gC m!E-2!N d!E-1!N)'
		XYOUTS,0.08,-0.01,/NORMAL,TITLE, ALIGN=-0.1, CHARSIZE=CHARSIZE, COLOR=0, CHARTHICK=1
    DEVICE,/CLOSE
STOP
		SKIP_SEA_COMP:
	ENDIF

DO_PINGS:
; *******************************************************
	IF DO_PNGS GT 1 THEN BEGIN
; *******************************************************

		OVERWRITE = DO_PNGS GE 2
		PSFILES = [FINAL_LANDSCAPE, FINAL_PORTRAIT]

		PSFILES = ERF_LANDSCAPE

		DIR_OUT = 'D:\PROJECTS\MASS_BAY\PLOT\MANUSCRIPT_FIGURES_3\'

;		Grace:			An array [Left,Right,Bottom,Top] where Left,Right,Bottom,Top are number of pixels for margin
		GRACE = [50,50,50,50]
		LIST, PSFILES
		FOR NTH = 0L, N_ELEMENTS(PSFILES)-1 DO BEGIN
			IMAGE_TRIM, PSFILES[NTH], GRACE=GRACE,DPI=600, DIR_OUT=dir_out,OVERWRITE=OVERWRITE,BACKGROUND=255
		ENDFOR
	STOP

	ENDIF


TIMER,/STOP
END
