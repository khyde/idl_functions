; $ID:	PLT_WRITE.PRO,	2020-06-03-17,	USER-KJWH	$
;+
;#############################################################################################################
	PRO PLT_WRITE,OBJ,FILE=FILE,APPEND=APPEND,CLOSE=CLOSE,$
	    BORDER=BORDER,BIT_DEPTH=BIT_DEPTH,NOREWRITE=NOREWRITE,NORESIZE=NORESIZE


;
; PURPOSE: WRITES A GRAPHICS FUNCTION OBJECT TO A FILE USING THE SAVE METHOD
;
; CATEGORY:	PLT  
;
; CALLING SEQUENCE: PLT_WRITE,OBJ,FILE=FILE
;
; INPUTS: OBJECT FROM PLOT FUNCTION
;		
; OPTIONAL INPUTS:
;		NONE:	
;		
; KEYWORD PARAMETERS:
;		FILE: COMPLETE FILE NAME [WITH PATH] FOR OUTPUT
;		BORDER: SEE SAVE METHOD
;		BIT_DEPTH: SEE SAVE METHOD
;		APPEND - SEE SAVE METHOD
;		CLOSE - SEE SAVE METHOD
;   NOREWRITE: DO NOT READ AND REWRITE THE OUTPUT PNGFILE
;   NORESIZE : DO NOT READ AND RESIZE THE OUTPUT PNGFILE
;		
; OUTPUTS: WRITES AN IMAGE FILE WITH THE TYPE[PNG,PDF,TIF,JPG,ETC.] 
;          DETERMINED BY THE FILE EXTENSION
;		
;
; MODIFICATION HISTORY:
;			APR 23,2014 WRITTEN BY  J.O'REILLY
;			APR 26,2014,JOR FIXED:PF,FILE
;     APR 27,2014,JOR:;===> MAKE SURE FILE HAS AN EXTENSION, IF NOT THEN MAKE IT PNG
;     MAY 2,2014,JOR IF NO FILE THEN CLOSE OBJ
;     JUN 28,2014,JOR ADDED APPEND,CLOSE
;     AUG 21,2014,JOR DISCOVERED RGB VALUES IN OUTPUT PNGFILE ARE DIFFERENT THAN THOSE IN PAL_SW3 [DEFAULT PAL]
;                     ADDED KEYWORDS NOREWRITE,NORESIZE
;			
;#################################################################################
;
;-
;***************************
ROUTINE_NAME  = 'PLT_WRITE'
;***************************
;
;##### IS GRAPHICS OBJECT  PRESENT ? #####
IF NONE(OBJ) THEN MESSAGE,'ERROR: GRAPHICS OBJECT IS REQUIRED'
IF IDLTYPE(OBJ) NE 'OBJREF' THEN MESSAGE,'ERROR: OBJ MUST BE A GRAPHICS OBJECT'
IF ANY(FILE) THEN BEGIN
  
  ;FILE = !S.TEMP + CALLER(2) + '.PNG'

;===> MAKE SURE FILE HAS AN EXTENSION, IF NOT THEN MAKE IT PNG
FN = FILE_PARSE(FILE) & IF FN.EXT EQ '' THEN FILE = FILE + '.PNG'
;===> MAKE SURE FILE HAS ADIRECTORY, IF NOT THEN MAKE IT !S.IDL_TEMP
FN = FILE_PARSE(FILE) & IF FN.DIR EQ '' THEN FILE = !S.IDL_TEMP +FILE 

IF NONE(RES) THEN RESOLUTION = 600
IF NONE(BORDER) THEN BORDER = 10
IF NONE(BIT_DEPTH) THEN BIT_DEPTH = 0
OBJ.SAVE, FILE,APPEND=APPEND,CLOSE=CLOSE,RESOLUTION=RES,WIDTH = WIDTH,HEIGHT = HEIGHT,BORDER=BORDER,/BITMAP,BIT_DEPTH=BIT_DEPTH
;===> READ THE FILE AND REWRITE IT USING 
IF NOT KEY(NOREWRITE) THEN BEGIN
  FN = FILE_PARSE(FILE)
  IF FN.EXT EQ 'PNG' THEN BEGIN
    IM = READ_PNG(FILE)
    WRITE_PNG,FILE,IM,R,G,B
    
  ENDIF;IF FN.EXT = 'PNG' THEN BEGIN
  
ENDIF;IF NOT KEY(NOREWRITE) THEN BEGIN

PF,FILE
ENDIF;ENDIF;IF ANY(FILE) THEN BEGIN
;===> ALWAYS CLOSE THE OBJECT
OBJ.CLOSE
;||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
END; #####################  END OF ROUTINE ################################
