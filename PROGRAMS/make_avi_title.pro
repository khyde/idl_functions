; $ID:	MAKE_AVI_TITLE.PRO,	2020-06-30-17,	USER-KJWH	$
; Makes a title image from image_file

FUNCTION MAKE_AVI_TITLE, IMAGE_FILE=image_file, TYPE=type, PAL=PAL,DATE_START=date_start,DATE_END=date_end,DIR_OUT=dir_out,YOFFSET=yoffset,$
												MAP=MAP,TITLE_COLOR=TITLE_COLOR,$
												  AUTHORS=authors,ADDRESS=address,SENSORS=sensors

;	DATE_START='20030501000000'
;	DATE_END	='20030725000000
;	IMAGE_FILE='I:\COMBO\TS_IMAGES\TS_IMAGES-SEAWIFS-AVHRR-REPRO4-CD-NEC-CHLOR_A-SST-INTERP-!D_20030425.PNG'
;	 TYPE = 'CHLOR_A-SST'
;	 DIR_OUT='I:\COMBO\TS_IMAGES\JUNK\'
  FN=PARSE_IT(IMAGE_FILE)
	IF N_ELEMENTS(IMAGE_FILE) NE 1 THEN STOP
	IF N_ELEMENTS(DATE_START) NE 1 THEN STOP
	IF N_ELEMENTS(DATE_END) NE 1 THEN STOP
	IF N_ELEMENTS(DIR_OUT) NE 1 THEN _DIR_OUT = FN.DIR ELSE _DIR_OUT = DIR_OUT

	IF N_ELEMENTS(YOFFSET) NE 1 THEN _YOFFSET = 0 ELSE _YOFFSET = YOFFSET
	IF N_ELEMENTS(TITLE_COLOR) NE 1 THEN TITLE_COLOR =0
	IF N_ELEMENTS(MAP) NE 1 THEN MAP ='NEC'


	FN=PARSE_IT(IMAGE_FILE,/ALL)

	IF NOT KEYWORD_SET(TYPE) THEN _TYPE =FN[0].PROD ELSE _TYPE = TYPE

;	===> Read the sample image_file
  IMG = READALL(image_file)
	SZ=SIZE(IMG,/STRUCT)

	IF SZ.N_DIMENSIONS EQ 3 THEN BEGIN
	 N=1
	 N_PLANES=3
	ENDIF ELSE BEGIN
	 N=0
	 N_PLANES=1
	ENDELSE

	WIDTH 	= SZ.DIMENSIONS(N)
	HEIGHT 	= SZ.DIMENSIONS(N+1)

	DATE_TXT=  DATE_FORMAT(DATE_START,/day,/MDY,NAME=3) + '  -  ' + DATE_FORMAT(DATE_END,/day,/MDY,NAME=3)

  IF _TYPE EQ 'CHLOR_A-SST' THEN BEGIN

  	TITLE_SENSOR  ='SeaWiFS  &  AVHRR'
		TITLE_PRODUCT =' Chlorophyll !8a!X!N          SST'

	;	TITLE_SENSOR  =' SeaWiFS   &   AVHRR, TERRA, AQUA'
		TITLE_DATE    = '!C'+DATE_TXT
		TITLE_AUTHOR  = " Jay O'Reilly,  Kimberly Hyde,  Teresa Ducas"
		TITLE_ADDRESS = 'NOAA, NMFS, Narragansett,RI'
;;;TEMPORARY
;		TITLE_AUTHOR  = " Jay O'Reilly       &    Igor Belkin"
;		TITLE_ADDRESS = 'NOAA,NMFS, RI    &     GSO, URI     '

		CHARSCALE = FLOAT(HEIGHT)/512
	ENDIF ELSE BEGIN
		IF _TYPE EQ 'CHLOR_A-OPAL-VGPM2A' THEN BEGIN
			TITLE_SENSOR  ='    '
			TITLE_PRODUCT =' Chlorophyll !8a!X!N       OPAL!8a!X!N       VGPM2A'
			TITLE_DATE    = '!C'+DATE_TXT
			TITLE_AUTHOR  = " Jay O'Reilly,  Kimberly Hyde,  Teresa Ducas"
			TITLE_ADDRESS = 'NOAA, NMFS, Narragansett,RI'
			CHARSCALE = FLOAT(HEIGHT)/512
		ENDIF


		TITLE_PRODUCT =_TYPE
		IF _TYPE EQ 'CHLOR_A' THEN TITLE_PRODUCT ='Chlorophyll'

		TITLE_SENSOR  =NICKNAME(FN[0].SENSOR)
		IF FN[0].SENSOR EQ 'N4AT' THEN TITLE_SENSOR  ='AVHRR,TERRA,AQUA'
		IF FN[0].SENSOR EQ 'N4ATG' THEN TITLE_SENSOR  ='AVHRR,TERRA,AQUA,GOES'
		IF FN[0].SENSOR EQ 'SEA_AQU' THEN TITLE_SENSOR  ='SeaWiFS & MODIS-Aqua'
		IF FN[0].SENSOR EQ 'SA_N4AT' THEN TITLE_SENSOR  ='SeaWiFS & MODIS-Aqua & MODIS-Terra & AVHRR'
		IF _TYPE EQ 'PPD' THEN BEGIN
			TITLE_SENSOR = FN[0].ALG
			TITLE_PRODUCT='Primary Production'
		ENDIF
		IF _TYPE EQ 'PPD-SST' THEN BEGIN
			TITLE_SENSOR = FN[0].ALG
			TITLE_PRODUCT='Primary Production - SST'
		ENDIF


		TITLE_DATE    = DATE_TXT
		TITLE_AUTHOR  = " Jay O'Reilly,  Kimberly Hyde,  Teresa Ducas"
		TITLE_AUTHOR  = " J.O'Reilly,  K.Hyde,  K.Sherman,  T.Ducas"

		TITLE_ADDRESS = 'NOAA, NMFS, Narragansett,RI'
		;;;TEMPORARY
		;TITLE_AUTHOR  = " Jay O'Reilly       &    Igor Belkin"
		;TITLE_ADDRESS = 'NOAA,NMFS, RI    &     GSO, URI     '

		CHARSCALE = FLOAT(HEIGHT)/800
	ENDELSE

;STOP

  Y_ADD=0.0


	IF WIDTH GT 1024 THEN BEGIN
	  CHARSCALE = FLOAT(HEIGHT)/600
	  Y_ADD=0.1
	ENDIF ELSE BEGIN
		CHARSCALE = FLOAT(HEIGHT)/800
		IF WIDTH LT 200 THEN CHARSCALE = FLOAT(HEIGHT)/1800
	ENDELSE

	Y_ADD = Y_ADD + _YOFFSET

	IF N_ELEMENTS(AUTHORS) GE 1 THEN TITLE_AUTHOR = AUTHORS
	IF N_ELEMENTS(ADDRESS) GE 1 THEN TITLE_ADDRESS = ADDRESS
	IF N_ELEMENTS(SENSORS) GE 1 THEN TITLE_SENSOR = SENSORS


	title_slide_file=DIR_OUT+'Title_Slide-'+FN[0].PROD+'.PNG'


  IF N_PLANES EQ 1 THEN BEGIN
 		IF HEIGHT GE 1024 THEN BEGIN
	  	IMG = MAP_ADD_TXT(IMG,0.5,0.58+Y_ADD,	TITLE_PRODUCT,COLOR=TITLE_COLOR,charsize=8*charscale,CHARTHICK=3,ALIGN=0.5)
	  	IMG = MAP_ADD_TXT(IMG,0.5,0.40+Y_ADD,	TITLE_SENSOR, COLOR=TITLE_COLOR,charsize=5*charscale,CHARTHICK=3,ALIGN=0.5)
	  	IMG = MAP_ADD_TXT(IMG,0.5,0.26+Y_ADD,	TITLE_DATE, 	COLOR=TITLE_COLOR,charsize=5*charscale,CHARTHICK=3,ALIGN=0.5)
	  	IMG = MAP_ADD_TXT(IMG,0.5,0.11+Y_ADD,	TITLE_AUTHOR, COLOR=TITLE_COLOR,charsize=4*charscale,CHARTHICK=3,ALIGN=0.5)
	  	IMG = MAP_ADD_TXT(IMG,0.5,0.02+Y_ADD,	TITLE_ADDRESS,COLOR=TITLE_COLOR,charsize=4*charscale,CHARTHICK=3,ALIGN=0.5)
 		ENDIF ELSE BEGIN

	  	IMG = MAP_ADD_TXT(IMG,0.5,0.45+Y_ADD,	TITLE_PRODUCT,COLOR=TITLE_COLOR,charsize=7*charscale,CHARTHICK=3,ALIGN=0.5)
	  	IMG = MAP_ADD_TXT(IMG,0.5,0.25+Y_ADD,	TITLE_SENSOR, COLOR=TITLE_COLOR,charsize=4*charscale,CHARTHICK=3,ALIGN=0.5)
	  	IMG = MAP_ADD_TXT(IMG,0.5,0.20+Y_ADD,	TITLE_DATE, 	COLOR=TITLE_COLOR,charsize=4*charscale,CHARTHICK=3,ALIGN=0.5)
	  	IMG = MAP_ADD_TXT(IMG,0.5,0.08+Y_ADD,	TITLE_AUTHOR, COLOR=TITLE_COLOR,charsize=3*charscale,CHARTHICK=3,ALIGN=0.5)
	  	IMG = MAP_ADD_TXT(IMG,0.5,0.02+Y_ADD,	TITLE_ADDRESS,COLOR=TITLE_COLOR,charsize=3*charscale,CHARTHICK=3,ALIGN=0.5)
		ENDELSE
  	CALL_PROCEDURE,PAL,R,G,B
  	WRITE_PNG,title_slide_file,IMG,R,G,B
  ENDIF ELSE BEGIN
  	FOR PLANE = 0,N_PLANES-1 DO BEGIN

			IF MAP EQ 'NEC' OR MAP EQ 'EC' THEN BEGIN
				IMG(PLANE,*,*) = MAP_ADD_TXT(REFORM(IMG(PLANE,*,*)),0.5,0.58+Y_ADD,	TITLE_PRODUCT, 	COLOR=TITLE_COLOR,charsize=8*charscale,CHARTHICK=3,ALIGN=0.5)
	  		IMG(PLANE,*,*) = MAP_ADD_TXT(REFORM(IMG(PLANE,*,*)),0.5,0.40+Y_ADD,	TITLE_SENSOR, 	COLOR=TITLE_COLOR,charsize=5*charscale,CHARTHICK=3,ALIGN=0.5)
				IMG(PLANE,*,*) = MAP_ADD_TXT(REFORM(IMG(PLANE,*,*)),0.5,0.26+Y_ADD,	TITLE_DATE, 		COLOR=TITLE_COLOR,charsize=5*charscale,CHARTHICK=3,ALIGN=0.5)
	  		IMG(PLANE,*,*) = MAP_ADD_TXT(REFORM(IMG(PLANE,*,*)),0.5,0.11+Y_ADD,	TITLE_AUTHOR, 	COLOR=TITLE_COLOR,charsize=4*charscale,CHARTHICK=3,ALIGN=0.5)
	  		IMG(PLANE,*,*) = MAP_ADD_TXT(REFORM(IMG(PLANE,*,*)),0.5,0.02+Y_ADD,	TITLE_ADDRESS, 	COLOR=TITLE_COLOR,charsize=4*charscale,CHARTHICK=3,ALIGN=0.5)
			ENDIF

			IF MAP EQ 'NENA' THEN BEGIN
				IMG(PLANE,*,*) = MAP_ADD_TXT(REFORM(IMG(PLANE,*,*)),0.5,0.80+Y_ADD,	TITLE_PRODUCT, 	COLOR=TITLE_COLOR,charsize=8*charscale,CHARTHICK=3,ALIGN=0.5)
	  		IMG(PLANE,*,*) = MAP_ADD_TXT(REFORM(IMG(PLANE,*,*)),0.5,0.40+Y_ADD,	TITLE_SENSOR, 	COLOR=TITLE_COLOR,charsize=5*charscale,CHARTHICK=3,ALIGN=0.5)
				IMG(PLANE,*,*) = MAP_ADD_TXT(REFORM(IMG(PLANE,*,*)),0.5,0.50+Y_ADD,	TITLE_DATE, 		COLOR=TITLE_COLOR,charsize=5*charscale,CHARTHICK=3,ALIGN=0.5)
	  		IMG(PLANE,*,*) = MAP_ADD_TXT(REFORM(IMG(PLANE,*,*)),0.5,0.11+Y_ADD,	TITLE_AUTHOR, 	COLOR=TITLE_COLOR,charsize=4*charscale,CHARTHICK=3,ALIGN=0.5)
	  		IMG(PLANE,*,*) = MAP_ADD_TXT(REFORM(IMG(PLANE,*,*)),0.5,0.02+Y_ADD,	TITLE_ADDRESS, 	COLOR=TITLE_COLOR,charsize=4*charscale,CHARTHICK=3,ALIGN=0.5)
			ENDIF

			IF MAP EQ 'BERING_SEA' THEN BEGIN
				IMG(PLANE,*,*) = MAP_ADD_TXT(REFORM(IMG(PLANE,*,*)),0.5,0.60+Y_ADD,	TITLE_PRODUCT, 	COLOR=TITLE_COLOR,charsize=7*charscale,CHARTHICK=3,ALIGN=0.5)
		  	IMG(PLANE,*,*) = MAP_ADD_TXT(REFORM(IMG(PLANE,*,*)),0.5,0.50+Y_ADD,	TITLE_SENSOR, 	COLOR=TITLE_COLOR,charsize=4*charscale,CHARTHICK=3,ALIGN=0.5)
		 		IMG(PLANE,*,*) = MAP_ADD_TXT(REFORM(IMG(PLANE,*,*)),0.5,0.18+Y_ADD,	TITLE_DATE, 		COLOR=TITLE_COLOR,charsize=5*charscale,CHARTHICK=3,ALIGN=0.5)
		  	IMG(PLANE,*,*) = MAP_ADD_TXT(REFORM(IMG(PLANE,*,*)),0.5,0.04+Y_ADD,	TITLE_AUTHOR, 	COLOR=TITLE_COLOR,charsize=4*charscale,CHARTHICK=3,ALIGN=0.5)
		  	IMG(PLANE,*,*) = MAP_ADD_TXT(REFORM(IMG(PLANE,*,*)),0.5,0.01+Y_ADD,	TITLE_ADDRESS, 	COLOR=TITLE_COLOR,charsize=4*charscale,CHARTHICK=3,ALIGN=0.5)
			ENDIF

			IF MAP EQ '' THEN BEGIN
				IMG(PLANE,*,*) = MAP_ADD_TXT(REFORM(IMG(PLANE,*,*)),0.5,0.60+Y_ADD,	TITLE_PRODUCT, 	COLOR=TITLE_COLOR,charsize=7*charscale,CHARTHICK=3,ALIGN=0.5)
		  	IMG(PLANE,*,*) = MAP_ADD_TXT(REFORM(IMG(PLANE,*,*)),0.5,0.50+Y_ADD,	TITLE_SENSOR, 	COLOR=TITLE_COLOR,charsize=4*charscale,CHARTHICK=3,ALIGN=0.5)
		 		IMG(PLANE,*,*) = MAP_ADD_TXT(REFORM(IMG(PLANE,*,*)),0.5,0.28+Y_ADD,	TITLE_DATE, 		COLOR=TITLE_COLOR,charsize=5*charscale,CHARTHICK=3,ALIGN=0.5)
		  	IMG(PLANE,*,*) = MAP_ADD_TXT(REFORM(IMG(PLANE,*,*)),0.5,0.09+Y_ADD,	TITLE_AUTHOR, 	COLOR=TITLE_COLOR,charsize=4*charscale,CHARTHICK=3,ALIGN=0.5)
		  	IMG(PLANE,*,*) = MAP_ADD_TXT(REFORM(IMG(PLANE,*,*)),0.5,0.01+Y_ADD,	TITLE_ADDRESS, 	COLOR=TITLE_COLOR,charsize=4*charscale,CHARTHICK=3,ALIGN=0.5)
			ENDIF
  	ENDFOR
  WRITE_PNG,title_slide_file,IMG,R,G,B
 	ENDELSE

 	RETURN, title_slide_file

END
