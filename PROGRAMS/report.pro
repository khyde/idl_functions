; $ID:	REPORT.PRO,	2020-07-08-15,	USER-KJWH	$
;###################################################################################################
PRO REPORT,TXT ,DIR=DIR,START=START,STOP=STOP,QUIET=QUIET,OVERWRITE=OVERWRITE
;+
;	THIS PROGRAM OPENS AND CLOSES A FILE FOR LOGGING THE TXT PROVIDED
;	
; KEYWORDS:
;     DIR:    OUTPUT DIRECTORY
;     START:  PASSED TO TIMER [STARTS THE TIMER ]
;     STOP:   PASSED TO TIMER [STOPS THE TIMER ]
;	    QUIET:  SUPRESSES PRINT TO SCREEN
;	
;	THE NAME OF THE LOG FILE IS DETERMINED AUTOMATICALLY FROM THE NAME OF THE PROGRAM THAT CALLS REPORT
; 
; EXAMPLES:
;    REPORT,'NOTHING TO REPORT'
; 
; HISTORY:
;		JULY 26,2002	WRITTEN BY:	J.E. O'REILLY, NOAA, 28 TARZWELL DRIVE, NARRAGANSETT, RI 02882
;		DEC 3, 2002  JOR, ADDED DIR
;		SEP 25,2011,JOR, NOW USING PLIST TO AVOID CONFLICT WITH IDLS LIST
;		MAR 18,2012,JOR, REPLACED PARSE_IT WITH FILE_PARSE
;		DEC 28,2012,JOR:   PLIST, _TXT, FILE=FILE,/NOSEQ,/NOHEAD
;   JAN 26,2013,ADDED QUIET:IF NOT KEYWORD_SET(QUIET) THEN PRINT, _TXT
;   JAN 27,2013,JOR   FILE = '   LOG    - ' + CALLING_ROUTINE +'.TXT
;   JUL 3,2014,JOR UPDATED CODE WITH NEW FUNCTIONS
;   JUL 4,2014,JOR, LOG OUTPUT TO !S.IDL_TEMP, ADDED PFILE,FILE
;   APR 04,2015,JOR:IF N_ELEM
;   ENTS(TXT) EQ 0 THEN _TXT=CALLING_ROUTINE + ' ' ELSE _TXT = STRMID(DATE_NOW(),0,8) + ' - ' + TXT
;   APR 21,2015,JOR:FILE = DIR + '     LOG      ' + CALLER(2) +'.TXT'
;   JUL 23,2015,JOR , REPLACED TEXT WITH TXT
;   DEC 03, 2015 - KJWH: Changed default dir to the be !S.LOGS + CALLING_ROUTINE
;                        Added DIR_TEST, DIR
;                        Changed distinct text to be '_' instead of excessive number of spaces.  This way the file will be at the top of the alphabetical list
;                        Changed KEYWORD_SET() to KEY()
;   MAR 18, 2016 - KJWH: Added QUIET keyword option to PLIST call 
;   MAY 14, 2018 - KJWH: Removed QUIET keyword option to PLIST call 
;   FEB 25, 2019 - KJWH: Changed CALLER() to CALLER[1]
;-
; ###################################################################################################

;***********************
  ROUTINE_NAME  = 'REPORT'
;***********************

  CALLING_ROUTINE = CALLER(1)  
  IF NONE(DIR) THEN DIR = !S.LOGS + CALLING_ROUTINE
  
;===> ENSURE PATH SEPERATOR  
  DIR=REMOVE_LAST_SLASH(DIR)
  DIR = DIR + PATH_SEP()
  DIR_TEST, DIR

  IF N_ELEMENTS(TXT) EQ 0 THEN _TXT=CALLING_ROUTINE + ' ' ELSE _TXT = STRMID(DATE_NOW(),0,8) + ' - ' + TXT 

;===> MAKE THE LOG FILE DISTINCT [WITH UNDERSCORE]
  FILE = DIR + '_LOG ' + CALLER(2) +'.TXT'

;===> IF START OR STOP THEN CALL TIMER
  IF KEY(START) OR KEY(STOP) OR KEY(REPORT) THEN BEGIN
    TIMER,START=START,STOP=STOP, REPORT=REPORT,_EXTRA=_EXTRA
    _TXT = _TXT+'     ' +REPORT
  ENDIF;IF KEYWORD_SET(START) OR KEYWORD_SET(STOP)  KEYWORD_SET(REPORT) THEN BEGIN

  PLIST, _TXT, FILE=FILE,/NOSEQ,/NOHEAD,OVERWRITE=OVERWRITE
  IF NOT KEY(QUIET) THEN PRINT, _TXT
  IF NOT KEY(QUIET) THEN PFILE,FILE
END; #####################  END OF ROUTINE ################################
