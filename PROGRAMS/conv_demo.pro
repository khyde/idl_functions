; $ID:	CONV_DEMO.PRO,	2020-06-30-17,	USER-KJWH	$
; #########################################################################; 
PRO CONV_DEMO
;+
; PURPOSE:  DEMONSTRATE NUMERICALLY THE CONVOLUTION OF A KERNEL WITH AN ARRAY
;
; CATEGORY: MATH;
;
;
; INPUTS: NONE
;
;
; KEYWORDS:  NONE

; OUTPUTS:  PRINTS RESULTS TO THE SCREEN 
;
; WARNINGS:
;  I AM NOT SURE THAT I HAVE THE SUBSCRIPTS CORRECT WHEN SIMULATING THE EDGE_TRUNCATE KEYWORD
;  PASSED TO CONVOL IN FRONTS_BOA
;  
;  
; MODIFICATION HISTORY:
;     APR 14, 2016  WRITTEN BY: J.E. O'REILLY
;     MAY 09,2016,JOR HARD-WIRED SUBS TO SIMULATE EDGE_TRUNCATE IN CONVOL
;                    [TOO COMPLICATED TO DO WITH LOOPS]
;     MAY 11,2016,JOR ADDED LOOP TO CHECK_EACH_SST_POSITION,ADDED SWITCHES
;-
; #########################################################################

;**************************
ROUTINE_NAME  = 'CONV_DEMO'
;**************************
;SWITCHES 
DO_CENTRAL_PIXEL = 'Y'
DO_EACH_SST      = 'Y'

;*************************************
IF DO_CENTRAL_PIXEL EQ 'Y' THEN BEGIN
;*************************************
;===> MAKE KERNEL_X FOR CONVOL
  KERNEL_X = FLTARR(3,3)
  KERNEL_X[0,[0,2]] = -1.;
  KERNEL_X[2,[0,2]] =  1.;
  KERNEL_X[0,1] = -2.;
  KERNEL_X[2,1] =  2.;
  FACTOR = TOTAL(ABS(KERNEL_X)); = 8.0
  
  
  CEN = 12  ; CENTRAL PIXEL OF THE 5X5 SST ARRAY
  SST = REPLICATE(1.0,[5,5]) & SST(CEN) = 2.0
  PRINT,'SST ARRAY:'
  PRINT,SST
  STOP
  
  S  = FRONTS_BOA(SST, LOG=0, WIDTH=1,HEIGHT=1, EPSILON=1)
  PRINT,KERNEL_X
  FACTOR = TOTAL(ABS(KERNEL_X)); = 8.0
  PRINT,'THE SCALE FACTOR [FACTOR] IS DEFINED AS THE SUM OF THE ABSOLUTE VALUES OF THE KERNEL.'
  PRINT,'THE SCALE FACTOR IS DIVIDED INTO THE TOTAL OF THE PRODUCT OF THE 
  PRINT,' MOVING-CENTERED 3X3 SST BOX TIMES THE 3X3 KERNEL'
  PRINT,'SCALE FACTOR  :  ' + STRTRIM(FACTOR,2)
  PRINT
  STOP
  PRINT,'FRONTS_BOA USES THE KEYWORD EDGE_TRUNCATE IN CONVOL WHICH REPEATS'
  PRINT,'THE SUBSCRIPTS OF THE ARRAY AT THE EDGE'
  PRINT,'SO THE 9 SUBSCRIPTS BELOW [SUBS] FOR THE 3X3 BOX AROUND EACH VALUE IN THE SST ARRAY 
  PRINT,'ARE EXPLICITLY SPECIFIED FOR EACH OF THE 25 ELEMENTS OF THE SST ARRAY'
  PRINT
  PRINT,'NOTE THAT THE EDGE SUBSCRIPTS ARE REPEATED IN SUBS'
  PRINT
  STOP
  A = []
  ;FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
  FOR I = 0,N_ELEMENTS(SST)-1 DO BEGIN
    IF I EQ 0 THEN  SUBS = [0,0,1,0,0,1,5,5,6]  
    IF I EQ 1 THEN  SUBS = [0,1,2,0,1,2,5,6,7]  
    IF I EQ 2 THEN  SUBS = [1,2,3,1,2,3,6,7,8]  
    IF I EQ 3 THEN  SUBS = [2,3,4,2,3,4,7,8,9]  
    IF I EQ 4 THEN  SUBS = [3,4,4,3,4,4,8,9,9]  
    IF I EQ 5 THEN  SUBS = [0,0,1,5,5,6,10,10,11]  
    IF I EQ 6 THEN  SUBS = [0,1,2,5,6,7,10,11,12]  
    IF I EQ 7 THEN  SUBS = [1,2,3,6,7,8,11,12,13]  
    IF I EQ 8 THEN  SUBS = [2,3,4,7,8,9,12,13,14]  
    IF I EQ 9 THEN  SUBS = [3,4,4,8,9,9,13,14,14]  
    IF I EQ 10 THEN SUBS =[5,5,6,10,10,11,15,15,16 ]  
    IF I EQ 11 THEN SUBS = [5,6,7,10,11,12,15,16,17]  
    IF I EQ 12 THEN SUBS = [6,7,8,11,12,13,16,17,18] ; SUBSCRIPTS AROUND THE CENTRAL PIXEL
    IF I EQ 13 THEN SUBS = [7,8,9,12,13,14,17,18,19]  
    IF I EQ 14 THEN SUBS = [8,9,9,13,14,14,18,19,19]  
    IF I EQ 15 THEN SUBS = [10,10,11,15,15,16,20,20,21]  
    IF I EQ 16 THEN SUBS = [10,11,12,15,16,17,20,21,22]  
    IF I EQ 17 THEN SUBS = [11,12,13,16,17,18,21,22,23]  
    IF I EQ 18 THEN SUBS = [12,13,14,17,18,19,22,23,24]  
    IF I EQ 19 THEN SUBS = [13,14,14,18,19,19,23,24,24]  
    IF I EQ 20 THEN SUBS = [15,15,16,20,20,21,20,20,21]  
    IF I EQ 21 THEN SUBS = [15,16,17,20,21,22,20,21,22]  
    IF I EQ 22 THEN SUBS = [16,17,18,21,22,23,21,22,23]  
    IF I EQ 23 THEN SUBS = [17,18,19,22,23,24,22,23,24]  
    IF I EQ 24 THEN SUBS = [18,19,19,23,24,24,23,24,24]  
    VALS = SST(SUBS)
    V =(TOTAL(VALS * KERNEL_X))/FACTOR
    A = [A,V]
  ENDFOR;FOR NTH = 0,N_ELEMENTS(SST) DO BEGIN
  ;FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
  
  ;===> MAKE A 2-DIMENSIONAL
  A = REFORM(A,[5,5])
  PRINT,S.GRAD_X
  PRINT
  PRINT,A
  PRINT
  PRINT
  PRINT,'NO DIFFERENCES BETWEEN THIS AND FRONTS_BOA:'
  PRINT,A-S.GRAD_X
  STOP
ENDIF; IF DO_CENTRAL_PIXEL EQ 'Y' THEN BEGIN
;********************************
IF DO_EACH_SST EQ 'Y' THEN BEGIN
;********************************
  PRINT,'NOW CHECK AGREEMENT FOR EACH SST POSITION'
  ;===> MAKE KERNEL_X FOR CONVOL
  KERNEL_X = FLTARR(3,3)
  KERNEL_X[0,[0,2]] = -1.;
  KERNEL_X[2,[0,2]] =  1.;
  KERNEL_X[0,1] = -2.;
  KERNEL_X[2,1] =  2.;
  FACTOR = TOTAL(ABS(KERNEL_X)); = 8.0
  FOR NTH = 0,24 DO BEGIN
    SST = REPLICATE(1.0,[5,5]) 
    SST[NTH] = 2
    A = []
    S  = FRONTS_BOA(SST, LOG=0, WIDTH=1,HEIGHT=1, EPSILON=1)
    FOR I = 0,N_ELEMENTS(SST)-1 DO BEGIN
      IF I EQ 0 THEN  SUBS = [0,0,1,0,0,1,5,5,6]
      IF I EQ 1 THEN  SUBS = [0,1,2,0,1,2,5,6,7]
      IF I EQ 2 THEN  SUBS = [1,2,3,1,2,3,6,7,8]
      IF I EQ 3 THEN  SUBS = [2,3,4,2,3,4,7,8,9]
      IF I EQ 4 THEN  SUBS = [3,4,4,3,4,4,8,9,9]
      IF I EQ 5 THEN  SUBS = [0,0,1,5,5,6,10,10,11]
      IF I EQ 6 THEN  SUBS = [0,1,2,5,6,7,10,11,12]
      IF I EQ 7 THEN  SUBS = [1,2,3,6,7,8,11,12,13]
      IF I EQ 8 THEN  SUBS = [2,3,4,7,8,9,12,13,14]
      IF I EQ 9 THEN  SUBS = [3,4,4,8,9,9,13,14,14]
      IF I EQ 10 THEN SUBS =[5,5,6,10,10,11,15,15,16 ]
      IF I EQ 11 THEN SUBS = [5,6,7,10,11,12,15,16,17]
      IF I EQ 12 THEN SUBS = [6,7,8,11,12,13,16,17,18] ; SUBSCRIPTS AROUND THE CENTRAL PIXEL
      IF I EQ 13 THEN SUBS = [7,8,9,12,13,14,17,18,19]
      IF I EQ 14 THEN SUBS = [8,9,9,13,14,14,18,19,19]
      IF I EQ 15 THEN SUBS = [10,10,11,15,15,16,20,20,21]
      IF I EQ 16 THEN SUBS = [10,11,12,15,16,17,20,21,22]
      IF I EQ 17 THEN SUBS = [11,12,13,16,17,18,21,22,23]
      IF I EQ 18 THEN SUBS = [12,13,14,17,18,19,22,23,24]
      IF I EQ 19 THEN SUBS = [13,14,14,18,19,19,23,24,24]
      IF I EQ 20 THEN SUBS = [15,15,16,20,20,21,20,20,21]
      IF I EQ 21 THEN SUBS = [15,16,17,20,21,22,20,21,22]
      IF I EQ 22 THEN SUBS = [16,17,18,21,22,23,21,22,23]
      IF I EQ 23 THEN SUBS = [17,18,19,22,23,24,22,23,24]
      IF I EQ 24 THEN SUBS = [18,19,19,23,24,24,23,24,24]
      VALS = SST(SUBS)
      V =(TOTAL(VALS * KERNEL_X))/FACTOR
      A = [A,V]    
    ENDFOR;FOR I = 0,N_ELEMENTS(SST)-1 DO BEGIN
    ;===> MAKE A 2-DIMENSIONAL
    A = REFORM(A,[5,5])
    OK=WHERE(A NE S.GRAD_X,COUNT)
    IF COUNT GE 1 THEN STOP ELSE PRINT,NTH,'  ','AGREEMENT'
  ENDFOR;FOR NTH = 0,24 DO BEGIN
ENDIF; IF DO_EACH_SST EQ 'Y' THEN BEGIN


END; #####################  END OF ROUTINE ################################
