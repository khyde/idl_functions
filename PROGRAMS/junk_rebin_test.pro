PRO JUNK_REBIN_TEST

  ARR = FINDGEN(8,8)
  P, ARR
  P
  P, 'REBIN'
  P, REBIN(ARR,4,4)
  P
  P, 'FREBIN 4x4'
  P, FREBIN(ARR,4,4)
  P
  P, 'FREBIN 3x3'
  P, FREBIN(ARR,3,3)
  
STOP
  P
  P, 'ARRAY WITH MISSINGS'
  A = FINDGEN(6,6)                   ; SAMPLE DATA
  SUBS = [1,4,8,16,24]
  A(SUBS) = missings(a)
  P, A
  P
  P, 'REBIN RETURNS MISSINGS:'
  P,REBIN(A,3,3)
  
  P
  P, 'REBIN_NAN RETURNS MEANS WITHOUT THE MISSING DATA:'
  B = REFORM(A, 2, 3, 2, 3)           ; Make separate 'b' array  - TO SAVE MEMORY, COULD REWRITE A AS:  A = REFORM(A, 2, 3, 2, 3, /OVERWRITE)
  SUMFINITE = TOTAL(TOTAL(B, 3, /NAN), 1, /NAN)
  NFINITE = TOTAL(TOTAL(FINITE(B), 3, /NAN), 1, /NAN)
  RESULT = SUMFINITE/NFINITE  
  P, RESULT
  P
STOP


  P
  A = FINDGEN(32768,16384)                   ; SAMPLE DATA
  SUBS = FIX(10000000*RANDOMU(SEED,100000))
  A(SUBS) = MISSINGS(A)
  P, 'START WITH 32768 X 16384 ARRAY WITH ' + NUM2STR(N_ELEMENTS(SUBS)) + ' MISSING VALUES'
  P
 
  P, 'ORIGINAL REBIN'
  TIC
  R = REBIN(A,4096,2048)
  TOC
  OK = WHERE(R EQ MISSINGS(R),COUNT)
  P, 'REBIN RETURNS 4096 X 2048 ARRAY WITH ' + NUM2STR(COUNT) + ' MISSING VALUES'

  P
  P, 'REBIN_NAN'
  TIC
  A = REFORM(A, 8, 4096, 8, 2048,/OVERWRITE)
  SUMFINITE = TOTAL(TOTAL(A, 3, /NAN), 1, /NAN)
  NFINITE = TOTAL(TOTAL(FINITE(A), 3, /NAN), 1, /NAN)
  RESULT = SUMFINITE/NFINITE
  TOC
  OK = WHERE(RESULT EQ MISSINGS(RESULT),COUNT)
  P, 'REBIN_NAN RETURNS 4096 X 2048 ARRAY WITH ' + NUM2STR(COUNT) + ' MISSING VALUES'
  P

STOP
END