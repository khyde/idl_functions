; $ID:	IMG_PARSE.PRO,	2020-06-30-17,	USER-KJWH	$
	PRO IMG_PARSE,IMG,COLORS, BACKGROUND=BACKGROUND,PNG=PNG,DELAY=DELAY
;##############################################################################
;+
; NAME:
;		IMG_PARSE
;
; PURPOSE:	THIS PROCEDURE DISPLAYS ONE OR MORE COLORS PRESENT IN A BINARY IMAGE
;
; CATEGORY:
;		IMAGE
;
; CALLING SEQUENCE:
;
;		IMG_PARSE, IMG

; INPUTS:
;		IMG:	A 2D-IMAGE ARRAY
;		COLORS: THE COLORS PRESENT IN THE IMAGE TO BE DISPLAYED 
;		       (DEFAULT IS ALL COLORS)
;

; KEYWORD PARAMETERS:
;		BACKGROUND:	BACKGROUND COLOR TO USE IN THE DISPLAY
;
; OUTPUTS:
;		THIS ROUTINE DISPLAYS AN IMAGE SHOWING WHERE EACH COLOR IS FOUND
;
;	PROCEDURE:
;		A BLANK IMAGE (255B) IS MADE FROM THE IMG AND
;   THE TARGET COLOR(S) ARE FOUND USING WHERE AND COPIED TO THE BLANK IMAGE


; EXAMPLES:
;     IMG_PARSE,READ_IMAGE(!S.SUBAREAS + "MASK\MASK_SUBAREA-NEC-PXY_1024_1024-GFISH4-COAST_10KM.png")

; MODIFICATION HISTORY:
;			WRITTEN NOV 21, 2006 BY J.O'REILLY, 28 TARZWELL DRIVE, NMFS, NOAA 02882 (JAY.O'REILLY@NOAA.GOV)
;			SEP 28,2013,JOR FORMATTING
;			APR 6,2014, JOR REVISED FOR GRAPHICS FUNCTIONS
;			                ADDED KEYWORD PNG
;			JUN 4,2014,JOR RENAMED FROM IMAGE_LOOK
;			JUL 4,2014,JOR,ADDED RGB_TABLE
;			JUL 5,2014,JOR, REFINEMENTS
;			JUL 6,2014,JOR, COMMENT SPREAD,STRUCT
;##############################################################################
;-
;	**************************
ROUTINE_NAME  = 'IMG_PARSE'
;***************************
;===> CONSTANTS
RGB_TABLE = RGBS()
IF NONE(DELAY) THEN DELAY = 8
IF N_ELEMENTS(BACKGROUND) NE 1 THEN BACKGROUND=255B

W = WINDOW(WINDOW_TITLE = ROUTINE_NAME,RGB_TABLE=RGB_TABLE)

H=HISTOGRAM(IMG,MIN=0,MAX=255)

IF N_ELEMENTS(COLORS) EQ 0 THEN BEGIN
 COLORS=WHERE(H GE 1)
ENDIF ELSE BEGIN
  COLORS = COLORS
ENDELSE;IF N_ELEMENTS(COLORS) EQ 0 THEN BEGIN
N_COLORS =N_ELEMENTS(COLORS)

STRUCT= REPLICATE(CREATE_STRUCT('COLOR',0,'COUNT',0L),N_COLORS)
STRUCT.COLOR=COLORS
STRUCT.COUNT = H(COLORS)
;SPREAD,STRUCT
; ===> DETERMINE COLUMNS AND ROWS
COLS = FLOOR( SQRT(N_COLORS+ SQRT(N_COLORS)))
ROWS = CEIL(SQRT(N_COLORS))

;FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
FOR NTH=0L,N_COLORS-1L DO BEGIN
	ACOLOR = COLORS[NTH]
    COPY=IMG
    COPY(*,*)=BACKGROUND
    OK = WHERE(IMG EQ ACOLOR,COUNT)
    IF COUNT GE 1 THEN BEGIN
      COPY[OK] = ACOLOR
    ENDIF;IF COUNT GE 1 THEN BEGIN
      TITLE = STRTRIM('COLOR:'+ROUNDS(ACOLOR)+'  =  '+ STR_COMMA(COUNT))
      I=IMAGE(COPY,/CURRENT,LAYOUT = [COLS,ROWS,(NTH+1)],$
      TITLE=TITLE,FONT_SIZE = 11,RGB_TABLE=RGB_TABLE)
      TXT =  NUM2STR(COUNT) 
     ; T = TEXT(0.0,0.0,/DATA,TXT,COLOR='BLACK',TARGET = I,FONT_SIZE = 6)
 
    ENDFOR;FOR NTH=0L,N_ELEMENTS(COLORS)-1L DO BEGIN
;		FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
IF IDLTYPE(PNG) EQ 'STRING' THEN PNGFILE =!S.IDL_TEMP + PNG + '.PNG' ELSE PNGFILE = !S.IDL_TEMP + ROUTINE_NAME + '.PNG'
W.SAVE, PNGFILE,RESOLUTION=600,WIDTH = WIDTH,HEIGHT = HEIGHT ,BORDER =50
PF,PNGFILE
IF KEY(DELAY) THEN WAIT,DELAY
W.CLOSE

END; #####################  END OF ROUTINE ################################
