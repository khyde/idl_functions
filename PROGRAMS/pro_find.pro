; $ID:	PRO_FIND.PRO,	2020-06-30-17,	USER-KJWH	$

	PRO PRO_FIND,TXT,DIR=DIR

;+
; NAME:
;		PRO_FIND
;
; PURPOSE: FIND ALL D:\IDL\PROGRAMS\*.PRO PROCEDURES HAVING TXT STRING AND WRITE A LIST OF THEM
;
; CATEGORY:
;		CATEGORY
;		 EDIT
;
; CALLING SEQUENCE:
;   PRO_FIND,TXT
; INPUTS:
;		TXT: THE STRING TO FIND
;		NEW: THE NEW REPLACEMENT STRING
;		
; OPTIONAL INPUTS:
;		NONE:	
;
; KEYWORD PARAMETERS:
;		NONE
; OUTPUTS:
;		This PROGRAM:
;		 OPENS EACH PRO FILE
;		 SEARCHES FOR TXT
;		 IF FOUND THEN WRITES THEIR NAMES TO 'D:\IDL\PROGRAMS\'
;		 THEN IT PERMANENTLY CHANGES THE PROGRAM FILE IN  D:\IDL\PROGRAMS\*.PRO
;

; EXAMPLE:
;  PRO_FIND,'LIST', 'PLIST'
;  PRO_FIND,'PARSE_IT', 'FILE_PARSE'
;  PRO_FIND,'READ_CSV'
;	NOTES:

;
; MODIFICATION HISTORY:
;			Written SEP 25,2011  J.O'Reilly
;			MAR 4,2012,JOR ADDED KEYWORD DIR
;			IF N_ELEMENTS(DIR) EQ 0 THEN _DIR = !S.DIR_PROGRAMS ELSE _DIR = DIR

;-
;	**************************************
	ROUTINE_NAME = 'PRO_FIND'
; **************************************
	; ===> MAKE BACKUP DIR
	BACK = !S.DIR_BACKUP
  FILE_MKDIR,BACK
  IF N_ELEMENTS(DIR) EQ 0 THEN _DIR = !S.DIR_PROGRAMS ELSE _DIR = DIR
; ===> FIND ALL PROGRAMS	
	FILES = FILE_SEARCH(_DIR,'*.PRO')
	PN,FILES
	;STOP
; LLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLL	
	FOR NTH = 0, N_ELEMENTS(FILES)-1L DO BEGIN
	 AFILE = FILES[NTH]
	 FN = FILE_PARSE(AFILE)
	 
;;	 PRINT,FN.NAME
	 ALL = READ_TXT(AFILE)
; ===> FIND JUST NON-COMMENTED COMMANDS	 
	 OK = WHERE(STRMID(ALL,0,1) NE ';',COUNT_CMDS,NCOMPLEMENT = NCOMPLEMENT, COMPLEMENT = COMPLEMENT)
	 IF COUNT_CMDS GE 1 THEN TXT_CMDS = ALL[OK] ELSE TXT_CMDS = ALL
	 IF NCOMPLEMENT GE 1 THEN TXT_SEMI = ALL(COMPLEMENT) ELSE TXT_SEMI = ''
	   	 
	 OK = WHERE_STRING(TXT_CMDS,TXT,FOUND)
	 IF FOUND GE 1 THEN BEGIN
     NEW= PROS + FN.NAME_EXT
   
	   FILE_COPY,AFILE, BACK,/ALLOW_SAME,/OVERWRITE
;	   PRINT, 'FOUND  '+ OLD + ' IN '+AFILE 
       
 ;;    TXT_CMDS = REPLACE(TXT_CMDS,OLD,NEW)
     ALL = [TXT_SEMI,TXT_CMDS]
             
     WRITE_TXT,NEW, ALL& PF,NEW
     
	 ENDIF ELSE BEGIN
	   CONTINUE
	 ENDELSE; IF FOUND GE 1 THEN BEGIN
	ENDFOR; FOR NTH = 0, N_ELEMENTS(FILES)-1L DO BEGIN
; LLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLL	
  
	
	
  ERROR = ''

	END; #####################  End of Routine ################################
