; $ID:	FILE_UNCOMPRESS.PRO,	2020-07-01-12,	USER-KJWH	$
;###################################################################################################
 PRO FILE_UNCOMPRESS,FILES, DIR_OUT=DIR_OUT,OVERWRITE=OVERWRITE
;+
; NAME:
;       FILE_UNCOMPRESS
;
;  PURPOSE: THIS PROGRAM READS COMPRESSED FILES AND WRITES UN-COMPRESSED FILES USING COPY_LUN 

;
; CATEGORY:
;		FILE
;		
; INPUTS:
;   FILE: COMPLETE PATH AND NAME OF THE IDL COMPRESSED INPUT FILE [WITH EXT '.COMPRESSED]
;   
; OPTIONAL INPUTS:
;   NONE: 
;   
; KEYWORD PARAMETERS:
;   DIR_OUT: THE DIR FOR THE UN-COMPRESSED FILE
;   OVERWRITE: OVERWRITE THE UN-COMPRESSED OUTPUT FILE IF IT EXISTS
; OUTPUTS:
;   AN UN-COMPRESSED FILE IS WRITTEN TO DIR_OUT
; ;KEYWORDS:
;   
;	EXAMPLES:
;	FILE_UNCOMPRESS,'E:\SMI-BACKUP\PSERIES\TS_IMAGES-!STUDY-SEAWIFS_AQUA-ORBV2_EOSAT-2010-9KM-SMI-CHLOR_A-OC4-PSERIES_5281.COMPRESSED',DIR_OUT='C:\JUNK\'
;
; MODIFICATION HISTORY:
;       WRITTEN BY:  J.E.O'REILLY, MAY 9,2012
;       
;###################################################################################################

;*********************************
ROUTINE_NAME  = 'FILE_UNCOMPRESS'
;*********************************

IF N_ELEMENTS(FILES) EQ 0 THEN MESSAGE,'FILES ARE REQUIRED INPUT'
IF N_ELEMENTS(OVERWRITE) EQ 0 THEN OVERWRITE = 0
;FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF  
FOR _FILE = 0L, N_ELEMENTS(FILES)-1L DO BEGIN
  FILE = FILES(_FILE)
  IF FILE_TEST(FILE) EQ 0 THEN MESSAGE,FILE + ' NOT FOUND'
	FN=FILE_PARSE(FILE)
  IF FN.EXT NE 'COMPRESSED' THEN MESSAGE,FILE +'NOT A COMPRESSED FILE MADE WITH FILE_COMPRESS'
	IF N_ELEMENTS(DIR_OUT) NE 1 THEN DIR_OUT=FN.DIR
	IF FILE_TEST(DIR_OUT,/DIRECTORY) EQ 0 THEN FILE_MKDIR,DIR_OUT
	
  OUTFILE= DIR_OUT + FN.NAME + '.UNCOMPRESSED'
  IF FILE_TEST(OUTFILE) EQ 1 AND OVERWRITE EQ 0 THEN BEGIN
   PRINT, 'SKIPPING '+OUTFILE + ' BECAUSE IT  ALREADY EXISTS'
   GOTO,DONE
  ENDIF;F FILE_TEST(OUTFILE) EQ 1 AND OVERWRITE EQ 0 THEN BEGIN
  	
  PFILE,FILE,/R
  OPENR, LUN_IN, FILE, /GET_LUN,/COMPRESS

	PFILE,OUTFILE,/W
	OPENW,LUN_OUT,OUTFILE,/GET_LUN
	COPY_LUN, LUN_IN, LUN_OUT,TRANSFER_COUNT=TRANSFER_COUNT
	
	FREE_LUN,LUN_IN

  FREE_LUN,LUN_OUT
	CLOSE,/ALL
	
	PRINT,STR_COMMA(TRANSFER_COUNT) + '  BYTES COPIED AND UN-COMPRESSED'
	FI=FILE_INFO(FILE)
	SZ_IN = FI.SIZE
	FI=FILE_INFO(OUTFILE)
  SZ_OUT = FI.SIZE
  PCT=100.0 *SZ_OUT/SZ_IN
  PRINT,OUTFILE +' PERCENT COMPRESSION =  ' +STRTRIM(PCT,2)
ENDFOR;FOR _FILE = 0L, N_ELEMENTS(FILES)-1L DO BEGIN
;FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
DONE:

END; #####################  END OF ROUTINE ################################



