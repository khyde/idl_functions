PRO JUNK_BATCH_L3_PARALLEL

;CMDS = ["BATCH_L3,DO_STATS='Y[SA;PER=M3,SAV;PER=M3,SAVJ;PER=M3,SEAWIFS;PER=M3,MODISA;PER=M3,VIIRS;PER=M3,JPSS1;PER=M3,PP-SA,PP-SAV,PP-SAVJ,PP-VIIRS,PP-JPSS1','PP-SEAWIFS,PP-MODISA"];,$
       ; "BATCH_L3,DO_STATS='Y[SA;PER=D3.D8.DOY,SAV;PER=D3.D8.DOY,SAVJ;PER=D3.D8.DOY]'"]


CMDS = ["BATCH_L3,DO_STATS='Y[SA;PER=M3.ANN.WK;P=NC_CHL.CHL]',BATCH_DATASET='SA'",$
        "BATCH_L3,DO_STATS='Y[SAV;PER=M3.ANN.WK;P=NC_CHL.CHL]',BATCH_DATASET='SAV'",$
        "BATCH_L3,DO_STATS='Y[SAVJ;PER=M3.ANN.WK;P=NC_CHL.CHL]',BATCH_DATASET='SAVJ'",$
        "BATCH_L3,DO_STATS='Y[PP-SA;PER=M3.ANN.WK]',BATCH_DATASET='PP-SA'",$
        "BATCH_L3,DO_STATS='Y[PP-SAV;PER=M3.ANN.WK]',BATCH_DATASET='PP-SAV'",$
        "BATCH_L3,DO_STATS='Y[PP-SAVJ;PER=M3.ANN.WK]',BATCH_DATASET='PP-SAVJ'",$
        "BATCH_L3,DO_STATS='Y[SEAWIFS;PER=M3.ANN.WK;P=NC_CHL.CHL]',BATCH_DATASET='SEAWIFS'",$
        "BATCH_L3,DO_STATS='Y[MODISA;PER=M3.ANN.WK;P=NC_CHL.CHL]',BATCH_DATASET='MODISA'",$
        "BATCH_L3,DO_STATS='Y[VIIRS;PER=M3.ANN.WK;P=NC_CHL.CHL]',BATCH_DATASET='VIIRS'",$
        "BATCH_L3,DO_STATS='Y[JPSS1;PER=M3.ANN.WK;P=NC_CHL.CHL]',BATCH_DATASET='JPSS1'",$
        "BATCH_L3,DO_ANOMS='Y[SA]',BATCH_DATASET='SA'",$
        "BATCH_L3,DO_ANOMS='Y[SAV]',BATCH_DATASET='SAV'",$
        "BATCH_L3,DO_ANOMS='Y[SAVJ]',BATCH_DATASET='SAVJ'",$
        "BATCH_L3,DO_ANOMS='Y[SA]',BATCH_DATASET='PP-SA'",$
        "BATCH_L3,DO_ANOMS='Y[PP-SAV]',BATCH_DATASET='PP-SAV'",$
        "BATCH_L3,DO_ANOMS='Y[PP-SAVJ]',BATCH_DATASET='PP-SAVJ'"]
;        "BATCH_L3,DO_MAKE_PRODS='Y',DO_D3='Y',DO_PPD='Y[JPSS1]',DO_STATS='Y[JPSS1;P=NC_PAR.NC_CHL.CHLS;M=L3B2;PER=MIN.WK]',BATCH_DATASET='JPSS1',BATCH_DATERANGE='2017_2019'",$
;        "BATCH_L3,DO_MAKE_PRODS='Y',DO_D3='Y',DO_PPD='Y[SEAWIFS]',DO_STATS='Y[SEAWIFS;P=NC_PAR.NC_CHL.CHLS;M=L3B2;PER=MIN.WK]',BATCH_DATASET='SEAWIFS',BATCH_DATERANGE='1997_2010'",$
;        "BATCH_L3,DO_MAKE_PRODS='Y',DO_D3='Y',DO_PPD='Y[MODISA]',DO_STATS='Y[MODISA;P=NC_PAR.NC_CHL.CHLS;M=L3B2;PER=MIN.WK]',BATCH_DATASET='MODISA',BATCH_DATERANGE='2002_2019'",$
;        "BATCH_L3,DO_MAKE_PRODS='Y',DO_D3='Y',DO_PPD='Y[VIIRS]',DO_STATS='Y[VIIRS;P=NC_PAR.NC_CHL.CHLS;M=L3B2;PER=MIN.WK]',BATCH_DATASET='VIIRS',BATCH_DATERANGE='2012_2019'",$
;        "BATCH_L3,DO_STATS='Y[SA,SAV,SAVJ]'",$
;        
;        "BATCH_L3,DO_STATS='Y[PP-MODISA;M=L3B2;PER=MIN.WK]',BATCH_DATASET='PP-MODISA',BATCH_DATERANGE='2002_2019'",$
;        "BATCH_L3,DO_STATS='Y[PP-SEAWIFS;M=L3B2;PER=MIN.WK]',BATCH_DATASET='PP-SEAWIFS',BATCH_DATERANGE='1997_2010'",$
;        "BATCH_L3,DO_STATS='Y[PP-VIIRS;M=L3B2;PER=MIN.WK]',BATCH_DATASET='PP-VIIRS',BATCH_DATERANGE='2012_2019'",$
;        "BATCH_L3,DO_STATS='Y[PP-JPSS1;M=L3B2;PER=MIN.WK]',BATCH_DATASET='PP-JPSS1',BATCH_DATERANGE='2017_2019'",$
;        
;        "BATCH_L3,DO_STATS='Y[SA;M=L3B2;PER=MIN.WK.DOY.ANNUAL,PP-SA;M=L3B2;PER=MIN.WK.DOY.ANNUAL]'",$
;        "BATCH_L3,DO_STATS='Y[SAV;M=L3B2;PER=MIN.WK.DOY.ANNUAL,PP-SAV;M=L3B2;PER=MIN.WK.DOY.ANNUAL]'",$
;        "BATCH_L3,DO_STATS='Y[SAVJ;M=L3B2;PER=MIN.WK.DOY.ANNUAL,PP-SAVJ;M=L3B2;PER=MIN.WK.DOY.ANNUAL]'",$
;        
;        "BATCH_L3,DO_STATS='Y[MODISA;M=L3B4;PER=MIN;P=NC_CHL]',BATCH_DATASET='MODISA',BATCH_DATERANGE='2002_2019'",$
;        "BATCH_L3,DO_STATS='Y[SEAWIFS;M=L3B9;PER=MIN;P=NC_CHL]',BATCH_DATASET='SEAWIFS',BATCH_DATERANGE='1997_2010'",$
;        "BATCH_L3,DO_STATS='Y[PP-MODISA;M=L3B4;PER=MIN]',BATCH_DATASET='PP-MODISA',BATCH_DATERANGE='2002_2019'",$
;        "BATCH_L3,DO_STATS='Y[PP-SEAWIFS;M=L3B9;PER=MIN]',BATCH_DATASET='PP-SEAWIFS',BATCH_DATERANGE='1997_2010'",$
;        "BATCH_L3,DO_STATS='Y[VIIRS;P=NC_PAR;PER=MIN.WK]',BATCH_DATASET='VIIRS'",$
;        "BATCH_L3,DO_STATS='Y[JPSS1;P=NC_PAR;PER=MIN.WK]',BATCH_DATASET='JPSS1'",$
;        "BATCH_L3,DO_STATS='Y[SEAWIFS;P=NC_CHL.CHLS.NC_PAR;M=L3B2;PER=D3.D8.DOY.MIN.WK]',BATCH_DATASET='SEAWIFS',BATCH_DATERANGE='1997_2010'",$
;        "BATCH_L3,DO_STATS='Y[MODISA;P=NC_CHL.CHLS.NC_PAR;M=L3B2;PER=D3.D8.DOY.MIN.WK]',BATCH_DATASET='MODISA',BATCH_DATERANGE='2002_2020'",$
;        "BATCH_L3,DO_STATS='Y[VIIRS;P=NC_CHL.CHLS.NC_PAR;PER=D3.D8.MIN.WK]',BATCH_DATASET='VIIRS'",$
;        "BATCH_L3,DO_STATS='Y[JPSS1;P=NC_CHL.CHLS.NC_PAR;PER=D3.D8.MIN.WK]',BATCH_DATASET='JPSS1'"];,$]
;;        "batch_l3, BATCH_DATASET='SEAWIFS',do_stats='Y[;P=NC_PHYTO.PHSIZE;M=L3B2;PER=MIN.WK]'",$
;;        "batch_l3, BATCH_DATASET='SEAWIFS',do_stats='Y[;P=NC_PHYTO.PHSIZE;M=L3B2;PER=MIN.WK]'",$
;;        "batch_l3, BATCH_DATASET='SEAWIFS',do_stats='Y[;P=NC_PHYTO.PHSIZE;M=L3B2;PER=MIN.WK]'",$
;;        "batch_l3, BATCH_DATASET='SEAWIFS',do_stats='Y[;P=NC_PHYTO.PHSIZE;M=L3B2;PER=MIN.WK]'"]
;;      "batch_l3,do_stats='Y[PP-MODISA;M=L3B4;PER=M.A]'",$
;;        "batch_l3,BATCH_DATASET='SEAWIFS',do_ppd='Y[;M=L3B9]'","batch_l3,do_stats='Y[PP-SEAWIFS;M=L3B9;PER=M.A]'"];,$
;;       "batch_l3,BATCH_DATASET='MODISA', do_d3='Y[;M=L3B4]',do_ppd='Y[;M=L3B4]'", 
;;       "batch_l3,BATCH_DATASET='OCCCI', do_d3='Y[;M=L3B4]',do_ppd='Y[;M=L3B4]'",  "batch_l3,do_stats='Y[PP-OCCCI;PER=M.A]'"]

CMDS = ["batch_l3, batch_dataset='MUR',do_stats='Y[MUR;PER=M3]'","batch_l3,batch_dataset='AVHRR',do_stats='Y[AVHRR;PER=M3]'"]
CMDS = "BATCH_L3,DO_STATS='Y[SAV;PER=M.M3.A;P=NC_PAR]',BATCH_DATASET='SAV'"
CMDS = ["batch_l3,BATCH_DATASET='OCCCI', do_STATS='Y[OCCCI;M=L3B4;P=CHLOR_A-OCI;PER=M3]'"]


CMDS = [];["BATCH_L3,BATCH_DATASET='OCCCI',DO_OCCCI='Y'"]
SENSORS = ['PP-MODISA','PP-VIIRS','PP-SEAWIFS','PP-JPSS1','PP-SAVJ','PP-SAV','PP-SA','PP-OCCCI'];,'OCCCI','SEAWIFS','MODISA','VIIRS','JPSS1','SAV','SAVJ'];'SEAWIFS','MODISA','SA','VIIRS','SAV','JPSS1','SAVJ']
FOR S=0, N_ELEMENTS(SENSORS)-1 DO BEGIN
  SEN = SENSORS[S]
  IF STRMID(SEN,0,2) EQ 'PP' THEN BEGIN
    CMDS = [CMDS,"BATCH_L3,BATCH_DATASET='"+SEN+"',"+[$
            "DO_STATS='Y["+SEN+";P=PPD-VGPM2;PER=M.A.M3.W.WEEK.CLIM]'",$
            "DO_ANOMS='Y["+SEN+"]"]]
  ENDIF ELSE BEGIN
    CASE SEN OF
      'OCCCI': PRODS = 'PHYPERS.PSIZES.MIN_CCI'
      ELSE:    PRODS = 'CHLOR_A-OCI.CHLOR_A-PAN'  
    ENDCASE
    CMDS = [CMDS,"BATCH_L3,BATCH_DATASET='"+SEN+"',"+[$
       ;     "DO_MAKE_PRODS='YRF["+SEN+"]'",$
       ;     "DO_D3='Y["+SEN+"]'",$
            "DO_STATS='Y["+SEN+";PER=M.W.WEEK.M3.A.CLIM;P="+PRODS+"]'",$
            "DO_ANOMS='Y["+SEN+";P=CHLOR_A-CCI.CHLOR_A-PAN]'"$
       ;     "DO_PPD='Y["+SEN+"]'"$
             ]]
  ENDELSE     
ENDFOR
    
DSETS = ['MODISA','MODIST','SEAWIFS','AVHRR','MUR','OCCCI'] 
CMDS = []      
FOR D=0, N_ELEMENTS(DSETS)-1 DO CMDS = [CMDS,"BATCH_L3, DO_FRONTS='Y["+DSETS[D]+"]',BATCH_DATASET='"+DSETS[D]+"'"]
CMDS = ["BATCH_L3, DO_MAKE_PRODS='Y[OCCCI]'","BATCH_L3, DO_STATS='Y[OCCCI;PER=D8;P=POC-STRAMSKI]'"]
CMDS = ["BATCH_L3,DO_STAT_FRONTS='Y[OCCCI;PER=D8]'","BATCH_L3,DO_STAT_FRONTS='Y[AT;PER=D8]'"]
CMDS = ["BATCH_L3,BATCH_DATASET='OCCCI',DO_OCCCI='Y'"]




server = 'modis' & spwn=1
case server of 
  'satdata': begin
    CMDS = "BATCH_L3,DO_PPD='Y[OCCCI;M=L3B4]',DO_STATS='Y[PP-OCCCI;PER=D8.W.M.A]',BATCH_DATASET='PP-OCCCI'"
    batch_l3_parallel, CMDS, NPROCESS=8, SERVERS=['satdata'], R_YEAR=1, SPWN=SPWN
  end  
  'modis': begin
    CMDS = "BATCH_L3,DO_PPD='YRF[OCCCI;M=L3B4]'"
    batch_l3_parallel, CMDS, NPROCESS=8, SERVERS=['modis'],IDL88=1,R_YEAR=0, SPWN=SPWN
  end
  'luna': begin
     CMDS = "BATCH_L3,DO_GLOBCOLOUR='YRF',DO_STATS='YRF[GLOBCOLOUR;P=POC.PIC;PER=D8]',BATCH_DATASET='GLOBCOLOUR'"
     batch_l3_parallel, CMDS, NPROCESS=8, SERVERS=['luna'], R_YEAR=1, SPWN=SPWN
   END      
endcase






END

; batch_l3,BATCH_DATASET='MODISA',do_d3='Y[;M=L3B4]' & batch_l3,do_stats='Y[PP-MODISA;M=L3B4]' & batch_l3,BATCH_DATASET='SEAWIFS',do_d3='Y[;M=L3B9],do_ppd='Y[;M=L3B9]' & batch_l3,do_stats='Y[PP-SEAWIFS;M=L3B9;PER=M.A] & batch_l3,BATCH_DATASET='OCCCI',do_d3='Y[;M=L3B4]',do_ppd='Y[;M=L3B4]' & batch_l3,do_stats='Y[PP-OCCCI;PER=M.A]'