; $ID:	D3_PSERIES_PLT.PRO,	2020-07-01-12,	USER-KJWH	$
;+
;;#############################################################################################################
	PRO D3_PSERIES_PLT,D3_FILE,NTH,DELAY=DELAY,SG=SG,TS=TS,SP=SP,XY=XY
;
; PURPOSE: THIS FUNCTION PLOTS PSERIES DATA FROM A D3 STRUCTURE 
; 
; 
; CATEGORY:	D3 FAMILY		 
;
; CALLING SEQUENCE: RESULT = D3_PSERIES_PLT(D3_FILE)
;
; INPUTS: D3_FILE  [FROM D3_READ]

; OPTIONAL INPUTS:
;		NONE:	
;		
; KEYWORD PARAMETERS:
;   DELAY - SECONDS TO DELAY BEFORE CLOSING PLOT WINDOW
;   SG    SMOOTH USING SAVGOL
;   TS -  SMOOTH USING TS_SMOOTH

; OUTPUTS: 
;		
;; EXAMPLES:
;          D3_FILE = !S.IDL_TEMP + 'JUNK.SAV' & D3_PSERIES_PLT,D3_FILE,5,/SG
;          D3_FILE = !S.IDL_TEMP + 'JUNK.SAV' & D3_PSERIES_PLT,D3_FILE,5,/TS,/XY
;	NOTES:

;		
;
;
; MODIFICATION HISTORY:
;			WRITTEN FEB 15, 2014 J.O'REILLY
;#################################################################################
;-
;******************************
ROUTINE_NAME  = 'D3_PSERIES_PLT'
;******************************

IF NONE(D3_FILE) THEN D3_FILE = !S.IDL_TEMP + 'JUNK.SAV'
IF NONE[NTH] THEN NTH = 1
ARR = D3_READ(D3_FILE,NTH,/PSERIES)
S = D3_READ(D3_FILE,NTH,/STRUCT)
JD = S.JD & JDS = S.JDS

;********************
IF KEY(SG) THEN BEGIN
;********************
  TYPE = 'SG'
; INPUTS FOR SAVGOL NLEFT = 2 BECAUSE NLEFT OF 1 MATCHES DATA TOO MUCH-NO SMOOTHING
  NLEFT = 2 & NRIGHT = NLEFT & ORDER = 0  & DEGREE = 2 & DOUBLE = 1 & WIDTH = NLEFT+ NRIGHT
  FILTER = SAVGOL( NLEFT, NRIGHT, ORDER, DEGREE,DOUBLE=DOUBLE )
  SMO = CONVOL(ARR, FILTER, /EDGE_TRUNCATE,/CENTER,/NAN)
  TITLE = 'SG-WIDTH-' + ROUNDS(WIDTH) + '-ORDER-' + ROUNDS(ORDER)
  STOP

  INTERP_JD = ULONG(INTERVAL([MIN_JD,MAX_JD],INTERP_DAYS))
  INTP = INTERPOL( SMO,JDS, INTERP_JD,/NAN)
  P=PLOT(INTP)
ENDIF;IF KEY(SG) THEN BEGIN
;||||||||||||||||||||||||||
 
;********************
IF KEY(TS) THEN BEGIN
;********************;
  ;===> REMOVE MISSING
  OK = WHERE(ARR NE MISSINGS(ARR),COUNT)
  IF COUNT GE 1 THEN ARR = ARR[OK] 
  PN,ARR,'POINTS IN THE ARR'
 
  WIDTH = 3
  ORDER = 10   & DOUBLE = 1 
  SMO = TS_SMOOTH(ARR, WIDTH,ORDER=ORDER,/NAN,/DOUBLE)
  TITLE = 'TS-WIDTH-' + ROUNDS(WIDTH) + '-ORDER-' + ROUNDS(ORDER)
ENDIF;IF KEY(TS) THEN BEGIN
;||||||||||||||||||||||||||
;
;*********************
IF KEY(SP) THEN BEGIN
;********************* 
  S = D3_READ(D3_FILE,NTH,/STRUCT)
  X = S.JDS
  ARR = S.PSERIES & Y=ARR
  OK = WHERE(Y NE MISSINGS(Y),COUNT)
  IF COUNT GE 1 THEN  BEGIN
    X = X[OK]
    Y= Y[OK]
  ENDIF
  
  
 
;;;Z = SPLINE(X,Y,T)
  
  
ENDIF;IF KEY(SP) THEN BEGIN
;||||||||||||||||||||||||||

;SMO = SMO > MIN(ARR)
;SMO = SMO < MAX(ARR)

P=PLOT(ARR,COLOR = 'RED',THICK = 7)
P=PLOT(SMO,COLOR = 'MAGENTA',THICK = 3,/CURRENT,/OVERPLOT)
PLT_GRIDS,P
IF NONE(DELAY) THEN DELAY = 4
WAIT,DELAY
& PRINT,MM(ARR),MM(SMO)
P.CLOSE
;P = PLOT(FILTER) & PLT_GRIDS,P & WAIT,3 & P.CLOSE
IF KEY(XY) THEN PLT_XY,ARR,SMO,/SYM_ADD,TITLE=TITLE,$
DELAY=DELAY,/STATS_ADD,/REG_ADD,/GRID_ADD,/XLOG,/YLOG,FILE = TITLE +'.PNG'
DONE: 
         
	END; #####################  END OF ROUTINE ################################
